\documentclass[Screen16to9,17pt]{foils}
\usepackage{kea-slides}
\externaldocument{introduction-to-incident-response-exercises}
\selectlanguage{english}

% Input:
% https://www.threathunting.net/reading-list

% Docker image with
% https://hub.docker.com/r/threathuntproj/hunting/
% This image contains a complete threat hunting & data analysis environment built on Python, Pandas, PySpark and Jupyter notebook.

\begin{document}

\mytitlepage
{0. Introduction}
{Introduction to Incident Response Elective, KEA}


\hlkprofiluk

\slide{Goals for today}

\hlkimage{6cm}{thomas-galler-hZ3uF1-z2Qc-unsplash.jpg}

\begin{quote}
Introduction to incident response. what is an incident and a log? We will discuss what happens when someone visits your network. Starting from initial compromise we will demonstrate how we can identify, process and handle incidents in networks.
\end{quote}

\begin{list2}
\item Welcome, course goals and expectations
%\item Prepare Virtual Machines - hope you brought a laptop
\item Create a good starting point for learning
\item Concrete Expectations
%\item Prepare tools for the exercises
\end{list2}


{\hfill \small Photo by Thomas Galler on Unsplash}



\slide{Introduction: Attack overview}

\hlkimage{20cm}{sicherheitstacho.png}
Source: \link{http://www.sicherheitstacho.eu/}


\slide{DDoS Attacks Still a Problem}

\hlkimage{13cm}{DDos_Attack_in_2021_arbor.png}

Security attacks and DDoS is very much in the media\\
Source: link{https://www.netscout.com/threatreport/global-ddos-attack-trends/}

\slide{Ransomware Attacks are Common}


\hlkimage{13cm}{ransomware_arbor.png}

Make sure to backup your data! Test your backups!\\
Source: link{https://www.netscout.com/threatreport/global-ddos-attack-trends/}

\slide{What can we do? -- Good security}

\hlkimage{12cm}{god-sikkerhed.pdf}

\begin{list1}
\item You always have limited resources for protection - use them as best as possible
\item Good security comes from structured work
\end{list1}


\slide{Balanced security}

\hlkimage{21cm}{afbalanceret-sikkerhed.pdf}

\begin{list1}
\item Better to have the same level of security
\item If you have bad security in some part - guess where attackers will end up
\item Hackers are not required to take the hardest path into the network
\item Realize there is no such thing as 100\% security
\end{list1}



\slide{Work together}

\hlkimage{10cm}{Shaking-hands_web.jpg}

\begin{list1}
\item Team up!
\item We need to share security information freely
\item We often face the same threats, so we can work on solving these together
\end{list1}


\slide{Plan for today}

\begin{list2}
\item Create a good starting point for learning
\item Introduce lecturer and students
\item Literature list walkthrough
\item Story time Hacking
\end{list2}

Exercise theme: Get tools up and running
\begin{list2}
\item What is an incident -- CISO for a day
\end{list2}

Linux is a toolbox we will use and participants will use some tools on Linux


\slide{Course Information: Introduction to Incident Response elective}

\hlkimage{8cm}{pawel-janiak-dxFi8Ea670E-unsplash.jpg}

Teaching dates: thursdays 12:45 - 16:45 in GBG.E512\\
26/2, 12/3, 19/3,26/3,2/4,9/4,23/4,30/4

Exam: 6/5, 7/5 and 13/5 {\hfill\small Photo by Pawel Janiak on Unsplash}


\slide{Time schedule}

Official times Thursdays:
\begin{list2}
\item 12:45 - 14:15 Session 1\\

\item 15min break\\

\item 14:30 - 16:45 Session 2\\
\end{list2}

In practice:
We will aim at one break at least for every 45min, and we will also be doing exercises.


\slide{Course Materials}

\begin{list1}
\item This material is in multiple parts:
\begin{list2}
%\item Introduktionsmateriale med baggrundsinformation
\item Slide shows - presentation - this file
\item Exercises - PDF which is updated along the way
\end{list2}
\item Books listed in the lecture plan and here
\item Additional resources from the internet
\end{list1}

Note: the presentation slides are not a substitute for reading the books, papers and doing exercises, many details are not shown


\slide{Fronter Platform}

\hlkimage{10cm}{fronter.png}

We will use fronter a lot, both for sharing educational materials and news during the course.

You will also be asked to turn in deliverables through fronter

\link{https://kea-fronter.itslearning.com/}

\vskip 5mm
\centerline{If you haven't received login yet, let us know}


\slide{Deliverables and Exam}

\begin{list2}
\item Exam
\item Individual: Oral based on curriculum
\item Graded (7 scale)
\item Exam is 30 minutes in total, including pulling the question and grading
\item Count on being able to present your project -- talk for about 10 minutes
\item Prepare material (keywords, examples, exercises, wireshark captures) for different topics so that you can use it to help you at the exam

\vskip 5mm
\item Deliverables:
\item 1 Mandatory assignments
\item Mandatory assignment is required in order to be entitled to the exam.
\end{list2}


\slide{Course Description}

{\bf Course description}\\
Introduction to Incident Response is a course that will describe the basics of incident response. This will include the terms, tools and processes used by professionals.

Below are the required parts from studieordningen:

{\bf Viden}
\begin{list2}
\item Forskellige cyberangrebs stadier og teknikker
\item Incident-Response cyklus
\item Pricipperne i Event logning
\item Processer i forbindelse med Incident response og Threat hunting
\end{list2}

\slide{Course Description, continued}

{\bf Færdigheder}

\begin{list2}
\item Søge i relevante filer, hukommelse og lignende for indicators of compromise (IoC)
\item Analysere event log, memory og timeline for tegn på security incidents
\item Viderebringe resultater i form af ekspertrapporter
\end{list2}

{\bf Kompetencer}
\begin{list2}
\item Anvende, udvikle og dele Threat Intelligence
\item Anvende og udvikle processer til incident håndtering i en organisation
\end{list2}



\slide{Exercises}

Exercise theme: Virtual Machines allows us play with tech

Since we are going to be doing exercises, each team will need virtual machines.

The following are recommended systems:
\begin{list2}
\item One VM based on Debian, running various software tools
%\item One VM based on Kali Linux, running hacking tools -- primary tool is Burp Suite and browser
\item Setup instructions and help \url{https://github.com/kramse/kramse-labs}
\end{list2}

Linux is a toolbox we will use and participants will use virtual machines

\vskip 1cm
PS We will from time to time have exercises, groups dont need to be the same each time.

\slide{Goals and plans}

%\hlkimage{}{}

\begin{quote}
  “A goal without a plan is just a wish.”\\
  ― Antoine de Saint-Exupéry
\end{quote}

I want this course to
\begin{list2}
\item Include everything listed in contents above
\item Be practical -- you can do something useful
\item Kickstart your journey into Incident Response\\
Getting a practical book with pointers about the subject
\item Present a lot of useful sources and tools
\item Prepare you for production use of the knowledge
\end{list2}

We have a lot of flexibility.


\slide{Prerequisites}

\begin{list1}
\item This course includes exercises and getting the most of the course requires the participants to carry out these practical exercises
\item We will use Linux for some exercises but previous Linux and Unix knowledge is not needed
\item It is recommended to use virtual machines for the exercises
\item Security and most internet related security work has the following requirements:
\begin{list2}
\item Network experience
\item Server experience
\item TCP/IP principles - often in more detail than a common user
\item Programming is an advantage, for automating things
\item Some Linux and Unix knowledge is in my opinion a {\bf necessary skill} for infosec work\\
-- too many new tools to ignore, and lots found at sites like Github and Open Source written for Linux
\end{list2}
\end{list1}


\slide{Primary literature}

\hlkrightpic{5cm}{0cm}{old_book_lumen_design_st_01.png}
Primary literature:
\begin{list2}
\item \emph{Intelligence-Driven Incident Response} \\
 Scott Roberts. Rebekah Brown, ISBN: 9781098120689 {\bf 2nd edition}- short IDIR


\item \emph{Forensics Discovery} (FD), Dan Farmer, Wietse Venema 2004, Addison-Wesley 240 pages.\\
ISBN: 9780201634976\\
This book is currently available for "free":\\
\link{http://fish2.com/security/} -- also uploaded to Fronter

\item \emph{
Computer Security Incident Handling Guide}, NIST SP 800-61 Rev. 2, August 2012,\\
\link{https://doi.org/10.6028/NIST.SP.800-61r2} -- also uploaded to Fronter
\end{list2}

{\bf Other papers and resources will also be part of the curriculum!}

\slide{Course overview}

We will now go through a little from the Table of Contents in the books.

and the lecture plan in Fronter\\
(Source is also in Git \link{https://github.com/kramse/kea-it-sikkerhed} )

\slide{Book: Intelligence-Driven Incident Response}

\hlkimage{6cm}{book-intelligence-driven-incident-response.jpg}

\emph{Intelligence-Driven Incident Response} \\
  Scott Roberts. Rebekah Brown, ISBN: 9781098120689 {\bf 2nd edition}- short IDIR


\slide{Book: Forensics Discovery (FD)}

\hlkimage{8cm}{forensic-discovery.jpg}

\emph{Forensics Discovery}, Dan Farmer, Wietse Venema 2004, Addison-Wesley.

Can be found at \link{http://fish2.com/security/}

\slide{Book: NIST SP800-61rev2}

\hlkimage{12cm}{NIST-SP800-61r2.png}

\link{https://doi.org/10.6028/NIST.SP.800-61r2}


\slide{Supporting literature books}
\begin{list2}
\item \emph{The Linux Command Line: A Complete Introduction}, 2nd Edition\\
 by William Shotts

\item \emph{The Debian Administrator’s Handbook}, Raphaël Hertzog and Roland Mas\\
\url{https://debian-handbook.info/} - shortened DEB
\item \emph{Kali Linux Revealed  Mastering the Penetration Testing Distribution}\\
Raphaël Hertzog, Jim O'Gorman - shortened KLR
\end{list2}




\slide{Book: The Linux Command Line}

\hlkimage{4cm}{lcl2_front_new.png}

\emph{The Linux Command Line: A Complete Introduction }, 2nd Edition
by William Shotts

Print: \link{https://nostarch.com/tlcl2}\\
Download -- internet edition \link{https://sourceforge.net/projects/linuxcommand}


Not curriculum but explains how to use Linux

\slide{ The Debian Administrator’s Handbook (DEB)}

\hlkimage{6cm}{book-debian-administrators-handbook.jpg}

\emph{The Debian Administrator’s Handbook}, Raphaël Hertzog and Roland Mas\\
\url{https://debian-handbook.info/} - shortened DEB

Not curriculum but explains how to use Debian Linux


\slide{Hackerlab Setup}

\hlkimage{6cm}{hacklab-1.png}

\begin{list2}
\item Hardware: modern laptop CPU with virtualisation\\
Dont forget to enable hardware virtualisation in the BIOS
\item Virtualisation software: VMware, Virtual box, HyperV pick your poison
\item Linux server system: Debian amd64 64-bit \link{https://www.debian.org/}
\item Setup instructions can be found at \link{https://github.com/kramse/kramse-labs}
\end{list2}

\centerline{It is enough if these VMs are pr team}


\slide{Mixed exercises}
Then we will do a mixed bag of exercises to introduce technologies, find your current knowledge level with regards to:

\begin{list2}
\item Linux as an operating system -- user database in /etc/
\item Linux command line
\item Demo: Ansible
\item Git, Python, scripting
\item Demo: Elasticsearch -- how to run a \emph{service}
\end{list2}

{\bf Note: today we will consider all these optional, we won't be able to do them all}

Later we will return to them!

\slide{Installing software in Debian -- apt}

%\hlkimage{}{}

\begin{alltt}\footnotesize
DESCRIPTION
apt provides a high-level commandline interface for the package management system. It is intended as an end user interface
and enables some options better suited for interactive usage by default compared to more specialized APT tools like apt-get(8)
and apt-cache(8).

update (apt-get(8))
  update is used to download package information from all configured sources. Other commands operate on this data to e.g.
  perform package upgrades or search in and display details about all packages available for installation.

upgrade (apt-get(8))
  upgrade is used to install available upgrades of all packages currently installed on the system from the sources configured
  via sources.list(5). New packages will be installed if required to satisfy dependencies, but existing packages will never
  be removed. If an upgrade for a package requires the removal of an installed package the upgrade for this package isn't performed.

full-upgrade (apt-get(8))
  full-upgrade performs the function of upgrade but will remove currently installed packages if this is needed to upgrade the
  system as a whole.
\end{alltt}

\begin{list2}
  \item Install a program using apt, for example \verb+apt install nmap+
\end{list2}



\slide{Ansible}

\hlkimage{2cm}{Ansible_logo.png}

\begin{quote}
From my course materials:\\
Ansible is great for automating stuff, so by running the playbooks we can get a whole lot of programs installed, files modified - avoiding the Vi editor.
\end{quote}

\begin{list2}
\item Easy to read, even if you don't know much about YAML
\item \link{https://www.ansible.com/} and \link{https://en.wikipedia.org/wiki/Ansible_(software)}
\item Great documentation\\
 \link{https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_module.html}
\end{list2}


\slide{Ansible Dependencies}

\hlkimage{10cm}{python-logo.png}

\begin{list2}
\item Ansible based on Python, only need Python installed\\
\link{https://www.python.org/}
\item Often you use Secure Shell for connecting to servers\\
\link{https://www.openssh.com/}
\item Easy to configure SSH keys, for secure connections
\end{list2}


\slide{Ansible playbooks}

Example playbook content, installing software using APT:
\begin{alltt}\small
apt:
    name: "\{\{ packages \}\}"
    vars:
      packages:
        - nmap
        - curl
        - iperf
        ...
\end{alltt}

Running it:
\begin{minted}[fontsize=\small]{shell}
cd kramse-labs/suricatazeek
ansible-playbook -v 1-dependencies.yml 2-suricatazeek.yml 3-elasticstack.yml 4-configuration.yml
\end{minted}

"YAML (a recursive acronym for "YAML Ain't Markup Language") is a human-readable data-serialization language."\\
\link{https://en.wikipedia.org/wiki/YAML}

\slide{Python and YAML -- Git}

\hlkimage{7cm}{git-logo.png}

\begin{list2}
\item We need to store configurations
\item Run playbooks
\item Problem: Remember what we did, when, how
\item Solution: use git for the playbooks
\item Not the only version control system, but my preferred one
\end{list2}

\slide{Git getting started}

{\bf Hints:}\\
Browse the Git tutorials on \link{https://git-scm.com/docs/gittutorial}\\
and \link{https://guides.github.com/activities/hello-world/}

\begin{list2}
\item What is git
\item Terminology
\end{list2}

Note: you don't need an account on Github to download/clone repositories, but having an acccount allows you to save repositories yourself and is recommended.

\slide{Demo: Ansible, Python, Git!}

\begin{quote}
  Running Git will allow you to clone repositories from others easily. This is a great way to get new software packages, and share your own.

  Git is the name of the tool, and Github is a popular site for hosting git repositories.
\end{quote}

Henrik will show:
\begin{list2}
\item Go to \link{https://github.com/kramse/kramse-labs}
\item Lets explore while we talk
\item Install Git, Ansible and Python manually using apt
\item Then I will use Git to clone a repository
\item Using Ansible I can then run a playbook
\end{list2}


\slide{Demo: output from running a git clone}

\begin{alltt}\footnotesize
user@Projects:tt$ {\bf git clone https://github.com/kramse/kramse-labs.git}
Cloning into 'kramse-labs'...
remote: Enumerating objects: 283, done.
remote: Total 283 (delta 0), reused 0 (delta 0), pack-reused 283
Receiving objects: 100% (283/283), 215.04 KiB | 898.00 KiB/s, done.
Resolving deltas: 100% (145/145), done.

user@Projects:tt$ {\bf cd kramse-labs/}

user@Projects:kramse-labs$ {\bf ls}
LICENSE  README.md  core-net-lab  lab-network  suricatazeek  work-station
user@Projects:kramse-labs$ git pull
Already up to date.
\end{alltt}

for reference at home later


\slide{Exercise CHAOS: Don't Panic -- have fun learning}

\hlkimage{6cm}{dont-panic.png}

\begin{quote}
“It is said that despite its many glaring (and occasionally fatal) inaccuracies, the Hitchhiker’s Guide to the Galaxy itself has outsold the Encyclopedia Galactica because it is slightly cheaper, and because it has the words ‘DON’T PANIC’ in large, friendly letters on the cover.”
\end{quote}
Hitchhiker’s Guide to the Galaxy, Douglas Adams

\slide{Your lab setup}

\begin{list2}
\item Go to GitHub, Find user Kramse, click through kramse-labs
\item Look into the instructions for the Virtual Machine -- Debian only

\item Get the lab instructions, from\\ {\footnotesize\url{https://github.com/kramse/kramse-labs/}}
\end{list2}

{\bf TODAY ALL EXERCISES after installing the basic VMs ARE OPTIONAL!}

\exercise{ex:sw-downloadDEB}
\exercise{ex:sw-basicDebianVM}
\exercise{ex:sw-basicLinuxetc}
\exercise{ex:debian-firewall}

\exercise{ex:git-tutorial}
\exercise{ex:small-python}




\slide{Let's get started }

We will now go through a mix of things which either are incident response, or related to incident response

Some things will be repeated later


\slide{Risk management defined}

\hlkimage{20cm}{shon-harris-risk-management.png}

Source: Shon Harris \emph{CISSP All-in-One Exam Guide}



\slide{Security Controls and Frameworks}

\begin{list1}
\item Multiple exist
\vskip 1cm
\begin{list2}
\item CIS controls Center for Internet Security (CIS) \link{https://www.cisecurity.org}
\item PCI Best Practices for Maintaining PCI DSS Compliance v2.0 Jan 2019
\item NIST Cybersecurity Framework (CSF)\\
Framework for Improving
Critical Infrastructure Cybersecurity\\ \link{https://www.nist.gov/cyberframework}\\
\link{https://csrc.nist.gov/publications/sp800} - SP800 series
\item National Security Agency (NSA)\\
\link{https://www.nsa.gov/Research/}
\item NSA security configuration guides\\
\link{https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/}
\item Information Systems Audit and Control Association (ISACA)\\
\link{http://www.isaca.org/Knowledge-Center/}
\end{list2}
\end{list1}

\slide{Center for Internet Security CIS Controls}

\begin{quote}
  “A goal without a plan is just a wish.”\\
  ― Antoine de Saint-Exupéry
\end{quote}

\begin{quote}
  The CIS ControlsTM are a prioritized set of actions that collectively form a defense-in-depth set
of best practices that mitigate the most common attacks against systems and networks. The
CIS Controls are developed by a community of IT experts who apply their first-hand experience
as cyber defenders to create these globally accepted security best practices. The experts who
develop the CIS Controls come from a wide range of sectors including retail, manufacturing,
healthcare, education, government, defense, and others.
\end{quote}

Source: \link{https://www.cisecurity.org/} CIS-Controls-Version-7-1.pdf


\slide{SIEM}

%\hlkimage{}{}

\begin{quote}
{\bf Security information and event management (SIEM)} is a subsection within the field of computer security, where software products and services combine security information management (SIM) and security event management (SEM). They provide real-time analysis of security alerts generated by applications and network hardware.

  Vendors sell SIEM as software, as appliances, or as managed services; these products are also used to log security data and generate reports for compliance purposes.[1]

  The term and the initialism SIEM was coined by Mark Nicolett and Amrit Williams of Gartner in 2005.[2]
\end{quote}
Source: \link{https://en.wikipedia.org/wiki/Security_information_and_event_management}

\begin{list2}
  \item Note: there are alerting examples towards the bottom of the page, with sources
  \item Closely related to log management, incident response
\end{list2}


\slide{SOC}

%\hlkimage{}{}

\begin{quote}
An information security operations center (ISOC or SOC) is a facility where enterprise information systems (web sites, applications, databases, data centers and servers, networks, desktops and other endpoints) are monitored, assessed, and defended.

...

A {\bf security operations center (SOC)} can also be called a security defense center (SDC), security analytics center (SAC), network security operations center (NSOC),[3] security intelligence center, cyber security center, threat defense center, security intelligence and operations center (SIOC). In the Canadian Federal Government the term, infrastructure protection center (IPC), is used to describe a SOC.
\end{quote}
Source: \link{https://en.wikipedia.org/wiki/Information_security_operations_center}

%\begin{list2}
%\item We have a whole book about SOCs, but I skipped the introductory chapters!
%\item If you need to build a SOC, that is great source of information
%\end{list2}




\slide{Subjects: Incident Response}

\hlkimage{5cm}{homer-end-is-near.jpg}

\begin{list1}
\item Context, what are the threats, what are the answers we want from the SIEM and Logs

\item What are the common cases, where we use the data?

\begin{list2}
\item Incident Response
\item Computer Emergency Response Team (CERT) and Computer Security Incident Response Teams (CSIRT)
\item Security Departments
\item GDPR Data protection
\item Computer Forensics
\end{list2}

\end{list1}


\slide{Incident Handling, phases}

The procedures developed for incident response must cover the complete life-cycle

\begin{list2}
\item  Preparation for an attack, establish procedures and mechanisms for detecting and responding to attacks
\item  Identification of an attack, notice the attack is ongoing
\item  Containment (confinement) of the attack, limit effects of the attack as much as possible
\item  Eradication of the attack, stop attacker, block further similar attacks
\item  Recovery from the attack, restore system to a secure state
\item  Follow-up to the attack, include lessons learned  improve environment
\end{list2}


\slide{Crafting the InfoSec Playbook}


This book will help you to answer common questions:
\begin{list2}
\item How do I find bad actors on my network?
\item How do I find persistent attackers?
\item How can I deal with the pervasive malware threat?
\item How do I detect system compromises?
\item How do I find an owner or responsible parties for systems under my protection?
\item How can I practically use and develop threat intelligence?
\item How can I possibly manage all my log data from all my systems?
\item How will I benefit from increased logging—and not drown in all the noise?
\item How can I use metadata for detection?
\end{list2}
Source: \emph{Crafting the InfoSec Playbook: Security Monitoring and Incident Response Master Plan}\\
 by Jeff Bollinger, Brandon Enright, and Matthew Valites ISBN: 9781491949405


\slide{MITRE ATT\&CK framework}

\hlkimage{14cm}{mitre-attack.png}

Source: \link{https://attack.mitre.org/} Great resource for attack categorization

\slide{Incident Response Checklists}
\hlkimage{9cm}{incident-handling-checklist.png}

This checklist is from the NIST document
\emph{Computer Security Incident Handling Guide: Recommendations of the National Institute
of Standards and Technology}, NIST Special Publication 800-61
Revision 2, August 2012.

\slide{CIS Controls also recommend Incident Response}

\begin{quote}{\bf
CIS Control 19:}\\
Incident Response and Management Protect the organization’s information, as well as its reputation, by developing and implementing an incident response infrastructure (e.g., plans, defined roles, training, communications, management oversight) for quickly discovering an attack and then effectively containing the damage, eradicating the attacker’s presence, and restoring the integrity of the network and systems.
\end{quote}

Source:
Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf
from \link{https://www.cisecurity.org/controls/}



\slide{Anatomy of an Auditing System}


Sample logs from login with Secure Shell (SSH) and performing the command \verb+sudo su -+
\begin{alltt}
Jun  5 11:53:15 pumba sshd[64505]: Accepted publickey for hlk from 79.142.233.18 port 43902
 ssh2: ED25519 SHA256:l8OJMcywyBcraJiCWJ06uZ2yzHfu0VuiArqVvlVyfEI

Jun  5 11:53:19 pumba sudo:      hlk : TTY=ttyp2 ; PWD=/home/hlk ; USER=root ; COMMAND=/usr/bin/su -
\end{alltt}

\begin{list1}
\item Example systems: Unix syslog, IBM main frame RACF and Windows Event Logs service
\item Logs should be protected and considered confidential information
\end{list1}



\slide{Anatomy of an Auditing System}

When data has been gathered it should be analyzed.

\begin{itemize}
\item {\bf Logger functions} - collect
\item {\bf Analyzer} - analyze it, creating dashboard can provide some insights
\item {\bf Notifier} - report results by email or other means
\item Example systems Windows Event Logs service can inform of successful and failed logins, both should be collected
\item Logs should be protected and considered confidential information, by sending it to a centralized system with a high security level protects it
\end{itemize}

Modern systems exist to take all data from logging and provide high capacity storage, searching and sorting.

\slide{Why Elasticsearch}

\hlkimage{8cm}{illustrated-screenshot-hero-siem-500x730.png}
Screenshot from \url{https://www.elastic.co/siem}

Recommend building a proof-of-concept infrastructure using the Elastic stack and gather experience with logging. This can be done without a license fee and the organization can then see what works and doesn't. Then using the experiences as input an informed decision can be made, to continue with this as a home grown logging and auditing solution, or buy a premade one.


\slide{Technologies used in this course}

The following tools and environments are examples that may be introduced in this course:

\begin{list2}
\item Programming languages and frameworks Java, Python, regular expressions
\item Development environments -- choose your own IDE / Editor -- I use {\bf Pulsar}
\item Networking and network protocols: TCP/IP, HTTP, DNS, Netflow
\item Formats XML, JSON, CSV, raw text, web scraping
\item Web technologies and services: REST, API, HTML5, CSS, JavaScript
\item Tools like cURL, Zeek, Git and Github
\item Message queueing systems: MQ and Redis could be added
\item Aggregated example platforms: Elastic stack, logstash, elasticsearch, kibana, grafana, Filebeat
\item Cloud and virtualisation Docker, Kubernetes, Azure, AWS, microservices -- can be added
\end{list2}

\centerline{This list is not complete or a promise }


\slide{OSI and Internet}

\hlkimage{10cm,angle=90}{images/compare-osi-ip.pdf}

\centerline{Data on all layers}

\slide{Networking in TCP/IP}

\hlkimage{10cm}{arp-basic.pdf}

\begin{list2}
\item Everything uses TCP/IP today, more or less.
\item Clients make requests, receives responses
\item HyperText Transfer Protocol (HTTP) is an example
\item All devices shown can produce logs and events
\end{list2}


\slide{Sources: Network overview}

\hlkimage{15cm}{sample-ip-network.pdf}

\begin{quote}

\end{quote}

\begin{list2}
\item Internet, routers, firewalls, switches, clients and servers (Wi-Fi not shown)
\end{list2}


\slide{Sources: Strategy for implementing identification and detection}

We recommend that the following strategy is used for implementing identification and detection -- logging:
\begin{enumerate}
\item[\faSquareO] Enable system logging from servers
\item[\faSquareO] Enable system logging from network devices
\item[\faSquareO] Enable logging from client devices
\item[\faSquareO] Centralize logging
\item[\faSquareO] Add search facilities and dashboards
\item[\faSquareO] Perform system audits manually or automatically
\item[\faSquareO] Setup alerting and notification with procedures
\end{enumerate}




\slide{Intrusion Kill Chains}

\hlkimage{13cm}{crafting-cip-kill-chain.png}

\begin{list2}
\item See also \emph{Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains}, Eric M. Hutchins , Michael J. Cloppert, Rohan M. Amin, Ph.D. Lockheed Martin Corporation\\{\footnotesize
 \link{https://www.lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf}}
\end{list2}



\slide{Detection Capabilities}


Security incidents happen, but what happens. One of the actions to reduce impact of incidents are done in preparing for incidents.

\begin{itemize}
\item \emph{Preparation} for an attack, establish procedures and mechanisms for detecting and responding to attacks
\end{itemize}

Preparation will enable easy {\bf identification} of affected systems, better {\bf containment} which systems are likely to be infected, {\bf eradication} what happened -- how to do the {\bf eradication} and {\bf recovery}.

\slide{Data Analysis Skills}

\begin{quote}
Although we could spend an entire book creating an exhaustive list of skills needed to be a good security data scientist, this chapter covers the following skills/domains that a data scientist will benefit from
knowing within information security:
\begin{list2}
\item Domain expertise—Setting and maintaining a purpose to the analysis
\item Data management—Being able to prepare, store, and maintain data
\item Programming—The glue that connects data to analysis
\item Statistics—To learn from the data
\item Visualization—Communicating the results effectively
\end{list2}
It might be easy to label any one of these skills as the most important, but in reality, the whole is greater than the sum of its parts. Each of these contributes a significant and important piece to the workings of
security data science.
\end{quote}

Source: \emph{Data-Driven Security: Analysis, Visualization and Dashboards} Jay Jacobs, Bob Rudis\\
ISBN: 978-1-118-79372-5 February 2014 \url{https://datadrivensecurity.info/} - short DDS



\slide{Don't use spreadsheets!}

%\hlkimage{}{}

\begin{quote}

\end{quote}

\begin{list2}
\item Spreadsheets are great for some tasks, but ...
\item They don't scale
\item The model can be broken -- edit a single formula
\item Rounding errors accumulate
\item Input and output are limited
\item Most functions require manual work
\end{list2}





\slide{Data overview JSON}

\begin{quote}
JavaScript Object Notation (JSON, pronounced /ˈdʒeɪsən/; also /ˈdʒeɪˌsɒn/[note 1]) is an open-standard file format or data interchange format that uses {\bf human-readable text} to transmit data objects consisting of attribute–value pairs and array data types (or any other serializable value). It is a very common data format, with a diverse range of applications, such as serving as replacement for XML in AJAX systems.[6]
\end{quote}
Source: \url{https://en.wikipedia.org/wiki/JSON}

\begin{list2}
\item I like JSON much better than XML
\item Many web services can supply data in JSON format
\end{list2}

\slide{JSON example}

\begin{minted}[fontsize=\footnotesize]{json}
{
  "first name": "John",
  "last name": "Smith",
  "age": 25,
  "address": {
    "street address": "21 2nd Street",
    "city": "New York",
    "state": "NY",
    "postal code": "10021"
  },
  "phone numbers": [
    {
      "type": "home",
      "number": "212 555-1234"
    },
  ],
}
\end{minted}

\begin{list2}
\item This is a basic JSON document, new data attribute-value pairs can be added\\
Source: \url{https://en.wikipedia.org/wiki/JSON}
\end{list2}




\slide{Python and REST}

\inputminted{python}{programs/rest-1.py}

\begin{list2}
\item  Lets try to use some Python to access a REST service.
\item  We will use the JSONPlaceholder which is a free online REST API:
\link{https://jsonplaceholder.typicode.com/}
\item Start at the site: \link{https://jsonplaceholder.typicode.com/guide.html} and try running a few of the examples with your browser
\item Then try using the same URLS in the Requests HTTP library from Python,\\
\link{https://requests.readthedocs.io/en/master/}
\end{list2}


\slide{Note about frameworks and libraries}

\begin{minted}[fontsize=\footnotesize]{python}
import xml.etree.ElementTree as ET
tree = ET.parse('testfile.xml')
root = tree.getroot()

print(root.tag)
print('Nmap version: \t\t{:s} '.format(root.attrib['version']))
print('Nmap started: \t\t{:s} '.format(root.attrib['startstr']))
print('Nmap command line: \t{:s} '.format(root.attrib['args']))

hosts = tree.findall('./host')
for host in hosts:
    print(host.tag)
    print(host.attrib)
    for hostvalues in host:
        print(hostvalues.tag)
        print(hostvalues.attrib)
\end{minted}

\begin{list2}
\item Dont import JSON or XML using home made programs
\item Example uses xml.etree.ElementTree from Python \url{https://docs.python.org/3.7/library/xml.etree.elementtree.html}
\end{list2}

\slide{Convert XML to JSON}

\begin{minted}[fontsize=\footnotesize]{python}
import xml.etree.ElementTree as ET
import json
def etree_to_dict(t):
    d = {t.tag : map(etree_to_dict, t.getchildren())}
    d.update(('@' + k, v) for k, v in t.attrib.items())
    d['text'] = t.text
    return d

tree = ET.parse('testfile.xml')
root = tree.getroot()
mydict = etree_to_dict(root)
print(type(tree))
print(type(root))
print(type(mydict))

print(mydict)

with open('testfile.json', 'w') as json_file:
  json.dump(mydict, json_file)
\end{minted}

Converting using Python is easy



\slide{Side note: Zeek Security Monitor handles formats differently}

Zeek has files formatted with a header:
\begin{alltt}\footnotesize
#fields ts      uid     id.orig_h       id.orig_p       id.resp_h       id.resp_p       proto   trans_id
        rtt     query   qclass  qclass_name     qtype   qtype_name      rcode   rcode_name      AA
        TC      RD      RA      Z       answers TTLs    rejected

1538982372.416180	CD12Dc1SpQm42QW4G3	10.xxx.0.145	57476	10.x.y.141	53	udp	20383
	0.045021	www.dr.dk	1	C_INTERNET	1	A	0	NOERROR	F	F	T	T	0
   www.dr.dk-v1.edgekey.net,e16198.b.akamaiedge.net,2.17.212.93	60.000000,20409.000000,20.000000	F
\end{alltt}

Note: this show ALL the fields captured and dissected by Zeek, there is a nice utility program zeek-cut which can select specific fields:

\begin{alltt}\small
root@NMS-VM:/var/spool/bro/bro# cat dns.log | zeek-cut -d ts query answers | grep dr.dk
2018-10-08T09:06:12+0200	www.dr.dk	www.dr.dk-v1.edgekey.net,e16198.b.akamaiedge.net,2.17.212.93
\end{alltt}

Can also just use JSON now via Filebeat


\slide{Metadata -- enrichment}

\hlkimage{10cm}{crafting-security-playbook-metadata.png}

Source: picture from Crafting the InfoSec Playbook, CIP

Metadata + Context


\slide{Example plot 6-17 }

\hlkimage{10cm}{jay-service-discovery.png}
Source: DDS 6. Visualizing Security Data

\begin{list2}
\item Interesting graph, and interesting results Changing away from standard ports delay attackers!
\end{list2}


\slide{Applied Security Visualization examples}


\hlkimage{13cm}{applied-security-visualization-firewall.png}

Source: Firewall Report in \emph{Applied security visualization}, Rafael Marty, 2009

\slide{Applied Security Visualization examples}


\hlkimage{10cm}{applied-security-visualization-flow.png}

Source: Network Flow Data in \emph{Applied security visualization}, Rafael Marty, 2009



\slide{Drill down process}

%\hlkimage{}{}

\begin{quote}

\end{quote}

\begin{enumerate}
\item Get an overview
\item Research top talkers,
\item When identified and handled, remove with filter \verb+not host 10.1.2.3+
\item Look at the next ones
\end{enumerate}

Look into details, lookup hostnames -- hopefully your tool allows some help



\slide{Elasticsearch example systems}

%\hlkimage{}{}

\begin{quote}\small
ElasticSearch consumes practically anything you give it and provides straightforward ways to ask it questions and get data out of it. You just need to feed it semi- or unstructured data and fold in some domain intelligence to enable smart indexing. It works its multi-node NoSQL magic in conjunction with a layer of full-text searching to give you almost instantaneous query results even for large amounts of data.\\
Source: DDS 8. Breaking Up with Your Relational Database
\end{quote}

\begin{list2}
\item Elasticsearch SIEM -- from Elastic, including Elastic Common Schema (ECS)\\
  \link{https://github.com/elastic/ecs}
\item Wazuh -- agent for clients, log events, integrity protection etc.
\item HELK -- all-in one hunting system
\item ElastiFlow -- netflow system
\item Arkime (renamed recently from Moloch) -- packet capture
\end{list2}

Lots of commercial systems, and lots of companies providing cloud logging platform

\slide{Architecture}

\hlkimage{17cm}{elastic-stack-buffered.png}
\begin{list2}
\item Real production environments often add some buffering in between
\item Allows the ingestion to become more smooth, no lost messages
\end{list2}


\slide{ElastiFlow}

\hlkimage{10cm}{elastiflow.png}

\begin{quote}
  ElastiFlow™ provides network flow data collection and visualization using the Elastic Stack (Elasticsearch, Logstash and Kibana). It supports Netflow v5/v9, sFlow and IPFIX flow types (1.x versions support only Netflow v5/v9).
\end{quote}
Source: Picture and text from \link{https://github.com/robcowart/elastiflow}



\slide{Packetbeat}

\hlkimage{10cm}{demo-siem-setup-packetbeat.pdf}


\begin{list2}
\item By installing packetbeat and doing network mirroring from the network switch, we can gather a lot of information
\item Packetbeat supports Elastic Common Schema (ECS) \link{https://www.elastic.co/beats/packetbeat}
\item ICMP (v4 and v6)
DHCP (v4)
DNS
HTTP
AMQP 0.9.1
Cassandra
Mysql
PostgreSQL
Redis
Thrift-RPC
MongoDB
Memcache
NFS
TLS
SIP/SDP (beta)
\end{list2}




\slide{Attack Lifecycle}

\hlkimage{8cm}{socbook-targeted-attack.png}

\begin{quote}
Many breaches discovered are caused by a system having a known vulnerability exploited before it is properly patched.
\end{quote}

Source: Mandiant’s Targeted Attack Lifecycle, SOC chapter 7. vuln management

\begin{list2}
\item Chapter contains lots of references
\item Also chapter links inventory controls with active discovery tools and mitigating
\item Mentions Threat Feeds, which should be integrated into SIEM and/or organizations
\item You need to stay up-to-date on current threats, and be able to search for signs in your own network
\end{list2}





% Summary and conclusion


\slide{Conlusion: chaos and and panic}

\hlkimage{5cm}{dont-panic.png}
\begin{list2}
\item We started out fine, structured approach!
\item We got interrupted ... which happens a lot
\item We didn't finish! Again this is very common in real life
\item Microsoft alone release patches and updates for more than 100 vulnerabilities a month
\item All software has security problems, and need updates!
\end{list2}


\slide{Incident Log and financial}

Take a piece of paper or a computer
\begin{list2}
\item We just got interrupted in our important job with the CIS controls
\item We now need to fill out an Incident Log and calculate the cost
\item When an incident happens it must be dealth with effeciently
\item If you don't have security procedures it will often be longer lasting and more expensive
\end{list2}

\slide{March 2021: ProxyLogon/ProxyShell CVE-2021-26855 CVSS:3.0 9.1 / 8.4}
\begin{quote}
In March 2021, both Microsoft and IT Professionals had a major headache in the form of an Exchange zero-day commonly known as ProxyLogon. The vulnerability, widely considered the {\bf most critical to ever hit Microsoft Exchange}, was quickly exploited in the wild by suspected state-sponsored threat actors, with US government and military systems identified as the most targeted sectors. {\bf Ransomware variants such as DoejoCrypt were soon actively exploiting unpatched Exchange instances}, attempting to monetise the vulnerability.

A follow-up exploit, dubbed ProxyShell, was evolutionary in nature and targeted on-premise Client Access Servers (CAS) in {\bf all supported versions of Exchange Server.} Due to the {\bf remotely accessible nature of Exchange CAS, any unpatched instances would be vulnerable to Remote Code Execution. High profile victims included the European Banking Authority and the Norwegian Parliament.}
\end{quote}
Source - for this description:\\
\link{https://chessict.co.uk/resources/blog/posts/2022/january/2021-top-security-vulnerabilities/}


\slide{ProxyLogon CVE-2021-26855 CVSS:3.0 9.1 / 8.4}

\begin{quote}
ProxyLogon is the formally generic name for CVE-2021-26855, a vulnerability on Microsoft Exchange Server that allows an attacker bypassing the authentication and impersonating as the admin. We have also chained this bug with another post-auth arbitrary-file-write vulnerability, CVE-2021-27065, to get code execution. All affected components are vulnerable by default!

As a result, {\bf an unauthenticated attacker can execute arbitrary commands on Microsoft Exchange Server through an only opened 443 port!}
\end{quote}

Sources: \link{https://proxylogon.com/}\\
\link{https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855}





\slide{June 2021: PrintNightmare CVE-2021-34527 CVSS:3.0 8.8 / 8.2}
\begin{quote} \small
In June, Microsoft released a critical security update to address weaknesses in the Printer Spooler service on Windows desktop and server platforms. Unfortunately, it was released out-of-band outside of the standard patch Tuesdays due to the severity. Microsoft even released patches for Windows 7, an supported operating system that does not normally receive updates.

Initially categorised by Microsoft as a local privilege escalation on Windows, security researchers subsequently identified an additional {\bf Remote Code Execution (RCE)} vector resulting in an updated advisory from Microsoft. As ever, the ability to test and deploy patches in a time-sensitive manner is key to minimising the impact of such vulnerabilities.

Additionally, PrintNightmare had the additional horror factor of dropping during the {\bf summer holiday season in the northern hemisphere}. Our consultants continue to see systems vulnerable to PrintNightmare on client engagements, which can be trivially leveraged to obtain privilege escalation on unpatched Windows systems.
\end{quote}

Source - for this description:\\
\link{https://chessict.co.uk/resources/blog/posts/2022/january/2021-top-security-vulnerabilities/}

See also \link{https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527}

Note: this incident happened during summer time, vacations etc, double the cost.


\slide{September 2021: ForcedEntry}
\begin{quote}\small
{\bf Apple didn’t escape the wrath of critical zero-day vulnerabilities in 2021}, with ForcedEntry made public in September. The concern was not just that it could escape in-built sandbox controls and be leveraged against {\bf almost all iOS versions at the time}, but also that it was in the form of a {\bf one-click exploit meaning that no user interaction was needed}. A threat actor would simply require the target victim’s phone number or email address to send a weaponised GIF. {\bf Furthermore, iMessage was affected on macOS and watchOS, giving the exploit a significant attack surface of well over a billion devices.}

An analysis released at the end of 2021 confirmed a highly complex exploit which is believed to have been created by the NSO Group, creators of the Pegasus platform, albeit with the sophistication of nation-state actors. Given the nature of the attack and the level of complexity, high profile individuals are likely to be the intended targets of such exploits, only used sparingly against targeted victims.
\end{quote}

Source - for this description:\\
\link{https://chessict.co.uk/resources/blog/posts/2022/january/2021-top-security-vulnerabilities/}

See also
\link{https://en.wikipedia.org/wiki/FORCEDENTRY}



\slide{November 2021: Log4Shell}
\begin{quote}\small
It would not be possible to discuss 2021 in the context of vulnerabilities without the mention of Log4Shell. {\bf A widely used Java-based logging library caused headaches for Security professionals worldwide}. Many scrambled to quantify their use of Log4j within their estates.

A zero-day exploit quickly followed, confirming the worst - {\bf Remote Code Execution (RCE) was indeed possible.} However, what made the nature of the vulnerability even more challenging was the ability to exploit a backend logging system from an unaffected front end host. For example, an attacker can craft a weaponised log entry on a mobile app or webserver not running Log4j. The attacker could make their way through to backend middleware itself running Log4j, which significantly extends the attack surface of the vulnerability.

The NCSC even took the step of recommending the update was immediately applied, whether or not Log4Shell was known to be in use. As is commonly the case with critical vulnerabilities, two successive Log4j patches were subsequently released in the week following the original addressing Denial of Service (DoS) and a further RCE. This further increased workloads of Security and IT teams just as they thought the worst of 2021 had been and gone.
\end{quote}
Source - for this description:\\
\link{https://chessict.co.uk/resources/blog/posts/2022/january/2021-top-security-vulnerabilities/}

See also \link{https://en.wikipedia.org/wiki/Log4Shell}



\slide{March 2022: Dirty pipe Linux CVE-2022-0847}

%\hlkimage{}{}

\begin{quote}
This is the story of CVE-2022-0847, a vulnerability in the {\bf Linux kernel since 5.8} which allows overwriting data in arbitrary read-only files. This leads to {\bf privilege escalation because unprivileged processes can inject code into root processes.}

It is similar to CVE-2016-5195 “Dirty Cow” but is easier to exploit.

The vulnerability was fixed in Linux 5.16.11, 5.15.25 and 5.10.102.
\end{quote}
Sources:
\link{https://dirtypipe.cm4all.com/}
\link{https://thestack.technology/dirty-pipe-exploited-linux-vulnerability-cve-2022-0847/}
\link{https://access.redhat.com/security/cve/CVE-2022-0847}




\slide{April 2022: Lenovo UEFI }
\begin{quote}
ESET researchers have discovered and analyzed three vulnerabilities affecting various Lenovo consumer laptop models. The first two of these vulnerabilities – CVE-2021-3971, CVE-2021-3972 – affect UEFI firmware drivers originally meant to be used only during the manufacturing process of Lenovo consumer notebooks. Unfortunately, they were mistakenly included also in the production BIOS images without being properly deactivated. These affected firmware drivers can be activated by attacker to directly disable SPI flash protections (BIOS Control Register bits and Protected Range registers) or the UEFI Secure Boot feature from a privileged user-mode process during OS runtime. It means that exploitation of these vulnerabilities would allow attackers to deploy and successfully execute SPI flash or ESP implants, like LoJax or our latest UEFI malware discovery ESPecter, on the affected devices.
\end{quote}

Source:

also:
\link{https://www.welivesecurity.com/2022/04/19/when-secure-isnt-secure-uefi-vulnerabilities-lenovo-consumer-laptops/}

See also:
\link{https://www.bleepingcomputer.com/news/security/lenovo-uefi-firmware-driver-bugs-affect-over-100-laptop-models/}

\slidenext{Buy the books! Create your VMs}

\end{document}
