\documentclass[Screen16to9,17pt]{foils}
\usepackage{kea-slides}

\externaldocument{communication-and-network-security-exercises}
\selectlanguage{english}

\begin{document}

\mytitlepage
{1. TCP/IP and Security in TCP/IP protocol suite}
{Communication and Network Security \the\year}

\slide{Goals for today}

\hlkimage{6cm}{thomas-galler-hZ3uF1-z2Qc-unsplash.jpg}

\begin{list2}
\item Show how some problems in networks, and especially LAN are common security problems
\item TCP/IP is everywhere and some problems categories have existed for centuries
\item Even switching from IPv4 to IPv6 will not solve all
\end{list2}

Photo by Thomas Galler on Unsplash


\slide{Plan for today}

\begin{list1}
\item Subjects
\begin{list2}
\item TCP/IP
\item Some security problems in the TCP/IP protocol suite
\item Understand basic IP protocols and inherent security problems
\item Make sure we have a common vocabulary in this course, like CIDR
\end{list2}
\item Exercises
\begin{list2}
\item Wireshark and Tcpdump 15 min
\item Capturing TCP Session packets 10 min
\item Whois databases 15 min
\item Using ping and traceroute 10 min
\item DNS and Name Lookups 10 min
\end{list2}
\end{list1}

\slide{Reading Summary}

Read
\begin{list2}
\item PPA chapters 1,2,3
\item Chapter 1: Packet Analysis and Network Basics
\item Chapter 2: Tapping into the Wire
\item Chapter 3: Introduction to Wireshark
\item ANSM chapter 13: Packet Analysis
\end{list2}
Skim:
\begin{list2}
\item
\emph{Security problems in the TCP/IP protocol suite}, S. M. Bellovin \url{https://www.cs.columbia.edu/~smb/papers/ipext.pdf}
\item \emph{A Look Back at “Security Problems in the TCP/IP Protocol Suite”} \url{https://www.cs.columbia.edu/~smb/papers/acsac-ipext.pdf}
\end{list2}


\slide{Course Network}

\hlkimage{5cm}{sample-network.png}

\begin{list1}
\item Our network will be similar to regular networks, as found in enterprises
\item We have an isolated network, allowing us to sniff and mess with hacking tools.
\end{list1}


\slide{Internet Today}

\hlkimage{10cm}{images/server-client.pdf}

\begin{list1}
\item Clients and servers, roots in the academic world
\item Protocols are old, some more than 20 years
\item Very little is encrypted, mostly HTTPS
\end{list1}

\slide{Internet is Open Standards!}

{\hlkbig \color{titlecolor}
We reject kings, presidents, and voting.\\
We believe in rough consensus and running code.\\
-- The IETF credo Dave Clark, 1992.}

\begin{list1}
\item Request for comments - RFC - er en serie af dokumenter
\item RFC, BCP, FYI, informational\\
de første stammer tilbage fra 1969
\item Ændres ikke, men får status Obsoleted når der udkommer en nyere
  version af en standard
\item Standards track:\\
Proposed Standard $\rightarrow$ Draft Standard $\rightarrow$ Standard
\item  Åbne standarder = åbenhed, ikke garanti for sikkerhed
\end{list1}

\slide{Hvad er Internet}

\begin{list1}
\item Kommunikation mellem mennesker!
\item Baseret på TCP/IP
\begin{list2}
\item best effort
\item packet switching (IPv6 kalder det packets, ikke datagram)
\item forbindelsesorienteret, \emph{connection-oriented}
\item forbindelsesløs, \emph{connection-less}
\end{list2}
\end{list1}

RFC-1958:
\begin{quote}
 A good analogy for the development of the Internet is that of
 constantly renewing the individual streets and buildings of a city,
 rather than razing the city and rebuilding it. The architectural
 principles therefore aim to provide a framework for creating
 cooperation and standards, as a small "spanning set" of rules that
 generates a large, varied and evolving space of technology.
\end{quote}

\slide{IP netværk: Internettet historisk set}

\begin{list2}
\item[1961]  L. Kleinrock, MIT packet-switching teori
\item[1962]  J. C. R. Licklider, MIT - notes
\item[1964]  Paul Baran: On Distributed Communications
\item[1969]  ARPANET startes 4 noder
\item[1971]  14 noder
\item[1973]  Arbejde med IP startes
\item[1973]  Email er ca. 75\% af ARPANET traffik
\item[1974]  TCP/IP: Cerf/Kahn: A protocol for Packet
        Network Interconnection
\item[1983]  EUUG $\rightarrow$ DKUUG/DIKU forbindelse
\item[1988]  ca. 60.000 systemer på Internettet
        The Morris Worm rammer ca. 10\%
\item[2000]  Maj I LOVE YOU ormen rammer
%\item[2001]  August Code Red ~600.000 servere
\item[2002]  Ialt ca. 130 millioner på Internet
\end{list2}

\slide{Internet historisk set -  anno 1969}
\hlkimage{6cm}{1969_4-node_map.png}
%size 2

\begin{list2}
\item Node 1: University of California Los Angeles
\item Node 2: Stanford Research Institute
\item Node 3: University of California Santa Barbara
\item Node 4: University of Utah
%\item Kilde: \link{http://www.zakon.org/robert/internet/timeline/}
\end{list2}

\slide{Hvad er Internet hosts }

\hlkimage{15cm}{potaroo-ipv4-address-report.png}
\centerline{Cumulative RIR address assignments, per RIR}

\begin{list1}
\item Source:
IPv4 Address Report - 28-Jan-2019
\link{http://www.potaroo.net/tools/ipv4/}
\end{list1}

\slide{Fælles adresserum}

\vskip 2 cm
\hlkimage{13cm}{IP-address.pdf}

\begin{list1}
\item Hvad kendetegner internet idag
\item Der er et fælles adresserum baseret på 32-bit adresser, example 10.0.0.1
\end{list1}

\slide{IPv4 addresser og skrivemåde}

\begin{alltt}
hlk@bigfoot:hlk$ ipconvert.pl 127.0.0.1
Adressen er: 127.0.0.1
Adressen er: 2130706433
hlk@bigfoot:hlk$ ping 2130706433
PING 2130706433 (127.0.0.1): 56 data bytes
64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.135 ms
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.144 ms
\end{alltt}

\begin{list1}
\item IP-adresser skrives typisk som decimaltal adskilt af punktum
\item Kaldes {\bf dot notation}: 10.1.2.3
\item Kan også skrive som oktal eller heksadecimale tal
\end{list1}


\slide{Internet ABC}

\begin{list1}
\item Tidligere benyttede man klasseinddelingen af IP-adresser: A, B, C, D og E
\item Desværre var denne opdeling ufleksibel:
\begin{list2}
\item A-klasse kunne potentielt indeholde 16 millioner hosts
\item B-klasse kunne potentielt indeholder omkring 65.000 hosts
\item C-klasse kunne indeholde omkring 250 hosts
\end{list2}
\item Derfor bad de fleste om adresser i B-klasser - så de var ved at løbe tør!
\item D-klasse benyttes til multicast
\item E-klasse er blot reserveret
\item Se evt. \link{http://en.wikipedia.org/wiki/Classful\_network}
\end{list1}

\vskip 5mm
\centerline{\bf Stop saying C, say /24}

\slide{CIDR Classless Inter-Domain Routing}

\hlkimage{13cm}{CIDR-aggregation.pdf}

\begin{list1}
\item Subnetmasker var oprindeligt indforstået
\item Man tildelte flere C-klasser - spare de resterende B-klasser - men det betød en routing table explosion
\item Idag er subnetmaske en sammenhængende række 1-bit der angiver størrelse på nettet
\item 10.0.0.0/24 betyder netværket 10.0.0.0 med subnetmaske 255.255.255.0
\item CIDR Classless Inter-Domain Routing RFC-1519
\end{list1}


\slide{IPv4 addresser opsummering}

\begin{list2}
\item Altid 32-bit adresser
\item Skrives typisk med 4 decimaltal dot notation 10.1.2.3
\item CIDR notation 10.0.0.0/8 -
  fremfor 10.0.0.0 med subnet maske 255.0.0.0
\item Specielle adresser\\
127.0.0.1 localhost/loopback\\
0.0.0.0  default route
\item RFC-1918 angiver private adresser som alle kan bruge
\end{list2}

\slide{RFC-1918 Private Networks}

\begin{list1}
\item Der findes et antal adresserum som alle må benytte frit:
\begin{list2}
\item 10.0.0.0    -  10.255.255.255  (10/8 prefix)
\item 172.16.0.0  -  172.31.255.255  (172.16/12 prefix)
\item 192.168.0.0 -  192.168.255.255 (192.168/16 prefix)
\end{list2}
\item Address Allocation for Private Internets RFC-1918 adresserne!
\item NB: man må ikke sende pakker ud på internet med disse som afsender, giver ikke mening
\end{list1}

\slide{Documentation Prefix, IPv6 updates etc.}

Even documentation has its own prefix, RFC5737:
\begin{alltt}
The blocks 192.0.2.0/24 (TEST-NET-1), 198.51.100.0/24 (TEST-NET-2),
and 203.0.113.0/24 (TEST-NET-3) are provided for use in
documentation.
\end{alltt}

IPv6 listed in RFC3849 \verb+2001:DB8::/32+

See RFC3330 \emph{Special-Use IPv4 Addresses} which is updated by
RFC6890 \emph{Special-Purpose IP Address Registries} which in turn is updated by RFC8190\\
Use the web version of RFCs to surf back and forth \link{https://www.rfc-editor.org/rfc/rfc8190}



\slide{OSI og Internet modellerne}

\hlkimage{11cm,angle=90}{images/compare-osi-ip.pdf}

\slide{Netværkshardware}

\begin{list1}
\item Der er mange muligheder med IP netværk, IP kræver meget lidt
\item Ofte benyttede idag er:
\begin{list2}
\item Ethernet - varianter 10mbit, 100mbit, gigabit, 10G, 100G, 200G, 400G, ...
\item Wireless 802.11 teknologier
\item ADSL/ATM teknologier til WAN forbindelser
\item MPLS ligeledes til WAN forbindelser
\end{list2}
\item Ethernet kan bruge kobberledninger eller fiber
\item WAN forbindelser er typisk fiber på grund af afstanden mellem routere
\item Tidligere benyttede inkluderer: X.25, modem, FDDI, ATM, Token-Ring
\end{list1}

\slide{Ethernet stik, kabler og dioder}

\hlkimage{17cm}{ethernetLights.jpg}

\centerline{Dioder viser typisk om der er link, hastighed samt aktivitet}

\slide{Trådløse teknologier}

\hlkimage{10cm}{WCG200v2_med.jpg}

\begin{list1}
\item Et typisk 802.11 Access-Point (AP) der har Wireless og Ethernet stik/switch
\end{list1}

\slide{MAC adresser}
%\hlkimage{10cm}{apple-oui.png}

\begin{alltt}
00-03-93   (hex)        Apple Computer, Inc.
000393     (base 16)    Apple Computer, Inc.
                        20650 Valley Green Dr.
                        Cupertino CA 95014
                        UNITED STATES
\end{alltt}
\begin{list1}
\item Netværksteknologierne benytter adresser på lag 2
\item Typisk svarende til 48-bit MAC adresser som kendes fra Ethernet MAC-48/EUI-48
\item Første halvdel af adresserne er Organizationally Unique Identifier (OUI)
\item Ved hjælp af OUI kan man udlede hvilken producent der har produceret netkortet
\item \link{http://standards.ieee.org/regauth/oui/index.shtml}
\end{list1}



\slide{Bridges}

\begin{list1}
\item Ethernet er broadcast teknologi, hvor data sendes ud på et delt medie - Æteren
\item Broadcast giver en grænse for udbredningen vs hastighed
\item Ved hjælp af en bro kan man forbinde to netværkssegmenter på layer-2
\item Broen kopierer data mellem de to segmenter
\item Virker som en forstærker på signalet, men mere intelligent
\item Den intelligente bro kender MAC adresserne på hver side
\item Broen kopierer kun hvis afsender og modtager er på hver sin side
\end{list1}

Kilde: For mere information søg efter Aloha-net\\ \link{http://en.wikipedia.org/wiki/ALOHAnet}

\slide{En switch}

\hlkimage{12cm}{switch-1.pdf}

\begin{list1}
\item Ved at fortsætte udviklingen kunne man samle broer til en switch
\item En switch idag kan sende og modtage på flere porte samtidig, og med full-duplex
\item Bemærk performance begrænses af backplane i switchen
\end{list1}

\slide{Topologier og Spanning Tree Protocol}

\hlkimage{13cm}{switch-STP.pdf}

Se mere i bogen af Radia Perlman, \emph{Interconnections: Bridges, Routers, Switches, and Internetworking Protocols}

\slide{Core, Distribution og Access net}

\hlkimage{17cm}{core-dist.pdf}

\centerline{Det er ikke altid man har præcis denne opdeling, men den er ofte brugt}

\slide{Broer og routere}

\hlkimage{17cm}{wan-network.pdf}
\centerline{Fysisk er der en begrænsing for hvor lange ledningerne må være}


\slide{Pakker i en datastrøm}

\hlkimage{23cm}{ethernet-frame-1.pdf}
\begin{list1}
\item Ser vi data som en datastrøm er pakkerne blot et mønster lagt henover data
\item Netværksteknologien definerer start og slut på en frame
\item Fra et lavere niveau modtager vi en pakke, eksempelvis 1500-bytes fra Ethernet driver
\end{list1}

\slide{IPv4 pakken - header - RFC-791}

\begin{alltt}
\small
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Version|  IHL  |Type of Service|          Total Length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Identification        |Flags|      Fragment Offset    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Time to Live |    Protocol   |         Header Checksum       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Source Address                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Destination Address                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Example Internet Datagram Header
\end{alltt}


\slide{Fragmentering og PMTU}

\hlkimage{15cm}{fragments-1.pdf}
\begin{list1}
\item Hidtil har vi antaget at der blev brugt Ethernet med pakkestørrelse på 1500 bytes
\item Pakkestørrelsen kaldes MTU Maximum Transmission Unit
\item Skal der sendes mere data opdeles i pakker af denne størrelse, fra afsender
\item Men hvad hvis en router på vejen ikke bruger 1500 bytes, men kun 1000
\end{list1}

\slide{ICMP Internet Control Message Protocol}

\begin{list1}
\item Kontrolprotokol og fejlmeldinger
\item Nogle af de mest almindelige beskedtyper
\begin{list2}
\item echo
\item netmask
\item info
\end{list2}
\item Bruges generelt til \emph{signalering}
\item Defineret i RFC-792
\end{list1}

\centerline{\bf NB: nogle firewall-administratorer blokerer alt ICMP - det er forkert!}

\slide{ICMP beskedtyper}

\begin{list1}
\item Type
\begin{list2}
\item 0 = net unreachable;
\item 1 = host unreachable;
\item 2 = protocol unreachable;
\item 3 = port unreachable;
\item 4 = fragmentation needed and DF set;
\item 5 = source route failed.
\end{list2}
\item Ved at fjerne ALT ICMP fra et net fjerner man nødvendig funktionalitet!
\item Tillad ICMP types:
\begin{list2}
\item 3 Destination Unreachable
\item 4 Source Quench Message
\item 11 Time Exceeded
\item 12 Parameter Problem Message
\end{list2}
\end{list1}

\slide{Hvordan virker ARP?}

\begin{center}
\colorbox{white}{\includegraphics[width=18cm]{images/arp-basic.pdf}}
\end{center}

%server 00:30:65:22:94:a1\\
%client 00:40:70:12:95:1c\\
%hacker 00:02:03:04:05:06\\

\slide{Hvordan virker ARP? - 2}
\begin{list1}
\item {\bfseries ping 10.0.0.2} udført på server medfører
\item ARP Address Resolution Protocol request/reply:
  \begin{list2}
  \item ARP request i broadcast - Who has 10.0.0.2 Tell 10.0.0.1
  \item ARP reply (fra 10.0.0.2) 10.0.0.2 is at 00:40:70:12:95:1c
  \end{list2}
\item IP ICMP request/reply:
  \begin{list2}
    \item Echo (ping) request fra 10.0.0.1 til 10.0.0.2
\item Echo (ping) reply fra 10.0.0.2 til 10.0.0.1
\item ...
  \end{list2}
\item ARP udføres altid på Ethernet før der kan sendes IP trafik
\item (kan være RARP til udstyr der henter en adresse ved boot)
\end{list1}


\slide{ARP cache}

\begin{alltt}
\small
hlk@bigfoot:hlk$ arp -an
? (10.0.42.1) at 0:0:24:c8:b2:4c on en1 [ethernet]
? (10.0.42.2) at 0:c0:b7:6c:19:b on en1 [ethernet]
\end{alltt}

\begin{list1}
\item ARP cache kan vises med kommandoen \verb+arp -an+
\item -a viser alle
\item -n viser kun adresserne, prøver ikke at slå navne op - typisk hurtigere
\item ARP cache er dynamisk og adresser fjernes automatisk efter 5-20 minutter hvis de ikke bruges mere
\item Læs mere med \verb+man 4 arp+
\end{list1}

\slide{Basale testværktøjer TCP - Telnet og OpenSSL}

\begin{list1}
\item Telnet blev tidligere brugt til login og er en klartekst forbindelse
over TCP
\item Telnet kan bruges til at teste forbindelsen til mange ældre serverprotokoller som benytter ASCII kommandoer
\begin{list2}
\item \verb+telnet mail.kramse.dk 25+ laver en forbindelse til port 25/tcp
\item \verb+telnet www.kramse.dk 80+ laver en forbindelse til port 80/tcp
\end{list2}
\item Til krypterede forbindelser anbefales det at teste med openssl
\begin{list2}
\item \verb+openssl s_client -host www.kramse.dk -port 443+\\
laver en forbindelse til port 443/tcp med SSL
\item \verb+openssl s_client -host mail.kramse.dk -port 993+\\
 laver en forbindelse til port 993/tcp med SSL
\end{list2}
\item Med OpenSSL i client-mode kan services tilgås med samme tekstkommandoer som med telnet
\end{list1}

\slide{Wireshark - grafisk pakkesniffer}

\hlkimage{17cm}{images/wireshark-website.png}

\centerline{\link{http://www.wireshark.org}}
\centerline{både til Windows og UNIX}

\slide{Brug af Wireshark}

\hlkimage{13cm}{images/wireshark-http.png}

\centerline{Man starter med Capture - Options}

\slide{Brug af Wireshark}

\hlkimage{10cm}{images/wireshark-sni-twitter.png}

\centerline{Læg også mærke til filtermulighederne}

\slide{Hardware IPv4 checksum offloading}

\begin{list1}
\item IPv4 checksum skal beregnes hvergang man modtager en pakke
\item IPv4 checksum skal beregnes hvergang man sender en pakke
\vskip 1cm
\item Lad en ASIC gøre arbejdet!
\item De fleste servernetkort tilbyder at foretage denne beregning på IPv4
\item IPv6 benytter ikke header checksum, det er unødvendigt
\end{list1}
\vskip 1cm

\centerline{\hlkbig NB: kan resultere i at værktøjer siger checksum er forkert!}

\exercise{ex:wireshark-install}

\slide{TCP/IP basiskonfiguration}

\begin{alltt}
ip address add 10.0.42.123/254dev eth0
ip route add default via 10.0.42.1
\end{alltt}

\begin{list1}
\item konfiguration af interfaces og netværk på UNIX foregår med:
\item \verb+ip+ fra iproute2 \link{https://en.wikipedia.org/wiki/Iproute2}
\item Tidligere brugte vi \verb+ifconfig+, \verb+route+ og \verb+netstat+
\item - ofte pakket ind i konfigurationsmenuer m.v.
\item fejlsøgning foregår typisk med \verb+ping+ og \verb+traceroute+
\item På Microsoft Windows benyttes ikke \verb+ifconfig+\\
men kommandoerne \verb+ipconfig+ og \verb+ipv6+
\end{list1}


\slide{OpenBSD}

Netværkskonfiguration på OpenBSD:
\begin{alltt}
# cat /etc/hostname.em0
inet 10.0.0.23 0xffffff00 NONE
# cat /etc/mygate
10.0.0.1
# cat /etc/resolv.conf
domain zencurity.com
lookup file bind
nameserver 91.239.100.100
\end{alltt}


\slide{Vigtigste protokoller}

\begin{list1}
\item ARP Address Resolution Protocol
\item IP og ICMP Internet Control Message Protocol
\item UDP User Datagram Protocol
\item TCP Transmission Control Protocol
\item DHCP Dynamic Host Configuration Protocol
\item DNS Domain Name System
\end{list1}
\vskip 1cm
\centerline{Ovenstående er omtrent minimumskrav for at komme på internet}

\slide{UDP User Datagram Protocol}
\hlkimage{16cm}{udp-1.pdf}
\begin{list1}
\item Forbindelsesløs RFC-768, \emph{connection-less}
\end{list1}

\slide{TCP Transmission Control Protocol}
\hlkimage{14cm}{tcp-1.pdf}

\begin{list1}
\item Forbindelsesorienteret RFC-791 September 1981, \emph{connection-oriented}
\item Enten overføres data eller man får fejlmeddelelse
\end{list1}

\slide{TCP three way handshake}

\hlkimage{6cm}{images/tcp-three-way.pdf}

\begin{list2}
\item {\bfseries TCP SYN half-open} scans
\item Tidligere loggede systemer kun når der var etableret en fuld TCP
  forbindelse\\
- dette kan/kunne udnyttes til \emph{stealth}-scans
\end{list2}

\exercise{ex:wireshark-capture}

\slide{Well-known port numbers}

\hlkimage{6cm}{iana1.jpg}

\begin{list1}
\item IANA vedligeholder en liste over magiske konstanter i IP
\item De har lister med hvilke protokoller har hvilke protokol ID m.v.
\item En liste af interesse er port numre, hvor et par eksempler er:
\begin{list2}
\item Port 25 SMTP Simple Mail Transfer Protocol
\item Port 53 DNS Domain Name System
\item Port 80 HTTP Hyper Text Transfer Protocol over TLS/SSL
\item Port 443 HTTP over TLS/SSL
\end{list2}
\item Se flere på \link{http://www.iana.org}
\end{list1}


\slide{DHCP Dynamic Host Configuration Protocol}

\hlkimage{13cm}{dhcp-1.pdf}

\begin{list1}
\item Hvordan får man information om default gateway
\item Man sender et DHCP request og modtager et svar fra en DHCP server
\item Dynamisk konfiguration af klienter fra en centralt konfigureret server
\item Bruges til IP adresser og meget mere
\end{list1}

\slide{Whois -- Where do IP addresses come from}

\begin{list1}
\item A these magical numbers we use on the internet are administered by IANA \url{https://www.iana.org/}
\item They have handed out portions to the Region Internet Registries (RIR)
\begin{list2}
\item RIPE (Réseaux IP Européens)  \link{http://ripe.net}
\item ARIN American Registry for Internet Numbers \link{http://www.arin.net}
\item Asia Pacific Network Information Center \link{http://www.apnic.net}
\item LACNIC (Regional Latin-American and Caribbean IP Address Registry) - Latin America and some Caribbean Islands
\end{list2}
\item AFRINIC \url{https://afrinic.net/}
\item They are memberbased, and members are called Local Internet Registries (LIRs) og National Internet Registry (NIR)
\end{list1}

\slide{Ping}

\begin{list1}
\item ICMP - Internet Control Message Protocol
\item Benyttes til fejlbeskeder og til diagnosticering af forbindelser
\item ping programmet virker ved hjælp af ICMP ECHO request og
  forventer ICMP ECHO reply
\item
\begin{alltt}
\small {\bfseries
$ ping 192.168.1.1}
PING 192.168.1.1 (192.168.1.1): 56 data bytes
64 bytes from 192.168.1.1: icmp_seq=0 ttl=150 time=8.849 ms
64 bytes from 192.168.1.1: icmp_seq=1 ttl=150 time=0.588 ms
64 bytes from 192.168.1.1: icmp_seq=2 ttl=150 time=0.553 ms
\end{alltt}
\end{list1}

\slide{traceroute}

\begin{list1}
  \item traceroute programmet virker ved hjælp af TTL
\item levetiden for en pakke tælles ned i hver router på vejen og ved at sætte denne lavt
  opnår man at pakken \emph{timer ud} - besked fra hver router på vejen
\item default er UDP pakker, men på UNIX systemer er der ofte mulighed
  for at bruge ICMP
\item
\begin{alltt}
\small{\bfseries
$ traceroute 185.129.60.129}
traceroute to 185.129.60.129 (185.129.60.129),
30 hops max, 40 byte packets
 1  safri (10.0.0.11)  3.577 ms  0.565 ms  0.323 ms
 2  router (185.129.60.129)  1.481 ms  1.374 ms  1.261 ms
\end{alltt}
\end{list1}

%DNS
\slide{Domain Name System}

\hlkimage{10cm}{dns-1.pdf}

\begin{list1}
\item Gennem DHCP får man typisk også information om DNS servere
\item En DNS server kan slå navne, domæner og adresser op
\item Foregår via query og response med datatyper kaldet resource records
\item DNS er en distribueret database, så opslag kan resultere i flere opslag
\end{list1}

\slide{DNS systemet}

\begin{list1}
\item navneopslag på Internet
\item tidligere brugte man en {\bfseries hosts} fil\\
hosts filer bruges stadig lokalt til serveren - IP-adresser
\item UNIX: /etc/hosts
\item Windows \verb+c:\windows\system32\drivers\etc\hosts+
\item Eksempel: www.zencurity.com har adressen 185.129.60.130
\item skrives i database filer, zone filer
\end{list1}

\begin{alltt}
www     IN      A       185.129.60.130
        IN      AAAA    2a06:d380:0:101::80
\end{alltt}

\slide{More than name lookups}

\begin{list1}
  \item Lots of resource records and types:
    \begin{list2}
\item adresser A-records
\item IPv6 adresser AAAA-records
\item autoritative navneservere NS-records
\item post, mail-exchanger MX-records
\item flere andre: md ,  mf ,  cname ,  soa ,
                  mb , mg ,  mr ,  null ,  wks ,  ptr ,
                  hinfo ,  minfo ,  mx ....
\end{list2}
\end{list1}
\begin{alltt}
        IN      MX      10      mail.zencurity.com.
        IN      MX      20      mail2.zencurity.com.
\end{alltt}

Configuration via: \verb+/etc/resolv.conf+

\begin{alltt}
domain zencurity.com
nameserver 91.239.100.100
\end{alltt}

\slide{DNS root servere}

\hlkimage{20cm}{root-servers.png}

\link{http://root-servers.org/}

\slide{DK-hostmaster}

\begin{list1}
\item bestyrer .dk TLD - top level domain
\item man registrerer ikke .dk-domæner hos DK-hostmaster, men hos en
  registrator
\item Et domæne bør have flere navneservere og flere postservere
\item autoritativ navneserver - ved autoritativt om IP-adresse for
  maskine.domæne.dk findes
\item ikke-autoritativ - har på vegne af en klient slået en adresse op
\item Det anbefales at overveje en service som har flere navneservere distribueret
  over stor geografisk afstand
\end{list1}

\slide{NAT Network Address Translation}
\hlkimage{16cm}{nat-1.pdf}


\vskip 2 cm
\begin{list2}
\item NAT bruges til at forbinde et privat net (RFC-1918 adresser) med internet
\item NAT gateway udskifter afsender adressen med sin egen
\item En quick and dirty fix der vil forfølge os for resten af vores
  liv
\item Lægger state i netværket - ødelægger fate sharing
\end{list2}

\slide{NAT is BAD}

\hlkimage{20cm}{nat-is-bad.pdf}

\begin{list2}
\item NAT ødelægger end-to-end transparency!
\item Problemer med servere bagved NAT
\item "løser" problemet "godt nok" (tm) for mange
\item Men idag ser vi multilevel NAT! - eeeeeeewwwwww!
\item Se RFC-2775 Internet Transparency for mere om dette emne
\end{list2}

\exercise{ex:whois}
\exercise{ex:ip-address-research}
\exercise{ex:ping}
\exercise{ex:basic-dns-lookup}

\slide{Short IPv6 introduction}

\begin{list1}
\item IPv4 running out
\item 32-bit - der ikke kan udnyttes fuldt ud
\item Husk at idag benyttes Classless Inter-Domain Routing CIDR\\
\link{http://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing}
\item IPv6 was developed in the 1990s
\end{list1}

\slide{Tidslinie for IPv6 (forkortet)}

\begin{list2}
\item 1990 Vancouver IETF meeting
det estimeres at klasse B vil løbe ud ca. marts 1994

\item 1990 ultimo
initiativer til at finde en afløser for IPv4

\item 1995 januar
RFC-1752 Recommendation for the IP NG Protocol

\item 1995 september
RFC-1883, RFC-1884, RFC-1885, RFC-1886 1. generation

\item 1998 10. august
"core" IPv6 dokumenter bliver Draft Standard
\item
Kilde: RFC-2460, RFC-2461, RFC-2463, RFC-1981 - m.fl.
\end{list2}

\slide{IPv6: Internet redesigned? - nej!}

\begin{list1}
\item Målet var at bevare de gode egenskaber
\begin{list2}
\item basalt set Internet i gamle dage
\item back to basics!
\item fate sharing
\item kommunikationen afhænger ikke af state i netværket
\item end-to-end transparency
\end{list2}
\item Idag er Internet blevet en nødvendighed for mange!
\end{list1}

\centerline{\bf IP er en forretningskritisk ressource}

IPv6 basis i RFC-1752 The Recommendation for the IP Next Generation Protocol

\slide{KAME - en IPv6 reference implementation}

\hlkimage{5cm}{kame-noanime-small.png}

\centerline{\link{http://www.kame.net}}

\begin{list2}
\item Er idag at betragte som en reference implementation\\
- i stil med BSD fra Berkeley var det
\item KAME har været på forkant med implementation af draft dokumenter
\item KAME er inkluderet i OpenBSD, NetBSD, FreeBSD og BSD/OS
- har været det siden version 2.7, 1.5, 4.0 og 4.2

\item Projektet er afsluttet, men nye projekter fortsætter i
WIDE regi \link{http://www.wide.ad.jp/}
\item Der er udkommet to bøger som i detaljer gennemgår IPv6 protokollerne i KAME
\end{list2}

\slide{Hvordan bruger man IPv6}

\begin{center}
\hlkbig
\vskip 2 cm
www.zencurity.com

hlk@zencurity.com

\end{center}

\pause
DNS AAAA record tilføjes

\begin{alltt}
www     IN A    185.129.60.130
        IN AAAA 2a06:d380:0:101::80
mail    IN A    185.129.60.131
        IN AAAA 2a06:d380:0:101::25
\end{alltt}

\slide{IPv6 addresser og skrivemåde}

\hlkimage{17cm}{ipv6-address-1.pdf}

\begin{list2}
\item 128-bit adresser, subnet prefix næsten altid 64-bit
\item skrives i grupper af 4 hexcifre ad gangen adskilt af kolon :
\item foranstillede 0 i en gruppe kan udelades, en række 0 kan erstattes med ::
\item dvs 0:0:0:0:0:0:0:0 er det samme som \\
0000:0000:0000:0000:0000:0000:0000:0000
\item Dvs min webservers IPv6 adresse kan skrives som:
2001:16d8:ff00:12f::2
\item Specielle adresser:
::1 localhost/loopback og
::  default route
\item Læs mere i RFCerne
\end{list2}

\slide{IPv6 addresser - prefix notation}

\begin{list1}
\item Aggregatable Global Unicast
\item 2001::/16 RIR subTLA space
\begin{list2}
\item 2001:200::/23 APNIC
\item 2001:400::/23 ARIN
\item 2001:600::/23 RIPE
\end{list2}
\item 2002::/16 6to4 prefix
\item 3ffe::/16 6bone allocation -- nu udgået
\item link-local unicast addresses\\
fe80::/10 genereres udfra interface MAC addresserne EUI-64
\item Nu også privacy enhanced adresser
\end{list1}

Se mere på \link{https://www.iana.org/assignments/iana-ipv6-special-registry/iana-ipv6-special-registry.xhtml}

\slide{IPv6 addresser - multicast}

\begin{list1}
\item Unicast - identificerer ét interface
pakker sendes til en modtager

\item Multicast - identificerer flere interfaces
pakker sendes til flere modtagere

\item Anycast - indentificerer en "gruppe"
en pakke sendes til et vilkårligt interface med denne adresse typisk det nærmeste

\item Broadcast?
er væk, udeladt, finito, gone!

\item Husk også at site-local er deprecated, se RFC-3879
\end{list1}

\slide{IPv6 pakken - header - RFC-2460}

\begin{list2}
\item Simplere - fixed size - 40 bytes
\item Sjældent brugte felter (fra v4) udeladt (kun 6 vs 10 i IPv4)
\item Ingen checksum!
\item Adresser 128-bit
\item 64-bit aligned, alle 6 felter med indenfor første 64
\end{list2}

Mindre kompleksitet for routere på vejen medfører
mulighed for flere pakker på en given router

\slide{IPv6 pakken - header - RFC-2460}

\begin{alltt}\footnotesize
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Version| Traffic Class |           Flow Label                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Payload Length        |  Next Header  |   Hop Limit   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   +                         Source Address                        +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                                                               |
   +                      Destination Address                      +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
\end{alltt}

\slide{IPv4 pakken - header - RFC-791}

\begin{alltt}\small
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Version|  IHL  |Type of Service|          Total Length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Identification        |Flags|      Fragment Offset    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Time to Live |    Protocol   |         Header Checksum       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Source Address                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Destination Address                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Example Internet Datagram Header
\end{alltt}

\slide{IPv6 pakken - extension headers RFC-2460}

\begin{list1}
\item Fuld IPv6 implementation indeholder:
\begin{list2}
\item Hop-by-Hop Options
\item Routing (Type 0) - deprecated
\item Fragment - fragmentering KUN i end-points!
\item Destination Options
\item Authentication
\item Encapsulating Security Payload
\end{list2}
\item Ja, IPsec er en del af IPv6!
\end{list1}

\slide{Placering af extension headers}

\begin{alltt}
\small
  +---------------+----------------+------------------------
  |  IPv6 header  | Routing header | TCP header + data
  |               |                |
  | Next Header = |  Next Header = |
  |    Routing    |      TCP       |
  +---------------+----------------+------------------------

  +---------------+----------------+-----------------+-----------------
  |  IPv6 header  | Routing header | Fragment header | fragment of TCP
  |               |                |                 |  header + data
  | Next Header = |  Next Header = |  Next Header =  |
  |    Routing    |    Fragment    |       TCP       |
  +---------------+----------------+-----------------+-----------------
\end{alltt}


\slide{ping til IPv6 adresser}

\begin{alltt}
\small
root# ping6 ::1
PING6(56=40+8+8 bytes) ::1 --> ::1
16 bytes from ::1, icmp_seq=0 hlim=64 time=0.312 ms
16 bytes from ::1, icmp_seq=1 hlim=64 time=0.319 ms
^C
--- localhost ping6 statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.312/0.316/0.319 ms
\end{alltt}

Nogle operativsystemer kalder kommandoen ping6, andre bruger blot ping

\slide{ping6 til global unicast adresse}

\begin{alltt}
\footnotesize
root# ping6 2001:1448:81:beef:20a:95ff:fef5:34df
PING6(56=40+8+8 bytes) 2001:1448:81:beef::1 --> 2001:1448:81:beef:20a:95ff:fef5:34df
16 bytes from 2001:1448:81:beef:20a:95ff:fef5:34df, icmp_seq=0 hlim=64 time=10.639 ms
16 bytes from 2001:1448:81:beef:20a:95ff:fef5:34df, icmp_seq=1 hlim=64 time=1.615 ms
16 bytes from 2001:1448:81:beef:20a:95ff:fef5:34df, icmp_seq=2 hlim=64 time=2.074 ms
^C
--- 2001:1448:81:beef:20a:95ff:fef5:34df ping6 statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 1.615/4.776/10.639 ms
\end{alltt}


\slide{ ping6 til specielle adresser}

\begin{alltt}\footnotesize
root# ping6 -I en1 ff02::1
PING6(56=40+8+8 bytes) fe80::230:65ff:fe17:94d1 --> ff02::1
16 bytes from fe80::230:65ff:fe17:94d1, icmp_seq=0 hlim=64 time=0.483 ms
16 bytes from fe80::20a:95ff:fef5:34df, icmp_seq=0 hlim=64 time=982.932 ms
16 bytes from fe80::230:65ff:fe17:94d1, icmp_seq=1 hlim=64 time=0.582 ms
^C
--- ff02::1 ping6 statistics ---
4 packets transmitted, 4 packets received, +4 duplicates, 0% packet loss
round-trip min/avg/max = 0.483/126.236/982.932 ms
\end{alltt}

\begin{list2}
%\item ff00::0         ipv6-mcastprefix
\item ff02::1         ipv6-allnodes
\item ff02::2         ipv6-allrouters
\item ff02::3         ipv6-allhosts
\end{list2}
Tilsvarende IPv4 er der special use adresser, se links til RFC tidligere for detaljer

\slide{Stop - tid til leg}

\begin{list1}
\item Der findes et trådløst netværk med IPv6
\item Join med en laptop og prøv at pinge lidt
\begin{enumerate}
\item Virker \verb+ping6 ::1+ eller \verb+ping ::1+, fortsæt
\item Virker kommando svarende til: \verb+ping6 -I en1 ff02::1+\\
- burde vise flere maskiner
\item Kig på dine egne adresser med: \verb+ipv6+ (Windows) eller \verb+ifconfig+ (Unix)
\item Prøv at trace i netværket
\end{enumerate}
\item Hvordan fik I IPv6 adresser?
\item Prøv at sætte jeres Debian eller Kali i bridge mode på netværkskortet, hvis muligt -- wifi kort kan drille her
\end{list1}

\slide{ router advertisement daemon}

\begin{alltt}
/etc/rtadvd.conf:
en0:
      :addrs#1:addr="2001:1448:81:b00f::":prefixlen#64:
en1:
      :addrs#1:addr="2001:1448:81:beef::":prefixlen#64:

root# /usr/sbin/rtadvd -Df en0 en1
root# sysctl -w net.inet6.ip6.forwarding=1
net.inet6.ip6.forwarding: 0 -> 1
\end{alltt}

\begin{list1}
\item Stateless autoconfiguration er en stor ting i IPv6
\item Kommandoen starter den i debug-mode og i forgrunden\\
- normalt vil man starte den fra et script
\item Typisk skal forwarding aktiveres, som vist med BSD sysctl kommando
\end{list1}

\slide{IPv6 og andre services}

\begin{alltt}
\small
root# netstat -an | grep -i listen

tcp46  0  0  *.80             *.*    LISTEN
tcp4   0  0  *.6000           *.*    LISTEN
tcp4   0  0  127.0.0.1.631    *.*    LISTEN
tcp4   0  0  *.25             *.*    LISTEN
tcp4   0  0  *.20123          *.*    LISTEN
tcp46  0  0  *.20123          *.*    LISTEN
tcp4   0  0  127.0.0.1.1033   *.*    LISTEN
\end{alltt}

ovenstående er udført på Mac OS X

\slide{IPv6 output fra kommandoer - inet6 family}

\begin{alltt}
\small
root# netstat -an -f inet6

Active Internet connections (including servers)
Proto Recv Send  Local  Foreign   (state)
tcp46  0   0     *.80     *.*     LISTEN
tcp46  0   0     *.22780  *.*     LISTEN
udp6   0   0     *.5353   *.*
udp6   0   0     *.5353   *.*
udp6   0   0     *.514    *.*
icm6   0   0     *.*      *.*
icm6   0   0     *.*      *.*
icm6   0   0     *.*      *.*
\end{alltt}

ovenstående er udført på Mac OS X og tilrettet lidt

\slide{IPv6 er default for mange services}

\begin{alltt}
\small
root# telnet localhost 80

{\color{security6blue}Trying ::1...
Connected to localhost.}
Escape character is '^]'.
GET / HTTP/1.0

HTTP/1.1 200 OK
Date: Thu, 19 Feb 2004 09:22:34 GMT
Server: Apache/2.0.43 (Unix)
Content-Location: index.html.en
Vary: negotiate,accept-language,accept-charset
...
\end{alltt}

\slide{IPv6 er default i OpenSSH}

\begin{alltt}
\small
hlk$ ssh -v localhost -p 20123
OpenSSH_3.6.1p1+CAN-2003-0693, SSH protocols 1.5/2.0, OpenSSL 0x0090702f
debug1: Reading configuration data /Users/hlk/.ssh/config
debug1: Applying options for *
debug1: Reading configuration data /etc/ssh_config
debug1: Rhosts Authentication disabled, originating port will not be trusted.{\color{security6blue}
debug1: Connecting to localhost [::1] port 20123.}
debug1: Connection established.
debug1: identity file /Users/hlk/.ssh/id_rsa type -1
debug1: identity file /Users/hlk/.ssh/id_dsa type 2
debug1: Remote protocol version 2.0, remote software version OpenSSH_3.6.1p1+CAN-2003-0693
debug1: match: OpenSSH_3.6.1p1+CAN-2003-0693 pat OpenSSH*
debug1: Enabling compatibility mode for protocol 2.0
debug1: Local version string SSH-2.0-OpenSSH_3.6.1p1+CAN-2003-0693
\end{alltt}

\slide{Routing forståelse - IPv6}
\begin{alltt}\small
$ netstat -f inet6 -rn
Routing tables
Internet6:
Destination                 Gateway           Flags      Netif
default             fe80::200:24ff:fec1:58ac  UGc         en0
::1                         ::1               UH          lo0
2001:1448:81:cf0f::/64      link#4            UC          en0
2001:1448:81:cf0f::1        0:0:24:c1:58:ac   UHLW        en0
fe80::/64                   fe80::1           Uc          lo0
fe80::1                     link#1            UHL         lo0
fe80::/64                   link#4            UC          en0
fe80::20d:93ff:fe28:2812    0:d:93:28:28:12   UHL         lo0
fe80::/64                   link#5            UC          en1
fe80::20d:93ff:fe86:7c3f    0:d:93:86:7c:3f   UHL         lo0
ff01::/32                   ::1               U           lo0
ff02::/32                   ::1               UC          lo0
ff02::/32                   link#4            UC          en0
ff02::/32                   link#5            UC          en1
\end{alltt}

\slide{ IPv6 neighbor discovery protocol (NDP)}

\hlkimage{18cm}{ipv6-arp-ndp.pdf}

\begin{list1}
\item ARP er væk
\item NDP erstatter og udvider ARP, Sammenlign \verb+arp -an+ med \verb+ndp -an+
\item Til dels erstatter ICMPv6 således DHCP i IPv6, DHCPv6 findes dog
\item {\bf NB: bemærk at dette har stor betydning for firewallregler!}
\end{list1}

\slide{ARP vs NDP}

\begin{alltt}
\small
hlk@bigfoot:basic-ipv6-new$ arp -an
? (10.0.42.1) at{\bf 0:0:24:c8:b2:4c} on en1 [ethernet]
? (10.0.42.2) at 0:c0:b7:6c:19:b on en1 [ethernet]
hlk@bigfoot:basic-ipv6-new$ ndp -an
Neighbor                      Linklayer Address  Netif Expire    St Flgs Prbs
::1                           (incomplete)         lo0 permanent R
2001:16d8:ffd2:cf0f:21c:b3ff:fec4:e1b6 0:1c:b3:c4:e1:b6 en1 permanent R
fe80::1%lo0                   (incomplete)         lo0 permanent R
fe80::200:24ff:fec8:b24c%en1 {\bf 0:0:24:c8:b2:4c}      en1 8h54m51s  S  R
fe80::21c:b3ff:fec4:e1b6%en1  0:1c:b3:c4:e1:b6     en1 permanent R
\end{alltt}

Ovenstående udført på Mac OS X, BSD unix -- på Linux ville man ofte bruge \verb+ip neighbor show+

\slide{Hvorfor implementere IPv6 i jeres netværk?}

\begin{list1}
\item Addresserummet
\begin{list2}
\item end-to-end transparancy
\item 	nemmere administration
\end{list2}\item Autoconfiguration
\begin{list2}
\item stateless autoconfiguration
\item automatisk routerconfiguration!
(router renumbering)
\end{list2}
\item Performance
\begin{list2}
\item simplere format
\item kortere behandlingstid i routere
\end{list2}
\item Fleksibilitet - generelt
\item Sikkerhed
\begin{list2}
\item IPsec er et krav!
\item Afsender IP-adressen ændres ikke igennem NAT!
\end{list2}
\end{list1}

\slide{Færdig med IPv6}

\begin{list1}
\item I resten af kurset vil vi ikke betragte IPv6 eller IPv4 som noget specielt
\item Vi vil indimellem bruge det ene, indimellem det andet
\item Alle subnets er konfigureret ens på IPv4 og IPv6
\item Subnets som i IPv4 hedder prefix.45 vil således i IPv6 hedde noget med prefix:45:
\item At have ens routing på IPv4 og IPv6 vil typisk IKKE være tilfældet i praksis
\item Man kan jo lige så godt forbedre netværket mens man går over til IPv6 :-)
\end{list1}

\slide{Security problems in the TCP/IP Suite}

The title of a nice paper, and the rest of today
\begin{quote}
The paper “Security Problems in the TCP/IP Protocol Suite” was originally pub-
lished in Computer Communication Review, Vol. 19, No. 2, in April, 1989
\end{quote}

\begin{list1}
\item Problems described in the original:
\begin{list2}
\item sequence number spoofing
\item routing attacks,
\item source address spoofing
\item authentication attacks
\end{list2}
\end{list1}

\slide{TCP sequence number prediction}

\vskip 5mm
\begin{quote}
TCP SEQUENCE NUMBER PREDICTION
One of the more fascinating security holes was first described by Morris [7] . Briefly, he used TCP
sequence number prediction to construct a TCP packet sequence without ever receiving any responses
from the server. This allowed him to spoof a trusted host on a local network.
\end{quote}

\begin{list1}
\item tidligere baserede man login/adgange på source IP adresser, address based authentication
\item Er ikke en pålidelig autentifikationsmekanisme
\item Mest kendt er nok Shimomura der blev hacket på den måde, \\
måske af Kevin D Mitnick eller en kompagnon
\item I praksis vil det være svært at udføre på moderne operativsystemer
\item Se evt. \link{http://www.takedown.com/} (filmen er ikke så god ;-) )
\item Det er naturligvis fint med filtre så man kun kan tilgå services FRA bestemte IP
\end{list1}

\slide{Routing attacks}

\begin{list1}
\item Problems described in the original from 1989:
\begin{list2}
\item IP Source routing attacks - angiv en rute for pakkerne\\
Knapt så brugbar idag
\item Routing Information Protocol Attacks\\
The Routing Information Protocol [15] (RIP) - denne bruges ikke mere, outdated
\item BGPv4 som bruges idag har kæmpe problemer, kludetæppe af kludges
\end{list2}
\item Vi kommer til at snakke om \link{https://github.com/tomac/yersinia}
\end{list1}

\slide{Solutions to TCP/IP security problems}

\begin{list1}
\item Solutions:
\begin{list2}
\item Use RANDOM TCP sequence numbers, Win/Mac/Linux - DO,but IoT?
\item Filtrering, ingress / egress:\\
"reject external packets that claim to be from the local net"
\item Routers and routing protocols must be more skeptical\\
Routing filtre everywhere, auth på OSPF/BGP etc.
\end{list2}
\item Has been recommended for some years, but not done in all organisations
\item BGP routing Resource Public Key Infrastructure RPKI
\end{list1}

\slide{DNS problems}

\begin{quote}
The Domain Name System (DNS) [32][33] provides for a distributed database mapping host names to IP
addresses. An intruder who interferes with the proper operation of the DNS can mount a variety of
attacks, including denial of service and password collection. There are a number of vulnerabilities.
\end{quote}

\begin{list1}
\item We have a lot of the same problems in DNS today
\item Plus some more caused by middle-boxes, NAT, DNS size, DNS inspection
\begin{list2}
\item DNS must allow both UDP and TCP port 53
\item Your DNS servers must have updated software, see DNS flag day\\ https://dnsflagday.net/ after which kludges will be REMOVED!
\end{list2}
\end{list1}

\slide{SNMP problems}

\begin{quote}
5.5 Simple Network Management Protocol
The Simple Network Management Protocol (SNMP) [37] has recently been defined to aid in network
management. Clearly, access to such a resource must be heavily protected. The RFC states this, but
also allows for a null authentication service; this is a bad idea. Even a ‘‘read-only’’ mode is dangerous;
it may expose the target host to netstat-type attacks if the particular Management Information Base
(MIB) [38] used includes sequence numbers. (T
\end{quote}

True, and we will talk more about SNMP later in this course.

\slide{local networks}

\begin{quote}
6.1 Vulnerability of the Local Network
Some local-area networks, notably the Ethernet networks, are extremely vulnerable to eavesdropping and
host-spoofing. If such networks are used, physical access must be strictly controlled. It is also unwise
to trust any hosts on such networks if any machine on the network is accessible to untrusted personnel,
unless authentication servers are used.
If the local network uses the Address Resolution Protocol (ARP) [42] more subtle forms of host-spoofing
are possible. In particular, it becomes trivial to intercept, modify, and forward packets, rather than just
taking over the host’s role or simply spying on all traffic.
\end{quote}

Today we can send VXLAN spoofed packets across the internet layer 3 and inject ARP behind firewalls, in some cloud infrastructure cases ...

A Look Back at “Security Problems in the TCP/IP Protocol Suite”
about 1989 + 15 years = 2004

\slidenext

\end{document}
