\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}
\externaldocument{siem-log-analysis-exercises}
\selectlanguage{english}


\begin{document}

\mytitlepage
{6. Operate, Respond and Forensics}
{KEA Kompetence SIEM and Log Analysis}


\slide{Goals for today}

\hlkimage{6cm}{chris-benson-nKEARsgmrqc-unsplash.jpg}


Todays goals:
\begin{list2}
\item Exam preparation --  Trial exam, show how it works
\item Operate a SIEM - further discussions how to work with the SIEM you setup
\item Respond and Forensics -- relating this course with incident response and forensics
\end{list2}

 Photo by Chris Benson on Unsplash

\slide{Plan for today}

\begin{list1}
\item Subjects
\begin{list2}
\item  3 slides from last time: Reporting/Automatic reporting: tcpflow
\item Go through exam reading list, Literature list walkthrough, Subject list walkthrough
\end{list2}
\item Exercises
\begin{list2}
\item Exam demo
\item Find State of security and breach reports
\item Find case management solutions
\end{list2}
\end{list1}

\slide{Reading Summary}

\begin{list1}
\item SOC 7. vuln management
\item SOC 11. Reacting to events and Incidents
\item CIP 6 Operationalize!
\item Papers: Skim table of contents Privacy by design in big data: An overview of privacy enhancing technologies in the era of big data analytics, ENISA
\item
\end{list1}


\slide{Reading Summary, continued}

\hlkimage{8cm}{socbook-targeted-attack.png}

\begin{quote}
Many breaches discovered are caused by a system having a known vulnerability exploited before it is properly patched.
\end{quote}

Source: Mandiant’s Targeted Attack Lifecycle, SOC chapter 7. vuln management

\begin{list2}
\item Chapter contains lots of references
\item Also chapter links inventory controls with active discovery tools and mitigating
\item Mentions Threat Feeds, which should be integrated into SIEM and/or organizations
\item You need to stay up-to-date on current threats, and be able to search for signs in your own network
\end{list2}


\slide{Reading Summary, continued}

%\hlkimage{}{}

\begin{quote}
Let’s start by talking a little bit about events, because they might not be what you think they are.

As discussed earlier, events are really things we observe based on artifacts we have that you can use to indicate what may have happened in the recent (or in some cases, distant) past. {\bf For most new SOCs}, this tends to mean focusing on the events that come in the form of {\bf logs generated by assets and security controls throughout the organization, or collated events that analyze multiple logs in the context of each other}. As a result, SOC members spend a lot of time working on building and tuning security log management and {\bf security information and event management (SIEM)} to help collect and interpret such {\bf logs in real time or over historical periods.} Unfortunately, events in the form of automated logs or alerts generated by SIEMs represent the smaller portion of events relevant to security incidents in most organizations.
\end{quote}
Source:  SOC 11. Reacting to events and Incidents

\begin{list2}
%\item Yes, other source are important -- but last sentence leaves out, for investigation AFTER event is initiated ALSO uses the SIEM
\item Elasticsearch and Logstash typically stores the original message too
\end{list2}


\slide{Reading Summary, continued}

%\hlkimage{}{}

\begin{quote}
You will need at least one dedicated and full-time human to analyze your security event data.
  ...
For organizations with too few dedicated security analysts, the actual available headcount may define with what frequency and what volume alerts can be handled per day or week. Ideally, organizations are staffed to run and process all defined reports, with enough flexibility for new reports to be created and analyzed.
\end{quote}
Source: CIP 6 Operationalize!

\begin{list2}
\item Organizations in Denmark does not usually have the luxury of dedicated resources -- until it happens
\end{list2}

\slide{Staffing your security team}

%\hlkimage{}{}

\begin{quote}

With regard to analysts and staffing, your options essentially boil down to:
\begin{list2}
\item Paying a managed security service a regular subscription fee to “do your security,”
  with little to no context about your network; the service might, however, handle a
  broad spectrum of security beyond incident response (e.g., vulnerability scan‐
  ning)
\item Tasking a part-time “security person” to work on a best-effort security monitor‐
  ing system (e.g., a SIEM) when they have time
\item Hiring a sufficient number of security analysts and tailoring your security opera‐
tions to your business requirements
\item Calling in an emergency response team after your organization has been compromised
\end{list2}
\end{quote}
Source: CIP 6 Operationalize!

\begin{list2}
  \item Hard truth
\end{list2}



\slide{Reading Summary, continued}

%\hlkimage{}{}

\begin{quote}

\end{quote}

\begin{list1}
\item Papers: Skim table of contents Privacy by design in big data: An overview of privacy enhancing technologies in the era of big data analytics, ENISA
\begin{list2}
\item When we collect data it may become sensitive
\item Metadata matters -- a lot!
\item Forensics often use data from the SIEM and logging systems
\item ENISA is the \emph{European security office}
\end{list2}
\end{list1}


\slide{Goals: SIEM and Log Analysis}

\hlkimage{8cm}{nesa-by-makers-IgUR1iX0mqM-unsplash.jpg}

\begin{list1}
\item We have learned a lot about SIEM and Logging, in some detail
\item Often we can reuse existing systems, setups, examples
\item Elasticsearch is only one example system, but covers a lot

\end{list1}
{\small \hfill Photo by NESA by Makers on Unsplash}

\slide{Literature list walkthrough}

\begin{list1}
\item Our reading list is at:\\
{\footnotesize\url{https://github.com/kramse/kea-it-sikkerhed/blob/master/siem-og-loganalyse/lektionsplan.md}}
\item Not all are required reading for the exam!
\item We will now go through the list and comment, ask questions
\item Selection criteria and goals:
\begin{list2}
\item You should be able to read books, presentations, papers, vulnerability disclosures, hacker zines.
\item You should be able to find and use tools and frameworks\\
Example MITRE ATT\&CK, Elastic guides, Blog posts
\end{list2}
%\item Some are classic texts or from organisations and people you should KNOW after this course
\item A lot of resources are also linked throughout the course presentations
\end{list1}


\slide{Books we worked with}
Primary literature:
\begin{list2}
\item \emph{Data-Driven Security: Analysis, Visualization and Dashboards} Jay Jacobs, Bob Rudis\\
ISBN: 978-1-118-79372-5 February 2014 \url{https://datadrivensecurity.info/} - short DDS
\item \emph{Crafting the InfoSec Playbook: Security Monitoring and Incident Response Master Plan}\\
 by Jeff Bollinger, Brandon Enright, and Matthew Valites ISBN: 9781491949405 - short CIP
\item \emph{Intelligence-Driven Incident Response} \\
 Scott Roberts ISBN: 9781491934944 - short IDI
\item \emph{Security Operations Center: Building, Operating, and Maintaining your SOC}\\
ISBN: 9780134052014 Joseph Muniz - short SOC
\end{list2}

By now we should have an idea where to find details about for example Netflow, or incident response, so we can create real systems using the methods

\slide{Confidentiality, Integrity and Availability}

\hlkimage{8cm}{cia-triad-uk.pdf}

\begin{list1}
\item We want to protect something
\item Confidentiality - data kept a secret
\item Integrity - data is not subjected to unauthorized changes
\item Availability - data and systems are available when needed
\end{list1}


\slide{Security is a process}

\begin{list1}
\item Remember:
\begin{list2}
\item what is information and security?
\item Data kept electronically
\item Data kept in physical form
\item Dont forget the human element of security
\end{list2}
\item Incident Response and Computer Forensics reaction to incidents
\item Good security is the result of planning and long-term work
\end{list1}
\vskip 1cm
\centerline{\color{titlecolor}\LARGE Security is a process, not a product, Bruce Schneier}

Source for quote: \link{https://www.schneier.com/essays/archives/2000/04/the_process_of_secur.html}

\slide{Work together}

\hlkimage{9cm}{Shaking-hands_web.jpg}

\begin{list1}
\item Team up!
\item We need to share security information freely
\item We often face the same threats, so we can work on solving these together
\end{list1}



\slide{Exam preparation}



\hlkimage{15cm}{kea-diplom-oversigt.png}

\hskip 7cm Overview Diploma in IT-security



\slide{Deliverables and Exam}

\begin{list2}
\item Exam
\item Individual: Oral based on curriculum
\item Graded (7 scale)
\item Draw a question with no preparation. Question covers a topic
\item Try to discuss the topic, and use practical examples
\item Exam is 30 minutes in total, including pulling the question and grading
\item Count on being able to present talk for about 10 minutes
\item Prepare material (keywords, examples, exercises, wireshark captures) for different topics so that you can use it to help you at the exam

\vskip 5mm
\item Deliverables:
\item \sout{1 Mandatory assignments}
\item Mandatory assignments are required in order to be entitled to the exam.
\end{list2}


\slide{Course Description}



From: STUDIEORDNING Diplomuddannelse i it-sikkerhed August 2018\\
VF4 SIEM og log analyse (5 ECTS)

Indhold\\
Den studerende lærer om Security information and event management (SIEM), herunder
hvordan man kan indsamle, administrere, og søge i sikkerhedshændelsesdata i et større it
system (komplekse systemer, IOT deployments, corporate IT).

{\bf Læringsmål}\\
Viden -- Den studerende har viden om og forståelse for:
\begin{list2}
\item Typiske SIEM arkitekturer
\item Standard logformater og logtyper for standard systemer og komponenter
\item Typiske SIEM produkter
\item Juridiske krav til logning og bevarelse af data ifb. forensic analyse
\end{list2}

Færdigheder -- Den studerende kan:
\begin{list2}
\item Lave en baseline-analyse af en infrastruktur
\item Bruge log-data til at identificere infrastrukturkomponenter
\item Bruge et værktøj til at analysere system log-data og netværkstrafik til at finde sikkerhedshændelser
\item Udvikle "dashboards" og alarmer der viser tegn på hændelser
\end{list2}

Kompetencer -- Den studerende kan:
\begin{list2}
\item Designe og implementere en SIEM løsning på tværs af diverse produkter
\item Træffe beslutninger om hvilke data der skal indsamles i en givne situation
\item Identificerer fejl i logopsamlingen
\item Deltage i drøftelser på et praktisk og strategisk niveau i forhold til implementering af
logmanagement/SIEM
\end{list2}

Final word is the Studieordning which can be downloaded from\\
{\footnotesize \link{https://kompetence.kea.dk/uddannelser/it-digitalt/diplom-i-it-sikkerhed}\\
\link{Studieordning_for_Diplomuddannelsen_i_IT-sikkerhed_Aug_2018.pdf}}



\slide{Mundtlig eksamen og formalia}

Eksamen varer samlet set i 30 minutter og forløber i 4 faser:

\begin{enumerate}
  \item Du trækker indledningsvist ét af de 10 ovenstående emner
  \item Du forklarer indledende emnet støttet af egne slides i op til 10 minutter
  \item Herefter uddyber og diskuteres emnet i en dialog på 10 -- 15 minutter
  \item Afslutningsvist er der 5 minutters votering og karaktergivning
\end{enumerate}

Karakteren vil være en helhedsbedømmelseaf din viden om emnet samt din evne til at uddybe og diskutere relevante IT-sikkerhedsmæssige elementer. Der gives karakter efter 7 trins skalaen.


\slide{Exam subjects, with keywords}

\begin{list2}
\item {\bf 1) Overview of SIEM}
The SIEM name, dive into events - common data used/found in events SOC, IOC and other acronyms that are found in this course

\item {\bf 2) Data types}
IP address, domain names and DNS, reputation lists, formats JSON, XML, CSV ISO8601 - normalization Netflow and TCP/IP, AS numbers, CIDR, port numbers

\item {\bf 3) Tools used in the SIEM world}
Languages, Zeek, Python, cURL, JavaScript, CSS, R Any tools you like, really

\item {\bf 4) Storing and processing data -- log data in particular}
Elastic stack, Logstash - ingestion and normalization, ES store/process, Kibana present REST, Message queuing Filebeat, packetbeat

\item {\bf 5) Dashboards and visualization of event data}
process of using, searching in data Elasticsearch Elastic Common Scheme (ECS) Elasticsearch SIEM How standard schemes help

\item {\bf 6) SIEM architectures}
Present some sample architectures, use some of the tools presented like HELK and Elastic stack overviews
Explain some problems - scalability, how to cope with lots of data
\end{list2}



\slide{VERIS}

%\hlkimage{}{}

\begin{quote}
Verizon RISK Team. “2013 data breach investigations report.” Available at http://www.verizonenterprise.com/DBIR—This report is based on data collected using the VERIS framework. You might find it handy to look at some of the graphics in the report and then attempt to repeat them using the verisr package, discussed in this chapter, and the VCDB data.
\end{quote}
Source: DDS page 189

Related to the Risk rating SOC chapter 7. vuln management, we often need a common format and terminology

\slide{Automated IOC Formats}

\begin{quote}{\bf
Automated IOC Formats}

Fully automated and comprehensive formats such as OpenIOC and STIX are useful only for teams that use tools built for them (or are capable of of building tools to use these standards).
\end{quote}
Source: IDIR page 198


\begin{list2}
\item Veris and other standardized format are a benefit\\
\link{http://veriscommunity.net/}\\
\emph{VERIS the vocabulary for event recording and incident sharing}
\item Most come from a need, but few are implemented across the industry
\end{list2}

\centerline{What are some of the yearly reports you like?}

\slide{Exercise: Find 3 security reports}

%\hlkimage{}{}

\begin{quote}

\end{quote}

\begin{list2}
\item The Data Breach Investigations Report from Verizon is located at:\\
  \link{https://enterprise.verizon.com/resources/reports/dbir/}
\item Find three similar ones from other companies and organizations

\item Use search terms like: The State of Network Security
\item or companies working with security: Mandiant, Fireeye, firewall vendors
\item or companies recently breached: Solarwinds
\item or network organizations:
\end{list2}
Example: ENISA \emph{Trust Services Security Incidents 2019 Annual Analysis Report}\\
\link{https://www.enisa.europa.eu/publications/trust-services-security-incidents-2019-annual-analysis-report}
Note: a lot of them publish these around new year, so about now and January


\slide{Case management}

%\hlkimage{}{}

\begin{quote}
There are a number of open source and commercial case management tools available on the market, most sharing a set of common features. Most coordinate the end-to-end response, investigation, and reporting of security incidents. Most provide a secure web-based collaboration platform that allows for multiple parties to work together to investigate incident reports and manage incidents. Most provide the ability to report on individual incidents and provide trending data for longer-term analysis. Most provide some level of integration with other systems to streamline investigations and response, particularly integration with SIEMs, forensics platforms, and enterprise ticketing systems. Some also support compliance and security incidents, providing for anonymous incident reporting for ethics violations.
\end{quote}
Source:  SOC 11. Reacting to events and Incidents


\slide{Example tools}

\begin{list2}
  \item \link{https://www.misp-project.org/}

  \item Request Tracker for Incident Response (RTIR) \link{https://bestpractical.com/rtir/} mentioned in the SOC book, but not sure I would recommend RT anymore

  \item \emph{GRR Rapid Response is an incident response framework focused on remote live forensics.}
  \link{https://github.com/google/grr}

  \item \emph{A scalable, open source and free Security Incident Response Platform, tightly integrated with MISP (Malware Information Sharing Platform), designed to make life easier for SOCs, CSIRTs, CERTs and any information security practitioner dealing with security incidents that need to be investigated and acted upon swiftly.} \link{https://thehive-project.org/}

\item CIP book mention that: \emph{Cisco’s CSIRT uses Bugzilla as its playbook management \link{https://www.bugzilla.org/}
software}

\end{list2}

\centerline{Lets discuss, which ones would you try? Have you tried, how to decide}

\slide{SIEM tools}

\begin{list2}
\item Alientvault OSSIM, OSSEC, Sagan, Splunk Free
\item Snort, Elasticsearch, MozDef, ELK Stack, Wazuh
\item Apache Metron -- Apache Metron evolved from Cisco’s Open SOC platform
\end{list2}

\emph{10 Best Free and Open-Source SIEM Tools} \link{https://www.dnsstuff.com/free-siem-tools}

\emph{10 Best SIEM Tools} \link{https://www.dnsstuff.com/siem-tools}


\slide{SIEM tools }

%\hlkimage{}{}

\begin{quote}

\end{quote}

\begin{list2}
\item The ELK Stack
\item Apache Metron
\item SIEMonster
\item Prelude
\item OSSIM
\end{list2}
A lot of web pages contain the same lists of tools

Comparison, almost random link -- a SIEM vendor:\\
\emph{7 Open Source SIEMs: Features vs. Limitations}\\
\link{https://www.exabeam.com/siem/7-open-source-siems-features-vs-limitations/}



\slide{Exercise: Find case management solutions}

%\hlkimage{}{}

\begin{quote}

\end{quote}

\begin{list2}
  \item Use search terms like CSIRT, FIRST, Veris, MISP,
\end{list2}





\slide{Exposure, Attack surfaces, and reducing them}

\begin{list2}
\item Incident prevention
\item Real-time intrusion detection systems (IDS/IPS)
\item {\bf Definition 27-7} An \emph{attack surface} is the set of entry points and data that attackers can u
se to compromise a system.
\item Reducing the chance of success also helps, randomization
\item Use stack and heap protection
\item Address space layout randomization (ASLR) is a host-level moving target defense.
\item OpenBSD even randomizes the kernel on install -- kernel address randomized link (KARL)
\item Limit number of listening services, change insecure defaults, implement access control and firewalls
\item Remove anything but the necessary request methods on web servers \verb+GET+, \verb+HEAD+ and \verb+POST+
\item Restrict access to administrative interfaces
\item Implement network segmentation
\end{list2}



\slide{Network Forensics ENISA}

\begin{quote}
  The European Union Agency for Network and Information Security (ENISA) is a centre of expertise for cyber security in Europe.

ENISA is contributing to a high level of network and information security (NIS) within the European Union, by developing and promoting a culture of NIS in society to assist in the proper functioning of the internal market.
\end{quote}

\link{https://www.enisa.europa.eu/}

ENISA has published a number of network forensics documents which are free to use, so these are our basics.


\slide{Forensic analysis}

\begin{quote}
Network forensics is a sub-branch of digital forensics relating to the monitoring and analysis of computer
network traffic for the purposes of information gathering, legal evidence, or intrusion detection 5 .
\end{quote}

\begin{list1}
\item Systems used to collect network data for forensics use usually come in three forms:
\begin{list2}
\item Packet capture: All packets passing through a certain traffic point are captured and written to storage
\item Intrusion detection systems
\item Network flow sensors
\end{list2}
\end{list1}

The acronym OSCAR 8 stands for: Obtain information,
Strategize,
Collect evidence,
Analyse,
Report

Source: Forensic analysis Network Incident Response Handbook, Document for teachers 1.0 DECEMBER 2016, ENISA\\
\verb+EXE2_Forensic_analysis_II-Handbook.pdf+


\slide{ENISA papers}

\begin{list2}
\item I recommend these as examples:
\item ENISA Presenting, correlating and filtering various feeds Handbook, Document for teachers\\ \link{https://www.enisa.europa.eu/topics/trainings-for-cybersecurity-specialists/online-training-material/documents/presenting-correlating-and-filtering-various-feeds-handbook}
\item ENISA Forensic analysis, Network Incident Response\\ \link{https://www.enisa.europa.eu/topics/trainings-for-cybersecurity-specialists/online-training-material/documents/2016-resources/exe2_forensic_analysis_ii-handbook}
\item ENISA Network Forensics, Handbook, Document for teachers\\ \link{https://www.enisa.europa.eu/topics/trainings-for-cybersecurity-specialists/online-training-material/documents/network-forensics-handbook}
\end{list2}

They are focussed on network forensics, which is required to do network-wide investigations. '

{\bf You also need application and client logs}


\slide{Chain of custody}

%\hlkimage{}{}

\begin{quote}
Chain of custody (CoC), in legal contexts, is the chronological documentation or paper trail that records the sequence of custody, control, transfer, analysis, and disposition of materials, including physical or electronic evidence.
\end{quote}
Source: \link{https://en.wikipedia.org/wiki/Chain_of_custody}

\begin{list2}
\item Put things in a bag, tape it closed, write what is inside, date, who collected etc.
\end{list2}


\slide{GDPR, logging and legality}

%\hlkimage{}{}

\begin{quote}
  10.Stiller GDPR krav om logning af alt, herunder hvad den enkelte bruger laver på
  systemet, hvad han ser mv.?

  SikkerhedsBranchens opfattelse er at det er nok at logge hvem der er logget ind i
  systemet i hvilket tidsrum. Princippet i den gamle persondatalovs § 41 stk. 3 er
  ført videre i GDPR, og praksis derfra understøtter vores opfattelse.
\end{quote}
Source: \\{\footnotesize
\link{https://www.sikkerhedsbranchen.dk/wp-content/uploads/2018/12/GDPR-Databeskyttelse-FAQ.pdf}}

\begin{list2}
\item Most references are about GDPR and logging
\item Keywords gdpr siem site:dk
  \item \link{https://digst.dk/styring/standardkontrakter/klausuler-til-informationssikkerhed/logning/}
\end{list2}


\slide{Monitoring of employees}

%\hlkimage{}{}

\begin{quote}{\bf
  Overvågning på arbejdspladsen}

  På en tredjedel af IT-arbejdspladserne overvåges IT-medarbejdernes brug af e-mails og Internet. Det viser en lille stikprøveundersøgelse, som PROSA har foretaget. PROSA ønsker klare regler på området og vil derfor på en række møder være med til at sætte gang i overvågningsdebatten
\end{quote}
Source: 2001 PROSA {\footnotesize\link{https://www.prosa.dk/artikel/overvaagning-paa-arbejdspladsen-1/}}

\begin{list2}
  \item Also {\footnotesize\link{https://www.prosa.dk/artikel/regler-for-it-overvaagning-paa-arbejdspladsen/}}
\item If your IT-security policies allow private use of devices and systems, be careful
\item Even if your IT-security policies do not allow, people might store private data
\item If you need to access data, {\bf for operational purposes}, you ARE allowed in DK
\item Recommend informing employees and others specifically
\end{list2}

\slide{Danish Data Protection Agency: Employee data}

%\hlkimage{}{}

\begin{quote}
Databeskyttelse i forbindelse med ansættelsesforhold er et komplekst område, hvor bl.a. de overordnede databeskyttelsesretlige regler, ansættelsesretlige regler samt kollektive overenskomster og aftaler har betydning for de behandlinger af personoplysninger, der sker på arbejdspladser og i fagforeninger, mv.

Såvel offentlige som private arbejdsgivere behandler en stor mængde personoplysninger om ansøgere i forbindelse med rekruttering og om medarbejdere, både under ansættelsen og efter ansættelsens ophør. Tilsvarende behandler faglige organisationer og tillidsrepræsentanter personoplysninger om både deres medlemmer og andre medarbejdere på arbejdspladsen. Hertil kommer, at der i vidt omfang udveksles oplysninger mellem de enkelte aktører.
\end{quote}
Source: {\footnotesize\link{https://www.datatilsynet.dk/media/7597/databeskyttelse-i-forbindelse-med-ansaettelsesforhold.pdf}}

\begin{list2}
\item Probably one of the best sources to use, as they process complaints about data processing
\item 43 pages
\end{list2}


\end{document}
