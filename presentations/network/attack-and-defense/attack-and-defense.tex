\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}

%  Almindelige netværksangreb og forsvar
% Hvordan kan sund fornuft og best practice mindske skader fra angreb?

% Hvordan kan sund fornuft, allerede kendte foranstaltninger, best practice og andre ting, som du allerede burde have gjort, mindske skaderne fra exploits og angreb?

% Vi bruger input fra almindelige exploits brugt i 2021 og Mitre ATT&CK, og ser på hvordan de matcher mod Defense in Depth, firewalling, filtrering, kendte sikkerhedsmekanismer m.v. Du behøver ikke bruge millioner på nyeste AI værktøj. Vi bruger erfaringer og viden opsamlet gennem 30 år, men anvendt på moderne angreb og exploits, incident response, til at skabe indsigt og detektering af angreb.

% Målgruppe er alle, som er interesserede i at holde systemer og netværk sikre. Nøgleord:

% Firewalls, Network segmentation, hardening. Materialer på engelsk men præsenteres på dansk.Open Source materials på Github: github.com/kramse/security-courses/

% Underviser
% Henrik Kramselund (@kramse) er internet samurai, netværks- og sikkerhedskonsulent. Har arbejdet med sikkerhed siden midten af 1990’erne.

% Dato: Mandag 9. maj kl. 17.00-21.00
% Sted: Online. Direkte link sendes på dagen pr. mail



% Husk de efterhånden mange eksempler fra rigtige netværk:
% HP ILO - KVM generelt
% Switche admin interfaces set med HP, Ubnt, m.fl.
% Administrative interfaces Tomcat deploy via HTML, Couchbase Sync Gateway admin REST direkte på Internet osv.

\begin{document}
\selectlanguage{english}
\mytitlepage{Attack and Defense}
{2022}


\slide{Time schedule}

{\bf 17:00 - 21:00 including breaks}

\begin{list2}
\item 17:00 - 18:15\\
Introduction to Security problems and basics
\item 30min break\\
Go eat with your family, hang around, get coffee

\item 18:45 - 19:30 45min\\ Strategies for long-lasting protection in IT-security

\item 15min break\\

\item 19:45 -20:30 45min \\
More strategies for long-lasting protection in IT-security and Summary
\item 20:30 - 21:00 Roundtable -- open discussion, share your experience
\end{list2}

Most slides are in english, some in Danish! Sorry


\slide{Introduction: Attack overview}

\hlkimage{20cm}{sicherheitstacho.png}
Source: \link{http://www.sicherheitstacho.eu/}


\slide{DDoS Attacks Still a Problem}

\hlkimage{13cm}{DDos_Attack_in_2021_arbor.png}

Security attacks and DDoS is very much in the media\\
Source: link{https://www.netscout.com/threatreport/global-ddos-attack-trends/}

\slide{DDoS Attacks are HUGE}

\hlkimage{13cm}{DDos_Attack_in_2021_size_arbor.png}

Extremely hard to protect against from a small network\\
Source: link{https://www.netscout.com/threatreport/global-ddos-attack-trends/}


\slide{Ransomware Attacks are Common}

\hlkimage{13cm}{ransomware_arbor.png}

Make sure to backup your data! Test your backups!\\
Source: link{https://www.netscout.com/threatreport/global-ddos-attack-trends/}


\slide{Konklusion: IT-sikkerhed og IT-drift er præget af kaos og panik}

\hlkimage{5cm}{dont-panic.png}
\begin{list2}
\item Vi starter godt, struktureret arbejde!
\item Vi bliver afbrudt ... og det sker tit
\item Vi bliver ikke færdige! Det bliver man sjældent i virkeligheden
\item Microsoft alene frigiver opdateringer for mere end 100 sårbarheder om måneden
\item Al software har sikkerhedsproblemer, og skal opdateres!
\end{list2}


\slide{What can we do? -- Good security}

\hlkimage{13cm}{god-sikkerhed.pdf}

\begin{list1}
\item You always have limited resources for protection - use them as best as possible
\item Good security comes from structured work
\end{list1}


\slide{Balanced security}

\hlkimage{21cm}{afbalanceret-sikkerhed.pdf}

\begin{list1}
\item Better to have the same level of security
\item If you have bad security in some part - guess where attackers will end up
\item Hackers are not required to take the hardest path into the network
\item Realize there is no such thing as 100\% security
\end{list1}


\slide{Work together}

%\hlkimage{10cm}{Shaking-hands_web.jpg}
\hlkimage{10cm}{nesa-by-makers-IgUR1iX0mqM-unsplash.jpg}


\begin{list1}
\item Team up!
\item We need to share security information freely
\item We often face the same threats, so we can work on solving these together
\end{list1}


\slide{Risk management defined}

\hlkimage{22cm}{shon-harris-risk-management.png}

Source: Shon Harris \emph{CISSP All-in-One Exam Guide}

\slide{Confidentiality, Integrity and Availability}

\hlkimage{8cm}{cia-triad-uk.pdf}

\begin{list1}
\item We want to protect something
\item Confidentiality - data kept a secret
\item Integrity - data is not subjected to unauthorized changes
\item Availability - data and systems are available when needed
\end{list1}

\slide{Security is a process}

\begin{list1}
\item Remember:
\begin{list2}
\item what is information and security?
\item Data kept electronically
\item Data kept in physical form
\item Dont forget the human element of security
\end{list2}
\item Incident Response and Computer Forensics reaction to incidents
\item Good security is the result of planning and long-term work
\end{list1}
\vskip 1cm
\centerline{\color{titlecolor}\LARGE Security is a process, not a product, Bruce Schneier}

Source for quote: \link{https://www.schneier.com/essays/archives/2000/04/the_process_of_secur.html}


\slide{Security Controls and Frameworks}

\begin{list1}
\item Multiple exist -- only subset listed below
\vskip 1cm
\begin{list2}
\item CIS controls Center for Internet Security (CIS) \link{https://www.cisecurity.org}
\item PCI Best Practices for Maintaining PCI DSS Compliance v2.0 Jan 2019
\item NIST Cybersecurity Framework (CSF)\\
Framework for Improving
Critical Infrastructure Cybersecurity\\ \link{https://www.nist.gov/cyberframework}\\
\link{https://csrc.nist.gov/publications/sp800} - SP800 series
\item National Security Agency (NSA)\\
\link{https://www.nsa.gov/Research/}
\item NSA security configuration guides\\
\link{https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/}
\item Information Systems Audit and Control Association (ISACA)\\
\link{http://www.isaca.org/Knowledge-Center/}
\end{list2}
\end{list1}


\slide{Center for Internet Security CIS Controls}

\begin{quote}
The CIS ControlsTM are a  {\bf prioritized set of actions that collectively form a defense-in-depth set of best practices} that mitigate the most common attacks against systems and networks. The CIS Controls are {\bf developed by a community of IT experts who apply their first-hand experience} as cyber defenders to create these globally accepted security best practices. The experts who develop the CIS Controls come from a {\bf wide range of sectors including retail, manufacturing, healthcare, education, government, defense, and others}.
\end{quote}

Source: \link{https://www.cisecurity.org/} CIS-Controls-Version-7-1.pdf

Note: The CIS Controls were developed starting in 2008


\slide{Kom igang med CIS}

\begin{quote}
CIS-kontrollerne består af 20 praktiske, pragmatiske kontroller, som er målbare og med direkte henvisning til, hvordan de implementeres samt forslag til, hvilke KPI’er der bør opstilles for målinger.

Forskellen på CIS-kontrollerne og fx ISO27001 er, at du ikke kan blive certificeret efter CIS, men til gengæld opdateres CIS-kontrollerne løbende, og de indeholder prioriterede lister af, hvad du i praksis skal gøre for din cybersikkerhed. Det australske forsvar har fx vist, at hvis man implementerer de første fire kontroller fuldt ud, kan man mitigere op mod 90+\% af alt malware.
\end{quote}

Dansk artikel fra Deloitte, version 7 indeholder 20 kontroller men version 8 med 18 kontroller\\
\link{https://www2.deloitte.com/dk/da/pages/risk/articles/vi-stiller-skarpt-pa-cis-kontroller.html}


\slide{Basic Security Controls}

CIS controls 1-6 are Basic, everyone must do them. Today I have replaced 6 with 10.

\begin{list2}
\item {\bf CIS Control 1: Inventory and Control of Hardware Assets}
\item {\bf CIS Control 2: Inventory and Control of Software Assets}
\item {\bf CIS Control 3: Continuous Vulnerability Management}
\item {\bf CIS Control 4: Controlled Use of Administrative Privileges}
\item {\bf CIS Control 5:
Secure Configuration for Hardware and Software on Mobile Devices, Laptops, Workstations and Servers}
\item {\bf CIS Control 6: Maintenance, Monitoring and Analysis of Audit Logs}
\item {\bf CIS Control 10: Data Recovery Capabilities}
\end{list2}


\slide{Inventory and Control of Hardware Assets}

\begin{quote}
CIS Control 1:\\
Inventory and Control of Hardware Assets\\
Actively manage (inventory, track, and correct) all hardware devices on the network so that only authorized devices are given access, and unauthorized and unmanaged devices are found and prevented from gaining access.
\end{quote}

\begin{list1}
\item What is connected to our networks?
\item What firmware do we need to install on hardware?
\item Where IS the hardware we own?
\item What hardware is still supported by vendor?
\end{list1}

Source: Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf


\slide{Inventory and Control of Software Assets}

\begin{quote}
CIS Control 2:\\
Inventory and Control of Software Assets\\
Actively manage (inventory, track, and correct) all software on the network so that only authorized software is installed and can execute, and that all unauthorized and unmanaged software is found and prevented from installation or execution.
\end{quote}

\begin{list1}
\item What licenses do we have? Paying too much?
\item What versions of software do we depend on?
\item What software needs to be phased out, upgraded?
\item What software do our employees need to support?
\end{list1}

Source: Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf


\slide{Continuous Vulnerability Management}

\begin{quote}
CIS Control 3:\\
Continuous Vulnerability Management\\
Continuously acquire, assess, and take action on new information in order to identify vulnerabilities, remediate, and minimize the window of opportunity for attackers.
\end{quote}

\begin{list1}
\item Scan for updates automatically
\item Update when vendors publish critical patches
\item Listen to news sources about software and vulnerabilities
\end{list1}

Source: Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf


\slide{Controlled Use of Administrative Privileges}

\begin{quote}
CIS Control 4:\\
Controlled Use of Administrative Privileges\\
The processes and tools used to track/control/prevent/correct the use, assignment, and configuration of administrative privileges on computers, networks, and applications.
\end{quote}

\begin{list1}
\item Remove local administrator from Windows workstations
\item Change default passwords
\item Use good passwords
\item Log if somebody tries to break in
\end{list1}

Source: Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf


\slide{Secure Configuration for Hardware and Software}

\begin{quote}
CIS Control 5:\\
Secure Configuration for Hardware and Software on Mobile Devices, Laptops, Workstations and Servers\\
Establish, implement, and actively manage (track, report on, correct) the security configuration of mobile devices, laptops, servers, and workstations using a rigorous configuration management and change control process in order to prevent attackers from exploiting vulnerable services and settings.
\end{quote}

\begin{list1}
\item Create secure configuration -- check security settings
\item Select security mechanisms
\item Automate security settings
\end{list1}

Source: Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf


\slide{Maintenance, Monitoring and Analysis of Audit Logs}

\begin{quote}
CIS Control 6:\\
Maintenance, Monitoring and Analysis of Audit Logs\\
Collect, manage, and analyze audit logs of events that could help detect, understand, or recover from an attack.
\end{quote}

\begin{list1}
\item ... and present it, use it daily, report it to management!
\item
\item
\item
\end{list1}

Source: Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf


\slide{Data Recovery Capabilities}

\begin{quote}
CIS Control 10:\\
Data Recovery Capabilities\\
The processes and tools used to properly back up critical information with a proven methodology
for timely recovery of it
\end{quote}

\begin{list1}
\item Backup is critical
\item If we loose orders we loose money
\item Data loss, means production capacity loss
\item Separation of duty -- can one person delete both production and backup
\end{list1}

Source: Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf


\slide{How do we get started?}

\begin{quote}
  “A goal without a plan is just a wish.”\\
  -- Antoine de Saint-Exupéry
\end{quote}

\begin{list2}
\item Get management support -- without it, don't bother, get a new job, avoid the stress
\item Create goals and plans
\item Aquire the skills
\item Follow the plan, let some servers burn, shut them down if you are doing something more important
\item My suggestion is to start with the network, since it supports everything else
\end{list2}

And, I mean it seriously, without management support, eject and go somewhere else!


\slide{My daily job -- Security engineering a job role}

\begin{alltt}\footnotesize
On any given day, you may be challenged to:
    Create new ways to solve existing production security issues
    Configure and install firewalls and intrusion detection systems
    Perform vulnerability testing, risk analyses and security assessments
    Develop automation scripts to handle and track incidents
    Investigate intrusion incidents, conduct forensic investigations and incident responses
    Collaborate with colleagues on authentication, authorization and encryption solutions
    Evaluate new technologies and processes that enhance security capabilities
    Test security solutions using industry standard analysis criteria
    Deliver technical reports and formal papers on test findings
    Respond to information security issues during each stage of a project’s lifecycle
    Supervise changes in software, hardware, facilities, telecommunications and user needs
    Define, implement and maintain corporate security policies
    Analyze and advise on new security technologies and program conformance
    Recommend modifications in legal, technical and regulatory areas that affect IT security
\end{alltt}

Source: \url{https://www.cyberdegrees.org/jobs/security-engineer/}\\
also
\url{https://en.wikipedia.org/wiki/Security_engineering}


\slide{Prerequisites for network security}

\begin{list1}
\item Network security and most internet related security work has the following requirements:
\begin{list2}
\item Network experience
\item TCP/IP principles - often in more detail than a common user
\item Programming is an advantage, for automating things
\item Some Linux and Unix knowledge is in my opinion a {\bf necessary skill} for infosec work\\
-- too many new tools to ignore, and lots found at sites like Github and Open Source written for Linux
\end{list2}
\end{list1}

IF you have some basic Linux skills you can immediately use 1.000s of existing projects like: Ansible, Git, Suricata, Zeek, Nmap, logging solutions, LibreNMS, maltrail, packetbeat, Elastic ECS, ...

They WILL make your work more efficient

\slide{Aquire Skills -- books are one example }

Recommended literature from my system security and communication and network security course::
\begin{list2}
\item \emph{Defensive Security Handbook: Best Practices for Securing Infrastructure}, Lee Brotherston, Amanda Berlin ISBN: 978-1-491-96038-7 284 pages
\item \emph{Applied Network Security Monitoring Collection, Detection, and Analysis}, 2014 Chris Sanders \\
ISBN: 9780124172081 - shortened ANSM
\item \emph{Practical Packet Analysis - Using Wireshark to Solve Real-World Network Problems}, 3rd edition 2017, \\
Chris Sanders ISBN: 9781593278021 - shortened PPA
\item \emph{Forensics Discovery}, Dan Farmer, Wietse Venema 2004, Addison-Wesley 240 pages. Can be found at \link{http://www.porcupine.org/forensics/forensic-discovery/}
\item \emph{Linux Basics for Hackers Getting Started with Networking, Scripting, and Security in Kali}. OccupyTheWeb, December 2018, 248 pp. ISBN-13: 978-1-59327-855-7 - shortened LBfH
\end{list2}

All lecture plans for my courses are freely available at:
\link{https://github.com/kramse/kea-it-sikkerhed}

\slide{Primary literature for SIEM and Logging course}

\hlkrightpic{5cm}{0cm}{old_book_lumen_design_st_01.png}
Primary literature:
\begin{list2}
\item \emph{Data-Driven Security: Analysis, Visualization and Dashboards} Jay Jacobs, Bob Rudis\\
ISBN: 978-1-118-79372-5 February 2014 \url{https://datadrivensecurity.info/} - short DDS
\item \emph{Crafting the InfoSec Playbook: Security Monitoring and Incident Response Master Plan}\\
 by Jeff Bollinger, Brandon Enright, and Matthew Valites ISBN: 9781491949405 - short CIP
\item \emph{Intelligence-Driven Incident Response} \\
 Scott Roberts ISBN: 9781491934944 - short IDI
\item \emph{Security Operations Center: Building, Operating, and Maintaining your SOC}\\
ISBN: 9780134052014 Joseph Muniz - short SOC
\end{list2}

All lecture plans for my courses are freely available at:
\link{https://github.com/kramse/kea-it-sikkerhed}


\slide{Goals: Gain insight using Graphs and Dashboards!}

\hlkimage{13cm}{observium-screenshot.png}


\slide{Graphs and Dashboards!}

\hlkimage{16cm}{Logstash1.png}

\vskip 2cm
\begin{list2}
\item Screenshot from Peter Manev, OISF
\item Shown are Suricata IDS alerts processed by Logstash and Kibana
\end{list2}





\slide{View data efficiently}

\hlkimage{12cm}{logstash-search.png}

\begin{list1}
\item View data by digging into it easily - must be fast
\item Logstash and Kibana are just examples, but use indexing to make it fast!
\end{list1}




\slide{Networks today}
\hlkimage{14cm}{overview-routing-customer-2015.pdf}



\slide{Defense in depth - multiple layers of security}

\hlkimage{14cm}{network-layers-1.pdf}

\slide{ Netflow NFSen}

\hlkimage{14cm}{nfsen-udp-flood.png}

\centerline{An extra 100k packets per second from this netflow source (source is a router)}


\slide{DDoS traffic before filtering}
\hlkimage{20cm}{ddos-before-filtering}

\centerline{Only two links shown, at least 3Gbit incoming for this single IP}

\slide{DDoS traffic after filtering}
\hlkimage{20cm}{ddos-after-filtering}

\begin{list1}
\item Link toward server (next level firewall actually) about ~350Mbit outgoing
\item Knowing what it going on, is half the battle
\end{list1}

\slide{How to get started}

\begin{list1}
\item How to get started searching for security events?
\item Collect basic data from your devices and networks
\begin{list2}
\item Netflow data from routers
\item Session data from firewalls
\item Logging from applications: email, web, proxy systems
\end{list2}
\item {\bf Centralize!}
\item Process data
\begin{list2}
\item Top 10: interesting due to high frequency, occurs often, brute-force attacks
\item {\it ignore}
\item Bottom 10: least-frequent messages are interesting
\end{list2}
\end{list1}

Sounds easy, but is complex in practice

\slide{Hændelseslog og Økonomi}

Tag et stykke papir eller en computer
\begin{list2}
\item Vi er lige blevet afbrudt i vores vigtige arbejde med CIS kontroller
\item Vi skal udfylde en Hændelseslog og der er nogle økonomiske aspekter
\item Når der sker en sikkerhedshændelse skal den helst håndteres effektivt
\item Hvis man ikke har sikkerhedsprocedurer på plads bliver det typisk længerevarende og dyrere
\end{list2}


{\bf Det er en erkendelse i sig selv at vi skal være klar til at håndtere sikkerhedshændelser, for de kommer}


\slide{March 2021: ProxyLogon/ProxyShell CVE-2021-26855 CVSS:3.0 9.1 / 8.4}
\begin{quote}
In March 2021, both Microsoft and IT Professionals had a major headache in the form of an Exchange zero-day commonly known as ProxyLogon. The vulnerability, widely considered the {\bf most critical to ever hit Microsoft Exchange}, was quickly exploited in the wild by suspected state-sponsored threat actors, with US government and military systems identified as the most targeted sectors. {\bf Ransomware variants such as DoejoCrypt were soon actively exploiting unpatched Exchange instances}, attempting to monetise the vulnerability.

A follow-up exploit, dubbed ProxyShell, was evolutionary in nature and targeted on-premise Client Access Servers (CAS) in {\bf all supported versions of Exchange Server.} Due to the {\bf remotely accessible nature of Exchange CAS, any unpatched instances would be vulnerable to Remote Code Execution. High profile victims included the European Banking Authority and the Norwegian Parliament.}
\end{quote}
Source - for this description:\\
\link{https://chessict.co.uk/resources/blog/posts/2022/january/2021-top-security-vulnerabilities/}


\slide{ProxyLogon CVE-2021-26855 CVSS:3.0 9.1 / 8.4}

\begin{quote}
ProxyLogon is the formally generic name for CVE-2021-26855, a vulnerability on Microsoft Exchange Server that allows an attacker bypassing the authentication and impersonating as the admin. We have also chained this bug with another post-auth arbitrary-file-write vulnerability, CVE-2021-27065, to get code execution. All affected components are vulnerable by default!

As a result, {\bf an unauthenticated attacker can execute arbitrary commands on Microsoft Exchange Server through an only opened 443 port!}
\end{quote}

Sources: \link{https://proxylogon.com/}\\
\link{https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855}



\slide{Incident Handling: ProxyLogon}

Hvis jeres organisation har implementeret CIS Control 2: Inventory and Control of Software Assets, noter følgende:
\begin{list2}
\item Hændelseslog: Marts Proxylogin - nem oprydning, ingen nedetid
\item Økonomi: Marts Proxylogin oprydning EUR 3.000
\end{list2}


Hvis jeres organisation *IKKE* har implementeret CIS Control 2: Inventory and Control of Software Assets, noter følgende:
\begin{list2}
\item Hændelseslog: Marts Proxylogin -- mailservere inficeret 3 steder, ekstern hjælp nødvendig, nedetid 2 dage
\item Økonomi: Marts Proxylogin oprydning EUR 3.000
\item Økonomi: Marts ProxyLogon hændelseshåndtering ekstern hjælp EUR 10.000
\end{list2}



\slide{June 2021: PrintNightmare CVE-2021-34527 CVSS:3.0 8.8 / 8.2}
\begin{quote} \small
In June, Microsoft released a critical security update to address weaknesses in the Printer Spooler service on Windows desktop and server platforms. Unfortunately, it was released out-of-band outside of the standard patch Tuesdays due to the severity. Microsoft even released patches for Windows 7, an supported operating system that does not normally receive updates.

Initially categorised by Microsoft as a local privilege escalation on Windows, security researchers subsequently identified an additional {\bf Remote Code Execution (RCE)} vector resulting in an updated advisory from Microsoft. As ever, the ability to test and deploy patches in a time-sensitive manner is key to minimising the impact of such vulnerabilities.

Additionally, PrintNightmare had the additional horror factor of dropping during the {\bf summer holiday season in the northern hemisphere}. Our consultants continue to see systems vulnerable to PrintNightmare on client engagements, which can be trivially leveraged to obtain privilege escalation on unpatched Windows systems.
\end{quote}

Source - for this description:\\
\link{https://chessict.co.uk/resources/blog/posts/2022/january/2021-top-security-vulnerabilities/}

See also \link{https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527}


\slide{Incident Handling: PrintNightmare}

Hvis jeres organisation har implementeret CIS Control 2: Inventory and Control of Software Assets, noter følgende:
\begin{list2}
\item Hændelseslog: Juni PrintNightmare - nem oprydning, ingen nedetid
\item Økonomi: Juni PrintNightmare oprydning EUR 3.000
\end{list2}


Hvis jeres organisation *IKKE* har implementeret CIS Control 2: Inventory and Control of Software Assets, noter følgende:
\begin{list2}
\item Hændelseslog: Juni PrintNightmare -- servere inficeret, geninstallation nødvendig, nedetid 3 dage
\item Økonomi: Juni PrintNightmare oprydning EUR 3.000
\item Økonomi: Juni PrintNightmare hændelseshåndtering ekstern hjælp EUR 10.000
\end{list2}

Da denne skete i ferien er der desværre også brugt mere tid på at håndtere sagen, alle sætter ekstra EUR 3.000 på listen med teksten "Grundet ferie og manglende ressourcer 3.000"



\slide{November 2021: Log4Shell}
\begin{quote}\small
It would not be possible to discuss 2021 in the context of vulnerabilities without the mention of Log4Shell. {\bf A widely used Java-based logging library caused headaches for Security professionals worldwide}. Many scrambled to quantify their use of Log4j within their estates.

A zero-day exploit quickly followed, confirming the worst - {\bf Remote Code Execution (RCE) was indeed possible.} However, what made the nature of the vulnerability even more challenging was the ability to exploit a backend logging system from an unaffected front end host. For example, an attacker can craft a weaponised log entry on a mobile app or webserver not running Log4j. The attacker could make their way through to backend middleware itself running Log4j, which significantly extends the attack surface of the vulnerability.

The NCSC even took the step of recommending the update was immediately applied, whether or not Log4Shell was known to be in use. As is commonly the case with critical vulnerabilities, two successive Log4j patches were subsequently released in the week following the original addressing Denial of Service (DoS) and a further RCE. This further increased workloads of Security and IT teams just as they thought the worst of 2021 had been and gone.
\end{quote}
Source - for this description:\\
\link{https://chessict.co.uk/resources/blog/posts/2022/january/2021-top-security-vulnerabilities/}

See also \link{https://en.wikipedia.org/wiki/Log4Shell}



\slide{Incident Handling: Log4Shell}

Hvis jeres organisation har implementeret CIS Control 1+2 og ingen Java har, noter følgende:
\begin{list2}
\item Hændelseslog: November Log4Shell - nem oprydning, ingen nedetid
\item Økonomi: November Log4Shell oprydning EUR 3.000
\end{list2}


Hvis jeres organisation *IKKE* har implementeret CIS kontroller, noter følgende:
\begin{list2}
\item Hændelseslog: November Log4Shell -- mailservere inficeret 3 steder, ekstern hjælp nødvendig, nedetid 2 dage
\item Økonomi: November Log4Shell oprydning EUR 3.000
\item Økonomi: November Log4Shell hændelseshåndtering ekstern hjælp EUR 10.000
\end{list2}

Hvis jeres organisation har et stort netværk uden segmentering og filtrering:\\
{\bf afsæt EUR 100.000 til fremtidige sikkerhedsproblemer nu}




\slide{Vulnerabilities - CVE}

\begin{list1}
\item Common Vulnerabilities and Exposures (CVE):
  \begin{list2}
  \item classification
  \item identification
  \end{list2}
\item When discovered each vuln gets a CVE ID
\item CVE maintained by MITRE - not-for-profit
org for research and development in the USA.
\item National Vulnerability Database search for CVE.
\item Sources: \link{http://cve.mitre.org/} og \link{http://nvd.nist.gov}
\item also checkout OWASP Top-10 \link{http://www.owasp.org/}
\end{list1}


\slide{The Internet Worm 2. nov 1988}

\begin{list1}
\item Exploited the following vulnerabilities
\begin{list2}
\item buffer overflow in fingerd - VAX code
\item Sendmail - DEBUG functionality
\item Trust between systems: rsh, rexec, ...
\item Bad passwords
\end{list2}
\item Contained camouflage!
\begin{list2}
\item Program name set to 'sh'
\item Used fork() to switch PID regularly
\item Password cracking using intern list of 432 words and /usr/dict/words
\item Found systems to infect in /etc/hosts.equiv, .rhosts, .forward, netstat ...
\end{list2}
\item Made byRobert T. Morris, Jr.
\end{list1}


\slide{Stuxnet}

\begin{list1}
\item Worm in 2010 intended to infect Iran nuclear program
\item Target was the uranium enrichment process
\item Infected other industrial sites
\item SCADA, and Industrial Control Systems (ICS) are becoming very important for whole countries
\item A small \emph{community} of consultants work in these \emph{isolated} networks, but can be used as infection vector - they visit multiple sites
\item More can be found in \url{https://en.wikipedia.org/wiki/Stuxnet}
\end{list1}


\slide{Ransomware}


\begin{list1}
\item {\bf Defition 23-21} \emph{Ransomware} is malware that inhibits the use of resources until a ransom usually monetary, is paid.
\item Book mentions 1989 example, PC CYBORG targetting PC/DOS computers
\item Uses cryptography to render data unreadable
\item Has become a huge problem for enterprises during the last 5-10 years
\item Often uses crypto-currencies today, like BitCoin (BTC) for payment
\item Often contains errors so decryption is impossible, or possible without payment!
\end{list1}

Source:
\emph{Computer Security: Art and Science}, Matt Bishop ISBN: 9780321712332\\
{\footnotesize\link{https://www.pearson.com/us/higher-education/program/Bishop-Computer-Security-2nd-Edition/PGM25107.html}}


\slide{MITRE ATT\&CK framework}

\hlkimage{14cm}{mitre-attack.png}

Great resource for attack categorization
\link{https://attack.mitre.org/}

\slide{Attack trees}

\hlkimage{7cm}{paper-attacktrees-fig1.png}

\begin{list2}
\item Attacks can be said to be based on a chain of dependencies, or graphs
\item To achieve goal, need to achieve sub goal x, y, and z -- Break the chain and the attack fails!
\item Simple example, installing updates remove a dependency for a vulnerability
\item Attack trees, picture from Bruce Schneier Attack Trees article December 1999:\\ {\footnotesize\link{https://www.schneier.com/academic/archives/1999/12/attack_trees.html}}
\end{list2}

\slide{Exposure, Attack surfaces, and reducing them}

\begin{list2}
\item Incident prevention
\item Real-time intrusion detection systems (IDS/IPS)
\item {\bf Definition 27-7} An \emph{attack surface} is the set of entry points and data that attackers can use to compromise a system.
\item Reducing the chance of success also helps, randomization
\item Use stack and heap protection
\item Address space layout randomization (ASLR) is a host-level moving target defense.
\item OpenBSD even randomizes the kernel on install -- kernel address randomized link (KARL)
\item Limit number of listening services, change insecure defaults, implement access control and firewalls
\item Remove anything but the necessary request methods on web servers \verb+GET+, \verb+HEAD+ and \verb+POST+
\item Restrict access to administrative interfaces
\item Implement network segmentation
\end{list2}



\slide{CWE/SANS Monster mitigations}

\hlkimage{13cm}{cwe-monster-mitigations.png}

Source: use the more updated list online
\link{http://cwe.mitre.org/top25/index.html}



\slide{Principle of Least Privilege}

\begin{list1}
\item {\bf Definition 14-1} The \emph{principle of least privilege} states that a subject should be given only those privileges that it needs in order to complete the task.
\item Also drop privileges when not needed anymore, relinquish rights immediately
\item Example, need to read a document - but not write.
\item Database systems can often provide very fine grained access to data
\end{list1}

Source:
\emph{Computer Security: Art and Science}, Matt Bishop ISBN: 9780321712332\\
{\footnotesize\link{https://www.pearson.com/us/higher-education/program/Bishop-Computer-Security-2nd-Edition/PGM25107.html}}

\slide{Principle of Fail-Safe defaults}

\begin{list1}
\item {\bf Definition 14-3} The \emph{principle of fail-safe defaults} states that, unless a subject is given explicit access to an object, it should be denied access to that object.
\item Default access \emph{none}
\item In firewalls default-deny - that which is not allowed is prohibited
\item Newer devices today can come with no administrative users, while older devices often came with default admin/admin users
\item Real world example, OpenSSH config files that come with \verb+PermitRootLogin no+
\end{list1}

Source:
\emph{Computer Security: Art and Science}, Matt Bishop ISBN: 9780321712332\\
{\footnotesize\link{https://www.pearson.com/us/higher-education/program/Bishop-Computer-Security-2nd-Edition/PGM25107.html}}


\slide{Principle of Separation of Privilege -- Defense in Depth}

\hlkimage{4cm}{security-layers-1-uk.pdf}
\begin{list1}
\item {\bf Definition 14-7} The \emph{principle of separation of privilege} states that a system should not grant permission based on a single condition.
\item Company checks, CEO fraud
\item Programs like \emph{su} and \emph{sudo} often requires specific group membership and password
\end{list1}

\slide{Fokus \the\year}

\begin{list2}
\item Brugerstyring
\item Asset management
\item Laptop sikkerhed
\item VPN alle steder
\item Penetration testing
\item Firewalls og segmentering
\item TLS og VPN indstillinger
\item DNS og email
\item Syslog og monitorering
\item Incident Response og reaktion
\end{list2}

Check eventuelt IT sikkerhedsupdate 2019 præsentationen:\\
{\small\link{https://github.com/kramse/security-courses/tree/master/presentations/misc/it-sikkerhedsupdate-2019}}

\slide{Design a robust network Isolation and segmentation}

\begin{list1}
\item Hvad kan man gøre for at få bedre netværkssikkerhed?
\begin{list2}
\item Bruge switche - der skal ARP spoofes og bedre performance
\item Opdele med firewall til flere DMZ zoner for at holde
      udsatte servere adskilt fra hinanden, det interne netværk og
      Internet
\item Overvåge, læse logs og reagere på hændelser
\end{list2}
\item Husk du skal også kunne opdatere dine servere
\end{list1}

\slide{Basic Network Security Pattern Isolate in VLANs}

\hlkimage{10cm}{images/demo-netvaerk.pdf}

\begin{list1}
\item Du bør opdele dit netværk i segmenter efter trafik
\item Du bør altid holde interne og eksterne systemer adskilt!
\item Du bør isolere farlige services i jails og chroots
\item Brug port security til at sikre basale services DHCP, Spanning Tree osv.
\end{list1}


\slide{Example incident response procedures}

\begin{quote}
  5.4  Handling an Incident

     Certain steps are necessary to take during the handling of an
     incident.  In all security related activities, the most important
     point to be made is that all sites should have policies in place.
     Without defined policies and goals, activities undertaken will remain
     without focus. The goals should be defined by management and legal
     counsel in advance.
\end{quote}

\begin{list2}
\item \emph{Incident Handler's Handbook}
  by Patrick Kral, SANS Information Security Reading Room\\
  {\footnotesize \link{https://www.sans.org/reading-room/whitepapers/incident/paper/33901}}
  \item \emph{Computer Security
Incident Handling Guide}, NIST Paul Cichonski,
Tom Millar,
TimGrance,
Karen Scarfone\\ {\footnotesize\link{https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf}}
\item Quote from RFC2196 \emph{Site Security Handbook} September 1997, IETF\\
{\footnotesize\url{https://tools.ietf.org/html/rfc2196#section-5.4}}
\item \link{https://cloud.google.com/security/incident-response/}
\item Microsoft Azure
\link{https://medium.com/@cloudyforensics/azure-forensics-and-incident-response-c13098a14d8d}
\end{list2}


\slide{Incident Handling Checklist from NIST.SP.800-61r2.pdf}

\hlkimage{12cm}{incident-handling-checklist.png}



% Vi bruger input fra almindelige exploits brugt i 2021 og Mitre ATT&CK, og ser på hvordan de matcher mod Defense in Depth, firewalling, filtrering, kendte sikkerhedsmekanismer m.v. Du behøver ikke bruge millioner på nyeste AI værktøj. Vi bruger erfaringer og viden opsamlet gennem 30 år, men anvendt på moderne angreb og exploits, incident response, til at skabe indsigt og detektering af angreb.

% Målgruppe er alle, som er interesserede i at holde systemer og netværk sikre. Nøgleord:

% Firewalls, Network segmentation, hardening. Materialer på engelsk men præsenteres på dansk.Open Source materials på Github: github.com/kramse/security-courses/



\slide{Concrete advise for enterprise networks}


\begin{list2}
\item Have separation -- anywhere, starting with organisation units, management networks, server networks, customers, guests, LAN, WAN, Mail, web, ...
\item Use Web proxies - do not allow HTTP directly except for a short allow list, \\
do not allow traffic to and from any new TLD
\item Use only your own DNS servers, create a pair of Unbound servers, \\
point your internal DNS running on Windows to these\\
Create filtering, logging, restrictions on these Unbound DNS servers\\
\link{https://www.nlnetlabs.nl/projects/unbound/about/} and also \link{https://pi-hole.net/}
\item Only allow SMTP via your own mail servers, create a simple forwarder if you must
\end{list2}

Allow lists are better than block list, even if it takes some time to do it

\slide{Capture data and logs!}


\begin{list2}
\item Run DNS query logs -- when client1 is infected with malware from domain malwareexample.com, then search for more clients infected
\item Run Zeek and gather information about all HTTPS sessions -- captures certificates by default, and we can again search for certificate related to malwareexample.com
\item Run network logging -- session logs in enterprise networks are GREAT \\
(country wide illegal logging is of course NOT)
\end{list2}

Make sure to check with employees, inform them!

\slide{Default permit}

%\hlkimage{}{}

One of the early implementers of firewalls Marcus J. Ranum summarized in 2005 The Six Dumbest Ideas in Computer Security \link{https://www.ranum.com/security/computer_security/editorials/dumb/} which includes the always appropriate discussion about default permit versus default deny.

\begin{quote}\small {\bf
\#1) Default Permit}\\
This dumb idea crops up in a lot of different forms; it’s incredibly persistent and difficult to eradicate. Why? Because it’s so attractive. Systems based on ”Default Permit” are the computer security equivalent of empty calories: tasty, yet fattening.

The most recognizable form in which the ”Default Permit” dumb idea manifests itself is in firewall rules. Back in the very early days of computer security, network managers would set up an internet connection and decide to secure it by turning off incoming telnet, incoming rlogin, and incoming FTP. Everything else was allowed through, hence the name ”Default Permit.” This put the security practitioner in an endless arms-race with the hackers.
\end{quote}


\begin{list2}
\item Allow all current networks today on all ports for all protocols \emph{is} an allow list \\
Which tomorrow can be split into one for TCP, UDP and remaining, and measured upon
\item Measure, improve, repeat
\end{list2}



\slide{We cannot do X}

\begin{quote}
We cannot block SMTP from internal networks, since we do not know for sure if vendor X equipment needs to send the MOST important email alert at some unspecific time in the future
\end{quote}

Cool, then we can do an allow list starting today on our border firewall:
\begin{alltt}
table <smtp-exchange> \{ $exchange1 $exchange2 $exchange3 \}
table <smtp-unknown> persist file "/firewall/mail/smtp-internal-unknown.txt"
# Regular use, allowed
pass out on egress inet proto tcp from smtp-echange to any port 25/tcp
# Unknown, remove when phased out
pass out on egress inet proto tcp from smtp-internal to any port 25/tcp
\end{alltt}

Year 0 the unknown list may be 100\% of all internal networks, but new networks added to infrastructure are NOT added, so list will shrink -- evaluate the list, and compare to network logs, did networks send ANY SMTP for 1,2,3 years?


\slide{DROP SOME TRAFFIC NOW}

\begin{list2}
\item Drop some traffic on the border of everything
\item Seriously do NOT allow Windows RPC across borders
\item Border here may be from regional country office back to HQ
\item Border may be from internet to internal networks
\item Block Windows RPC ports, 135, 137, 139, 445
\item Block DNS directly to internet, do not allow clients to use any DNS, fake 8.8.8.8 if you must internally
\item Block SMTP directly to internet
\item Create allow list for internal networks, client networks should not contact other client networks but only relevant server networks
\end{list2}

You DONT need to allow direct DNS towards internet, except from your own recursive DNS servers

If you get hacked by Windows RPC in 2022, you probably deserve it, sorry for being blunt

Best would be to analyze traffic and create allow lists, some internal networks to not need internet at all



\slide{Roundtable}

\begin{list2}
\item Lets discuss
\item Are the proposed methods workable, why or why not
\item Do you have time and skills
\item Can't we just hire someone
\end{list2}

Open mike night

\hlkprofiluk

\end{document}
