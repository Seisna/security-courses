\documentclass[Screen16to9,17pt]{foils}
\usepackage{zencurity-slides}
\externaldocument{pentest-III-exercises}
%
% Arrangement: Penetration testing III - Wireless sikkerhed
% Mål:	Introduktion til penetrationstest af wireless netværk.

% Forudsætninger:	Der forventes kendskab til TCP/IP på brugerniveau.
% Beskrivelse:	Trådløse netværk er overalt og alle nye bærbare
% computere leveres som standard med trådløse netkort. Desværre er
% sikkerheden i de trådløse netværk ikke altid god nok og det giver
% anledning til bekymring.

% * Introduktion til IEEE 802.11 gruppen af standarder
% * Sikkerhedsteknologier i IEEE 802.11b - WEP, forkortes, men stadig relevant
% * Sikkerhedsteknologier i IEEE 802.11 - WPA, WPA2, WPA3 WPS
% * Scannerprogrammer og wardriving
% * airodump og aircrack-ng pakken af værktøjer
% * Packet injection med wireless værktøjer
% * Opsætning af trådløse netværk og forbindelse til andre netværk

% Der vil være demonstrationer af sårbarheder på alle foredragene - typisk med
% open source programmer, således at deltagerne kan afprøve de selvsamme demoer
% hjemme.

% Note: der tages udgangspunkt i open source og Kali Unix.

% Note: der forsøges arrangeret fællesindkøb af et billigt wireless-kort omkring 100kr
% - det er ikke krav at man køber et sådant, men det kan lette kursusafviklingen


\begin{document}


%{Penetration testing II\\\normalsize webbaserede angreb}

\mytitlepage
{Penetration testing III\\ Wireless sikkerhed}

%\begin{alltt}
%\tiny
%\centerline{$Id: pentest-III-foredrag.tex,v 1.3 2008/03/05 13:06:36 hlk Exp $}
%\end{alltt}

\LogoOn


\slide{Plan}

\begin{list1}
\item Subjects
\begin{list2}
\item Introduce pentest in wireless applications and related technologies
\item Basic wi-fi security concepts
\item Applying basic security assessment skills
\item Point towards some of the most important resources in this subject
\item Introduce scanning with aircrak-ng suite of programs and others
\item Make it possible to get started hacking on wi-fi networks
\end{list2}
\item Demos and recommendations for exercises
\begin{list2}
\item Running various tools
\end{list2}
\end{list1}

{\bf Whenever it say exercise, it will be a demo!}

\slide{Goals}
\vskip 1 cm

\hlkimage{5cm}{dont-panic.png}
\centerline{\color{titlecolor}\LARGE Don't Panic!}


\begin{list1}
\item Inspire you to implement wireless networks securely

\item by showing insecurities in the previous versions

\item and listing alternatives for long term wireless security
\end{list1}


\slide{Goals for today, continued}

\begin{quote}
It is not clear that the link layer is the right one for security. In a coffeeshop, the security association is terminated by the store: is there any reason you should trust the shopkeeper? Perhaps link-layer security makes some sense in a home, where you control both the access point and the wireless machines. However, we prefer end-to-end security at the network layer or in the
applications.
\end{quote} Source: Cheswick-chap2.pdf Firewalls and Internet Security: Repelling the Wily Hacker , Second Edition, 2003, William R. Cheswick, Steven M. Bellovin, and Aviel D. Rubin

Todays goals:
\begin{list2}
\item Introduce wireless networks and {\bf security in them}
\item Present the common security standards, and some tools used
\item Discuss how to secure wireless best, infrastructure and/or encryption
\item Wi-Fi security is more than just encryption
\end{list2}


%\dagsplan

\slide{Agreements for testing networks}

\begin{quote}\small
Danish Criminal Code\\
Straffelovens paragraf 263 Stk. 2. Med bøde eller fængsel indtil 1 år og 6 måneder straffes den, der uberettiget skaffer sig adgang til en andens oplysninger eller programmer, der er bestemt til at bruges i et informationssystem.

Husk også brevhemmeligheden
\end{quote}

Hacking can result in:
\begin{list2}
\item Getting your devices confiscated by the police
\item Paying damages to persons or businesses
\item If older getting a fine and a record -- even jail perhaps
\item Getting a criminal record, making it hard to travel to some countries and working in security
\item Fear of terror has increased the focus -- so dont step over bounds!
\end{list2}

Asking for permission and getting an OK before doing invasive tests!


\slide{Internet today}

\hlkimage{10cm}{images/server-client.pdf}

\begin{list1}
\item Clients and servers
\item Rooted in academia
\item Protocols that are from 1983 and some older
\item Originally very little encryption, now mostly on HTTPS/TLS
\end{list1}


\slide{Why talk about hacking wi-fi networks}

\centerline{\color{titlecolor}\LARGE\bf wireless 802.11}
\hlkimage{3cm}{12065572121317625675no_hope_Wireless_access_point.png}

\begin{list2}
\item Everything is wireless today
\item Even though HTTPS/TLS used for data transport in most applications
\item Core protocols like DNS are NOT encrypted, standards are coming
\item Gaining access to a LAN with wireless can open up the whole network to attacks
\item We need to deploy wireless technologies securely, even in the face of vulnerabilities found in protocols, algorithms, devices etc.
\end{list2}

TL;DR Use segmented networks with updated devices and strong encryption



\slide{Materials -- where to start}

\begin{list2}
\item This presentation -- slides for today, start here:\\
\url{https://github.com/kramse/security-courses/tree/master/presentations/pentest/pentest-II-foredrag}
\item Setup instructions for creating a Kali virtual machine:\\
\link{https://github.com/kramse/kramse-labs}
\item Communication and Network Security course\\{\footnotesize
\link{https://github.com/kramse/security-courses/tree/master/courses/networking/communication-and-network-security}}\\
Especially 6-Wifi-Security.pdf
\item Download the \emph{exercise booklet} for the Pentest courses:\\
\url{https://github.com/kramse/security-courses/tree/master/presentations/pentest/pentest-II-foredrag}\\
Using Nmap can show access afterwards and point out insecure devices
\end{list2}


\slide{Books and Educational Materials}

\hlkimage{5cm}{PracticalPacketAnalysis3E_cover.png}

\emph{Practical Packet Analysis,
Using Wireshark to Solve Real-World Network Problems}
by Chris Sanders, 3rd Edition
April 2017, 368 pp.
ISBN-13:
978-1-59327-802-1
\link{https://nostarch.com/packetanalysis3}

{\bf Anything you know about technology will help you hack it, so learn basic functionality first}


\slide{Reading Summary, continued}

\begin{alltt}\footnotesize

\end{alltt}

\begin{list1}
\item PPA chapter 12: Packet Analysis for Security
\begin{list2}
\item Reconnaissance An attacker’s first step
\item SYN Scan and fingerprinting
\item Traffic Manipulation ARP Cache Poisoning / spoofing
\item  Analyzing traffic from malware, exploit kits and ransomware
\end{list2}
\end{list1}

\begin{list1}
\item PPA chapter 13: Wireless Packet Analysis
\begin{list2}
\item Sniffing channels
\item Wireless card modes, Managed, Ad-hoc and Monitor mode
\item 802.11 packet structure
\item Wireless security
\end{list2}
\end{list1}




\slide{Hacker tools}

\hlkimage{3cm}{hackers_JOLIE+1995.jpg}

\begin{list2}
\item Everyone use similar tools, scanning in monitor mode etc.

\item I recommend Aircrack-ng as it has excellent documentation \link{https://www.aircrack-ng.org/}
\item These tools are low-level and functionality is often automated in other apps, even mobile apps
\item Afterwards we again use common pentesting tools:
\item Portscanning Nmap, Nping -- test ports and services, Nping is great for firewall admins \link{https://nmap.org}
\item Wireshark avanceret netværkssniffer - \link{http://http://www.wireshark.org/}
\end{list2}

Picture: Acid Burn / Angelina Jolie Hackers 1995


\slide{What happens now?}

\begin{list1}
\item Think like a hacker
\item Reconnaissance
\begin{list2}
\item ping sweep, port scan
\item OS detection -- TCP/IP or banner grabbing
\item Service scan -- rpcinfo, netbios, ...
\item telnet/netcat interact with services
\end{list2}
\item Exploit/test: Metasploit, Nikto, exploit programs
\end{list1}

Try to limit to wireless today

\slide{Hacker lab setup}

\hlkimage{6cm}{hacklab-1.png}

\begin{list2}
\item Hardware: modern laptop CPU with virtualisation\\
Dont forget to enable hardware virtualisation in the BIOS
\item Virtualisation software: VMware, Virtual box, HyperV pick your poison
\item Linux server system: Debian amd64 64-bit \link{https://www.debian.org/}
\item Setup instructions can be found at \link{https://github.com/kramse/kramse-labs}
\item Target: Wireless networks!
\item Bought some \emph{shitty routers}
\end{list2}



\slide{Hacking is magic}

\hlkimage{5cm}{wizard_in_blue_hat.png}

\vskip 1 cm

\centerline{Hacking looks like magic -- especially buffer overflows}


\slide{Hacking is not magic}

\hlkimage{14cm}{ninjas.png}

\centerline{Hacking only demands ninja training and knowledge others don't have}

It is like a puzzle, we need this, this and that. Make it happen in a repeatable way.


\slide{Hacking example not magic MAC addresses}


\begin{quote}
A MAC address (short for medium access control address) is a {\bf unique identifier} assigned to a {\bf network interface controller (NIC)} for use as a network address in communications within a network segment.

This use is common in most IEEE 802 networking technologies, including {\bf Ethernet, Wi-Fi, and Bluetooth}. Within the Open Systems Interconnection (OSI) network model, MAC addresses are used in the medium access control protocol sublayer of the data link layer. As typically represented, MAC addresses are {\bf recognizable as six groups of two hexadecimal digits}, separated by hyphens, colons, or without a separator.

MAC addresses are primarily {\bf assigned by device manufacturers}, and are therefore often referred to as the {\bf burned-in address}, or as an Ethernet hardware address, hardware address, or physical address. Each address can be stored in the interface hardware, such as its read-only memory, or by a firmware mechanism. {\bf Many network interfaces, however, support changing their MAC addresses}.
\end{quote}
Source: \url{https://en.wikipedia.org/wiki/MAC_address}

\begin{list2}
\item Great a unique address, we can use that for security!!!1111
\end{list2}


\slide{MAC filtering}

\hlkimage{15cm}{ethernet-frame-1.pdf}
\begin{list2}
\item  Filtering on the \emph{unique} address sounds great
\item Allow only a list of permitted addresses, cards -- systems to join!
\vskip 5mm
\item Wait, anyone can change their address on their cards?! Can they guess an allowed one of the 48 bits?
\end{list2}

\demo{ex:wardriving}
\demo{ex:aircrack-ng}

\slide{Myths about MAC filtering}

\begin{list1}
\item This example of MAC filtering is one of many security myths
\item Why does it happen?
\begin{list2}
\item Marketing - vendors keep selling producs listing MAC filtering as a security measure
\item Consumers has no knowledge about this -- choose the product with the longest list/the most features
\item Very few people actually look into this -- thanks for being here today!
\end{list2}
\item Help spread knowledge about insecure and secure methods for data and systems
\end{list1}

\slide{MAC filtering illustrated}

\hlkimage{12cm}{stupid-security.jpg}



\slide{Consequences and Impact}

\hlkimage{6cm}{images/wireless-daekning.pdf}

\begin{list2}
\item Can be worse than attacks across the internet -- anonymous
\item Does not require physical access inside building -- antennna and 100m
\item If broken then it will allow access to LAN and systems inside the organisation, and/or attacks on client systems
\end{list2}



\slide{More structured walk-through}


\begin{list1}
\item Introduction -- terms and technologies we cover
\item Basics in Wireless IEEE 802.11 -- as seen in wardriving
\item Hacking wireless networks
\item Security technologies in IEEE 802.11 short history lesson
\item Security technologies in {\bf IEEE 802.11i} -- Robust Security Networks
\item Tools airodump og aircrack-ng in a little more detail
\item Packet injection tools -- maybe not swown in detail
\item Recommendations for deploying wireless networks -- guest networks, firewalls and segmentation
\end{list1}

\vskip 1 cm

\centerline{\hlkbig Note: wireless security is definitely not only the encryption methods}


\slide{Tools}

\hlkimage{13cm}{kali-linux.png}

\begin{list2}
\item Aircrack-ng is a suite of tools
\item Wirelessscanner - Kali and Airodump
\item Wireless Injection - aireplay-ng
\end{list2}



\slide{Wireless hardware}

\hlkimage{14cm}{TL-WN722N.png}

\begin{list1}
\item Laptop or Netbook, I typically use USB wireless cards, not the built-in!
\item Access Points - get a small selection for testing
\item Author of aircrack-ng recommended these:
TP-Link MR3020 or TP-Link WR902AC Access Point. USB cards Alfa AWUS036AXML, AWUS036AXM, AWUS036ACM or AWUS036NHA
\item It can be hard to find the right card with the right chipset, versions change
\end{list1}


\slide{Wifi Pineapple}

\hlkimage{6cm}{wi-fi-pineapple.jpg}
Source: \url{https://shop.hak5.org/products/wifi-pineapple}

\begin{list2}
\item Various wi-fi platforms exist. They can be nice, and typically have a web interface or GUI
\item I have tried multiple versions of the wifi pineapple
\item I haven't bought any and prefer the details of the low-level tools myself
\end{list2}


\slide{Kali Nethunter}

\hlkimage{13cm}{kali-nethunter.png}

Source: \link{https://www.kali.org/kali-linux-nethunter/}




\slide{OSI and Internet Protocols}

\hlkimage{10cm,angle=90}{images/compare-osi-ip.pdf}


\slide{Recommended technologies to learn}

So to accomplish the goal of performing wireless attacks efficiently you need some basics

Networking: Basic Protocols from the Internet Protocols suite IP/TCP, or TCP/IP
\begin{list2}
\item Basic Protocols from TCP/IP, Wi-Fi: IPv4 and IPv6 -- addresses and ports/services
\item Transport Layer: Transmission Control Protocol (TCP) and User Datagram Protocol (UDP)
\item Common upper layer: Domain Name System (DNS)
\item Encrypted/secure versions like (HTTPS) which uses Transport Layer Security (TLS)
\item Basic encryption as used and broken WEP, WPA(1) PSK
\item Basic encryption and still used WPA2 PSK and Enterprise
\item Later add WPS, WPA3 and SAE
\item Practice using your home network -- you control it, and have the passwords
\end{list2}

This will \emph{probably} keep you busy for a while \smiley

\slide{Wireless technologies IEEE 802.11}

\begin{quote}
\begin{list2}
\item Since its introduction in 1997, the ongoing evolution of IEEE 802.11 Wi-Fi standards has led to much faster data transmission rates, longer ranges, and more reliable and secure connections.
\item IEEE 802.11ax™, or Wi-Fi 6, is the most recent standard in the IEEE 802.11 series published in 2021. It supports the increasing use of Wi-Fi in data-heavy and new applications such as video and cloud access.
\item IEEE P802.11be™, or Wi-Fi 7, is under development with an estimated completion in 2024. This standard represents a major evolutionary milestone with 4x faster data rates and twice the bandwidth.
\item The IEEE 802.11 Working Group has formed special-interest groups to support many next-generation Wi-Fi applications, such as AI, AR/VR, and battery-free IoT.
\end{list2}
\end{quote}
Source: \url{https://standards.ieee.org/beyond-standards/the-evolution-of-wi-fi-technology-and-standards/}
Older ones 802.11b 11Mbps, 802.11g 54Mbps, 802.11n endnu hurtigere


\slide{Typical use of wireless radios}

\hlkimage{12cm}{images/wlan-accesspoint-1.pdf}

An access point is basically a radio with Ethernet interfaces, a bridge, but can also be a whole router

\slide{Wireless networking security in IEEE 802.11}

\begin{list1}
\item Based on a few prerequisites
  \begin{list2}
  \item SSID -- network name, network id
  \item Cryptography - Wi-Fi Protected Access
  \item Maybe MAC filtering -- no need to bother with this
  \end{list2}
\item Watch out
  \begin{list2}
  \item WPA Pre-shared key (PSK) is based on a single shared key, does not scale well, hard to change
\item WPA Enterprise is better and based on individual authentication -- each user has a username and password (or certificate)
  \end{list2}

\end{list1}


%wardriving her
\slide{Demo: wardriving med airodump-ng}

\hlkimage{17cm}{images/macstumbler.png}

Screenshot from MacStumbler -- I use airodump-ng from Aircrack-ng.org with Kali

\demo{ex:wardriving}


\slide{IEEE 802.11 Security fast forward }

\begin{quote}
{\bf In 2001}, a group from the University of California, Berkeley presented a paper describing weaknesses in the 802.11 Wired Equivalent Privacy (WEP) security mechanism defined in the original standard; they were followed by {\bf Fluhrer, Mantin, and Shamir's} paper titled "Weaknesses in the Key Scheduling Algorithm of RC4". Not long after, Adam Stubblefield and AT\&T publicly announced the first {\bf verification of the attack}. In the attack, they were able to intercept transmissions and gain unauthorized access to wireless networks.
\end{quote}
Source: \link{http://en.wikipedia.org/wiki/IEEE_802.11}

\slide{IEEE 802.11 Security fast forward }

\begin{quote}
The IEEE set up a dedicated task group to create a replacement security solution, {\bf 802.11i} (previously this work was handled as part of a broader 802.11e effort to enhance the MAC layer). The Wi-Fi Alliance announced an {\bf interim specification called Wi-Fi Protected Access (WPA)} based on a subset of the then current IEEE 802.11i draft. These started to appear in products in {\bf mid-2003}. {\bf IEEE 802.11i (also known as WPA2)} itself was ratified in {\bf June 2004}, and uses government strength encryption in the {\bf Advanced Encryption Standard AES,} instead of RC4, which was used in WEP. The modern recommended encryption for the home/consumer space is {\bf WPA2 (AES Pre-Shared Key) and for the Enterprise space is WPA2 along with a RADIUS authentication server} (or another type of authentication server) and a strong authentication method such as EAP-TLS.
\end{quote}
Source: \link{http://en.wikipedia.org/wiki/IEEE_802.11}

\slide{IEEE 802.11 Security fast forward }

\begin{quote}
In January 2005, the IEEE set up yet another task group "w" to protect management and broadcast frames, which previously were sent unsecured. Its standard was published in 2009.[24]

In {\bf December 2011}, a security flaw was revealed that affects wireless routers with the {\bf optional Wi-Fi Protected Setup (WPS)} feature. While WPS is not a part of 802.11, {\bf the flaw allows a remote attacker to recover the WPS PIN and, with it, the router's 802.11i password in a few hours}.
\end{quote}

\vskip 2cm
\centerline{WPS is bad!}
\vskip 2cm

Source: \link{http://en.wikipedia.org/wiki/IEEE_802.11}


\slide{IEEE 802.11i}

%\hlkimage{}{}

\begin{quote}
IEEE 802.11i-2004, or 802.11i for short, is an amendment to the original IEEE 802.11, implemented as Wi-Fi Protected Access II (WPA2). The draft standard was ratified on 24 June 2004. This standard specifies security mechanisms for wireless networks, replacing the short Authentication and privacy clause of the original standard with a detailed Security clause. In the process, the amendment {\bf deprecated broken Wired Equivalent Privacy (WEP)}, while it was later incorporated into the published IEEE 802.11-2007 standard.

{\bf Replacement of WEP}\\
802.11i supersedes the previous security specification, Wired Equivalent Privacy (WEP), which was shown to have security vulnerabilities. Wi-Fi Protected Access (WPA) had previously been introduced by the Wi-Fi Alliance as an intermediate solution to WEP insecurities. WPA implemented a subset of a draft of 802.11i. The Wi-Fi Alliance refers to their approved, interoperable implementation of the {\bf full 802.11i as WPA2}, also called {\bf RSN (Robust Security Network)}. 802.11i makes use of the {\bf Advanced Encryption Standard (AES) block cipher}, whereas WEP and WPA use the RC4 stream cipher.[1]
\end{quote}
Source: \url{https://en.wikipedia.org/wiki/IEEE_802.11i-2004}



\slide{WEP kryptering}

%\begin{center}
%\colorbox{white}{\includegraphics[width=12cm]{images/airsnort.pdf}}
%\end{center}
\begin{list1}
\item WEP \emph{kryptering} - med nøgler der specificeres som tekst
  eller hexadecimale cifre
\item typisk 40-bit, svarende til 5 ASCII tegn eller 10 hexadecimale
  cifre eller 104-bit 13 ASCII tegn eller 26 hexadecimale cifre
\item WEP er baseret på RC4 algoritmen der er en \emph{stream cipher}
  lavet af Ron Rivest for RSA Data Security
\end{list1}


\slide{De første fejl ved WEP}
\begin{list1}
\item Oprindeligt en dårlig implementation i mange Access Points
\item Fejl i krypteringen - rettet i nyere firmware
\item WEP er baseret på en DELT hemmelighed som alle stationer kender
\item Nøglen ændres sjældent, og det er svært at distribuere en ny
\end{list1}

\input{basic-crypto.tex}

\slide{WEP sikkerhed}

\hlkimage{12cm}{images/airsnort.pdf}

\begin{quote}
AirSnort is a wireless LAN (WLAN) tool which recovers encryption
keys. AirSnort operates by passively monitoring transmissions,
computing the encryption key when enough packets have been gathered.

802.11b, using the Wired Equivalent Protocol (WEP), is crippled with
numerous security flaws. Most damning of these is the weakness
described in " Weaknesses in the Key Scheduling Algorithm of RC4 "
by Scott Fluhrer, Itsik Mantin and Adi Shamir. Adam Stubblefield
was the first to implement this attack, but he has not made his
software public. AirSnort, along with WEPCrack, which was released
about the same time as AirSnort, are the first publicly available
implementaions of this attack.  \link{http://airsnort.shmoo.com/}
\end{quote}

%\begin{list1}
%\item i dag er firmware opdateret hos de fleste producenter
%\item men sikkerheden baseres stadig på een delt hemmelighed
%\end{list1}

\slide{major cryptographic errors}

\begin{list1}
\item weak keying - 24 bit er allerede kendt - 128-bit = 104 bit i praksis
\item small IV - med kun 24 bit vil hver IV blive genbrugt oftere
\item CRC-32 som integritetscheck er ikke \emph{stærkt} nok
  kryptografisk set
\item Authentication gives pad - giver fuld adgang - hvis der bare
  opdages \emph{encryption pad} for en bestemt IV. Denne IV kan så
  bruges til al fremtidig kommunikation
\end{list1}
Source:
\emph{Secure Coding: Principles and Practices}, Mark G. Graff
  og Kenneth R. van Wyk, O'Reilly, 2003

\slide{Konklusion: Kryptografi er svært}

%Stoler vi på de andre autentificeringsmetoder?}
\hlkimage{20cm}{crypto-class.png}

Åbent kursus på Stanford\\
\link{http://crypto-class.org/}



\slide{WEP cracking - airodump og aircrack}

\hlkimage{3cm}{images/no-wep.pdf}

\begin{list1}
\item airodump - opsamling af krypterede pakker
\item aircrack - statistisk analyse og forsøg på at finde WEP nøglen
\item Med disse værktøjer er det muligt at knække \emph{128-bit nøgler}!
\item Blandt andet fordi det reelt er 104-bit nøgler \smiley
\item Links:\\
Tutorial: Simple WEP Crack\\
\link{http://www.aircrack-ng.org/doku.php?id=simple_wep_crack}
\end{list1}

\slide{airodump opsamling}


\begin{alltt}
\hlktiny
   BSSID              CH  MB  ENC  PWR  Packets   LAN IP / # IVs   ESSID

   00:03:93:ED:DD:8D   6  11       209   {\bf 801963                  540180}   wanlan
\end{alltt}

\begin{list1}
\item Når airodump kører opsamles pakkerne
\item Lås airodump fast til een kanal, -c eller --channel
\end{list1}

Startes med airmon og kan skrive til capture filer:

\begin{alltt}
airmon-ng start wlan0
airodump-ng --channel 6 --write testfil wlan0mon
\end{alltt}

\slide{aircrack - WEP cracker}

\begin{alltt}
\footnotesize
   $ aircrack -n 128 -f 2 aftendump-128.cap
                                 aircrack 2.1
   * Got  540196! unique IVs | fudge factor = 2
   * Elapsed time [00:00:22] | tried 12 keys at 32 k/m
   KB    depth   votes
    0    0/  1   CE(  45) A1(  20) 7E(  15) 98(  15) 72(  12) 82(  12)
    1    0/  2   62(  43) 1D(  24) 29(  15) 67(  13) 94(  13) F7(  13)
    2    0/  1   B6( 499) E7(  18) 8F(  15) 14(  13) 1D(  12) E5(  10)
    3    0/  1   4E( 157) EE(  40) 29(  39) 15(  30) 7D(  28) 61(  20)
    4    0/  1   93( 136) B1(  28) 0C(  15) 28(  15) 76(  15) D6(  15)
    5    0/  2   E1(  75) CC(  45) 39(  31) 3B(  30) 4F(  16) 49(  13)
    6    0/  2   3B(  65) 51(  42) 2D(  24) 14(  21) 5E(  15) FC(  15)
    7    0/  2   6A( 144) 0C(  96) CF(  34) 14(  33) 16(  33) 18(  27)
    8    0/  1   3A( 152) 73(  41) 97(  35) 57(  28) 5A(  27) 9D(  27)
    9    0/  1   F1(  93) 2D(  45) 51(  29) 57(  27) 59(  27) 16(  26)
   10    2/  3   5B(  40) 53(  30) 59(  24) 2D(  15) 67(  15) 71(  12)
   11    0/  2   F5(  53) C6(  51) F0(  21) FB(  21) 17(  15) 77(  15)
   12    0/  2   E6(  88) F7(  81) D3(  36) E2(  32) E1(  29) D8(  27)
         {\color{red}\bf KEY FOUND! [ CE62B64E93E13B6A3AF15BF5E6 ]}
\end{alltt}
%$


\slide{Hvor lang tid tager det?}

\begin{list1}
\item Opsamling a data - ca. en halv time på 802.11b ved optimale forhold
\item Tiden for kørsel af aircrack fra auditor CD
på en Dell CPi 366MHz Pentium II laptop:
\end{list1}
\begin{alltt}
   $ time aircrack -n 128 -f 2 aftendump-128.cap
   ...
   real    5m44.180s   user  0m5.902s     sys  1m42.745s
   \end{alltt}
   %$
\pause
\begin{list1}
\item Tiden for kørsel af aircrack på en VIA CL-10000 1GHz CPU med
  almindelig disk OpenBSD:
\end{list1}
\begin{alltt}
   25.12s real     0.63s user     2.14s system
\end{alltt}


\centerline{\bf Many years ago, this is instant today -- realtime cracking}

\slide{Erstatning for WEP - WPA}

\begin{list1}
\item Det anbefales at bruge:
%\begin{list2}
\item Kendte VPN teknologier eller WPA
\item baseret på troværdige algoritmer
\item implementeret i professionelt udstyr
\item fra troværdige leverandører
\item udstyr der vedligeholdes og opdateres
%\end{list2}
\item Man kan måske endda bruge de eksisterende løsninger - fra
  hjemmepc adgang, mobil adgang m.v.
\end{list1}


\slide{RADIUS}
\begin{list1}
\item RADIUS er en protokol til autentificering af brugere op mod en
  fælles server
\item Remote Authentication Dial In User Service (RADIUS)
\item RADIUS er beskrevet i RFC-2865
\item RADIUS kan være en fordel i større netværk med
\begin{list2}
\item dial-in
\item administration af netværksudstyr
\item trådløse netværk
\item andre RADIUS kompatible applikationer
\end{list2}
\end{list1}

\slide{Erstatninger for WEP}
\begin{list1}
\item Der findes idag andre metoder til sikring af trådløse netværk
\item 802.1x Port Based Network Access Control
\item WPA - Wi-Fi Protected Access)\\
WPA = 802.1X + EAP + TKIP + MIC
\item nu WPA2\\
WPA2 = 802.1X + EAP + CCMP

\begin{quote}
WPA2 is based on the final IEEE 802.11i amendment to the 802.11
standard and is eligible for FIPS 140-2 compliance.
\end{quote}
\item Source:
\href{http://www.wifialliance.org/OpenSection/protected_access.asp}
{http://www.wifialliance.org/OpenSection/protected\_access.asp}
\end{list1}


\slide{WPA eller WPA2?}

\begin{quote}
WPA2 is based upon the Institute for Electrical and Electronics
Engineers (IEEE) 802.11i amendment to the 802.11 standard, which was
ratified on July 29, 2004.
\end{quote}

\begin{quote}
Q: How are WPA and WPA2 similar?\\
A: Both WPA and WPA2 offer a high level of assurance for end-users and network
administrators that their data will remain private and access to their
network restricted to authorized users.
Both utilize 802.1X and Extensible Authentication Protocol (EAP) for
authentication. Both have Personal and Enterprise modes of operation
that meet the distinct needs of the two different consumer and
enterprise market segments.

Q: How are WPA and WPA2 different?\\
A: WPA2 provides a {\bf stronger encryption mechanism} through {\bf
  Advanced Encryption Standard (AES)}, which is a requirement for some
corporate and government users.
\end{quote}

\centerline{Source: http://www.wifialliance.org WPA2 Q and A}

\slide{WPA Personal eller Enterprise}

\begin{list1}
\item Personal - en delt hemmelighed, preshared key
\item Enterprise - brugere valideres op mod fælles server
\item Hvorfor er det bedre?
\begin{list2}
\item Flere valgmuligheder - passer til store og små
\item WPA skifter den faktiske krypteringsnøgle jævnligt - TKIP
\item Initialisationsvektoren (IV) fordobles 24 til 48 bit
\item Imødekommer alle kendte problemer med WEP!
\item Integrerer godt med andre teknologier - RADIUS

\vskip 1 cm
\item EAP - Extensible Authentication Protocol - individuel autentifikation
\item TKIP - WPA Temporal Key Integrity Protocol - nøgleskift og integritet
\item MIC - Message Integrity Code - Michael, ny algoritme til integritet
\item CCMP - WPA2 AES / Counter Mode CBC-MAC Protocol
\end{list2}

\end{list1}


\slide{WPA cracking}

\begin{list1}
\item Nu skifter vi så til WPA og alt er vel så godt?
\pause
\item Desværre ikke!
\item Du skal vælge en laaaaang passphrase
\item Hvis koden til wifi er for kort kan man sniffe WPA
  handshake når en computer går ind på netværket, og knække den!
\item Med et handshake kan man med aircrack igen lave off-line
  bruteforce angreb!
\end{list1}

\slide{WPA cracking demo}

\begin{list1}
\item Vi konfigurerer AP med Henrik42 som WPA-PSK/passhrase
\item Vi finder netværk med airodump
\item Vi starter airodump mod specifik kanal
\item Vi spoofer deauth og opsamler WPA handshake
\item Vi knækker WPA :-)
\item Use the tutorials \link{http://www.aircrack-ng.org/doku.php?id=tutorial}
\item Specielt \link{http://www.aircrack-ng.org/doku.php?id=cracking_wpa}

\end{list1}

\centerline{Brug manualsiderne for programmerne i aircrack-ng pakken!}

\slide{WPA cracking med aircrack - start}

\begin{alltt}
\small
# aircrack-ng -w dict wlan-test.cap
Opening wlan-test.cap
Read 1082 packets.

#  BSSID              ESSID           Encryption

1  00:11:24:0C:DF:97  wlan            WPA (1 handshake)
2  00:13:5F:26:68:D0  Noea            No data - WEP or WPA
3  00:13:5F:26:64:80  Noea            No data - WEP or WPA
4  00:00:00:00:00:00                  Unknown

Index number of target network ? {\bf 1}
\end{alltt}

Aircrack-ng er en god måde at checke om der er et handshake i filen

\slide{WPA cracking med aircrack - start}

\begin{alltt}
\small
          [00:00:00] 0 keys tested (0.00 k/s)

                    KEY FOUND! [ Henrik42 ]

Master Key     : 8E 61 AB A2 C5 25 4D 3F 4B 33 E6 AD 2D 55 6F 76
                 6E 88 AC DA EF A3 DE 30 AF D8 99 DB F5 8F 4D BD
Transcient Key : C5 BB 27 DE EA 34 8F E4 81 E7 AA 52 C7 B4 F4 56
                 F2 FC 30 B4 66 99 26 35 08 52 98 26 AE 49 5E D7
                 9F 28 98 AF 02 CA 29 8A 53 11 EB 24 0C B0 1A 0D
                 64 75 72 BF 8D AA 17 8B 9D 94 A9 31 DC FB 0C ED

EAPOL HMAC     : 27 4E 6D 90 55 8F 0C EB E1 AE C8 93 E6 AC A5 1F

\end{alltt}

\vskip 1 cm

\centerline{Min gamle Thinkpad X31 med 1.6GHz Pentium M knækker ca. 150 Keys/sekund}

Today a modern GPU (Graphical card) can speed this up to 50.000s per second or more with hashcat



\slide{WPA/WPA2 cracking Pyrit 2008}

\begin{quote}
\emph{Pyrit} takes a step ahead in attacking WPA-PSK and WPA2-PSK, the protocol that today de-facto protects public WIFI-airspace. The project's goal is to estimate the real-world security provided by these protocols. Pyrit does not provide binary files or wordlists and does not encourage anyone to participate or engage in any harmful activity. {\bf This is a research project, not a cracking tool.}

\emph{Pyrit's} implementation allows to create massive databases, pre-computing part of the WPA/WPA2-PSK authentication phase in a space-time-tradeoff. The performance gain for real-world-attacks is in the range of three orders of magnitude which urges for re-consideration of the protocol's security. Exploiting the computational power of GPUs, \emph{Pyrit} is currently by far the most powerful attack against one of the world's most used security-protocols.
\end{quote}

\begin{list1}
%\item sloooow, plejede det at være -  ca 150 keys/s på min Thinkpad X31
\item Kryptering afhænger af SSID - så skift altid SSID!
\item \link{http://pyrit.wordpress.com/about/}
%\item Also found on Github as \url{https://github.com/JPaulMora/Pyrit}
\end{list1}

\slide{Tired of WoW?}

\hlkimage{17cm}{pyritperfaa3.png}

Source: \link{http://code.google.com/p/pyrit/} Note old data!

\slide{Hashcat Cracking passwords and secrets}

\begin{list2}
\item Hashcat is the world's fastest CPU-based password recovery tool.
\item oclHashcat-plus is a GPGPU-based multi-hash cracker using a brute-force attack (implemented as mask attack), combinator attack, dictionary attack, hybrid attack, mask attack, and rule-based attack.
\item oclHashcat-lite is a GPGPU cracker that is optimized for cracking performance. Therefore, it is limited to only doing single-hash cracking using Markov attack, Brute-Force attack and Mask attack.
\item John the Ripper password cracker old skool men stadig nyttig
\end{list2}

Source:\\
\link{http://hashcat.net/wiki/}\\
\link{http://www.openwall.com/john/}\\
\link{http://hashcat.net/wiki/doku.php?id=cracking_wpawpa2}


\slide{New attack on WPA/WPA2 using PMKID}


\begin{quote}\small
This attack was discovered accidentally while looking for new ways to attack the new WPA3 security standard. WPA3 will be much harder to attack because of its modern key establishment protocol called "Simultaneous Authentication of Equals" (SAE).

The main difference from existing attacks is that in this attack, capture of a full EAPOL 4-way handshake is not required. The new attack is performed on the RSN IE (Robust Security Network Information Element) of a single EAPOL frame.

At this time, we do not know for which vendors or for how many routers this technique will work, but we think it will work against all 802.11i/p/q/r networks with roaming functions enabled (most modern routers).

The main advantages of this attack are as follow:
No more regular users required - because the attacker directly communicates with the AP (aka "client-less" attack)
No more waiting for a complete 4-way handshake between the regular user and the AP
No more eventual retransmissions of EAPOL frames (which can lead to uncrackable results)
No more eventual invalid passwords sent by the regular user
No more lost EAPOL frames when the regular user or the AP is too far away from the attacker
No more fixing of nonce and replaycounter values required (resulting in slightly higher speeds)
No more special output format (pcap, hccapx, etc.) - final data will appear as regular hex encoded string
\end{quote}

\begin{list2}
\item \link{https://hashcat.net/forum/thread-7717.html} New attack on WPA/WPA2 using PMKID
\item \link{https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/}
\end{list2}



\slide{ Wi-Fi Protected Setup, WPS hacking - Reaver}

\begin{quote}
Reaver Open Source
Reaver implements a brute force attack against Wifi Protected Setup (WPS) registrar PINs in order to recover WPA/WPA2 passphrases, as described in \link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}.

Reaver has been designed to be a robust and practical attack against WPS, and has been tested against a wide variety of access points and WPS implementations.

On average Reaver will recover the target AP's plain text WPA/WPA2 passphrase in 4-10 hours, depending on the AP. In practice, it will generally take half this time to guess the correct WPS pin and recover the passphrase.
\end{quote}

\centerline{Hvad betyder ease of use?}

Source: \\
\link{https://code.google.com/p/reaver-wps/}\\
{\footnotesize \link{http://lifehacker.com/5873407/how-to-crack-a-wi+fi-networks-wpa-password-with-reaver}}

\slide{WPS Design Flaws used by Reaver }

\hlkimage{22cm}{wps-design-flaw-1.png}

\centerline{Pin only, no other means necessary}

Source:\\
\link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}

\slide{WPS Design Flaws used by Reaver }

\hlkimage{10cm}{wps-design-flaw-2.png}

\centerline{Reminds me of NTLM cracking, crack parts independently}

Source:\\
\link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}

\slide{WPS Design Flaws used by Reaver }

\hlkimage{18cm}{wps-design-flaw-2-2.png}

\centerline{100.000.000 is a lot, 11.000 is not}

Source:\\
\link{http://sviehb.files.wordpress.com/2011/12/viehboeck_wps.pdf}


\slide{Reaver Rate limiting}

\hlkimage{13cm}{reaver-rate-limiting.png}

\centerline{Make no mistake, it will work!}



\slide{WPA3 Security}

%\hlkimage{}{}

\begin{quote}\small
{\bf WPA3}\\
In January 2018, the Wi-Fi Alliance announced WPA3 as a replacement to WPA2.[12][13] Certification began in June 2018,[14] and WPA3 support has been mandatory for devices which bear the "Wi-Fi CERTIFIED™" logo since July 2020.[11]

The new standard uses an equivalent 192-bit cryptographic strength in WPA3-Enterprise mode[15] (AES-256 in GCM mode with SHA-384 as HMAC), and still mandates the use of CCMP-128 (AES-128 in CCM mode) as the minimum encryption algorithm in WPA3-Personal mode.

The WPA3 standard also replaces the pre-shared key (PSK) exchange with Simultaneous Authentication of Equals (SAE) exchange, a method originally introduced with IEEE 802.11s, resulting in a more secure initial key exchange in personal mode[16][17] and forward secrecy.[18] The Wi-Fi Alliance also says that WPA3 will mitigate security issues posed by weak passwords and simplify the process of setting up devices with no display interface.[2][19]

Protection of management frames as specified in the IEEE 802.11w amendment is also enforced by the WPA3 specifications.
\end{quote}
Source: \link{https://en.wikipedia.org/wiki/Wi-Fi_Protected_Access}

\begin{list2}
\item Does not seem to be used much, in Denmark, yet -- but coming
\end{list2}

\slide{IS WPA3 supported?}

%\hlkimage{}{}

\begin{quote}
A wireless network adapter that supports Wi-Fi 6. To see if your PC supports it, check the documentation that came with it or check the PC manufacturer’s website.
Tip: You can also check to see if your router supports Wi-Fi 6 by opening the Command Prompt, and then typing the command netsh wlan show drivers. Look next to Radio types supported and see if it includes 802.11ax.
\end{quote}
Source: \link{https://support.microsoft.com/en-us/windows/faster-and-more-secure-wi-fi-in-windows-26177a28-38ed-1a8e-7eca-66f24dc63f09}

\begin{list2}
\item Your devices must support both WPA3 in both operating system and Wi-Fi drivers!
\item Windows 10 and 11 does, so try upgrading drivers
\item Android does since Android 10 -- pretty new still
\item Apple devices have support in recent versions
\end{list2}


\slide{WPA3 on Apple Devices}

%\hlkimage{}{}

\begin{quote}
\begin{list2}
\item iPhone 7 or later.
\item iPad 5th generation or later.
\item Apple TV 4K or later.
\item Apple Watch series 3 or later.
\item Mac computers (late 2013 or later, with 802.11ac or later)
\end{list2}
\end{quote}
Source: \link{https://support.apple.com/da-dk/guide/security/sec8a67fa93d/web}


\slide{Wi-Fi CERTIFIED WPA3™}

%\hlkimage{}{}

\begin{quote}

WPA3™ provides cutting-edge security protocols to the market. Building on the widespread success and adoption of Wi-Fi security, WPA3 adds new features to simplify Wi-Fi security, enable more robust authentication, deliver increased cryptographic strength for highly sensitive data markets, and maintain resiliency of mission critical networks. All WPA3 networks:

\begin{list2}
\item Use the latest security methods
\item Disallow outdated legacy protocols
\item Require use of Protected Management Frames (PMF)
\end{list2}
Since Wi-Fi networks differ in usage purpose and security needs, WPA3 includes additional capabilities specifically for personal and enterprise networks. Users of WPA3-Personal receive increased protections from password guessing attempts, while WPA3-Enterprise users can now take advantage of higher-grade security protocols for sensitive data networks.

WPA3 is a mandatory certification for Wi-Fi CERTIFIED™ devices.
\end{quote}
Source: \url{https://www.wi-fi.org/discover-wi-fi/security}

\slide{WPA3 Personal Simultaneous Authentication of Equals (SAE)}

%\hlkimage{}{}

\begin{quote}
WPA3-Personal is based on Simultaneous Authentication of Equals (SAE), defined in Institute of Electrical and Electronics Engineers (IEEE) Std 802.11-2016 and updated in 802.11-2020. The Wi‑Fi Alliance WPA3 Specification defines additional requirements for devices operating in SAE modes. {\bf SAE is a key exchange protocol that authenticates two peers using only a password}, resulting in a shared secret between the two peers that can be used for secret communication while exchanging data over a public network. It provides a secure alternative to using certificates when a centralized authority is not available.

In a Wi-Fi infrastructure network, the SAE handshake negotiates a fresh Pairwise Master Key (PMK) per client, which is then used in a traditional Wi‑Fi four-way handshake to generate session keys. Neither the PMK nor the password credential used in the SAE exchange can be obtained by a passive attack, active attack, or offline dictionary attack. Password recovery is only possible through repeated active attacks guessing a different password each time.
Additionally, forward secrecy is provided because the SAE handshake assures the PMK cannot be recovered if the password becomes known.
\end{quote}
Source: Wi-Fi CERTIFIED WPA3™
Technology Overview
January 2021\\
\url{https://www.wi-fi.org/system/files/Wi-Fi_CERTIFIED_WPA3_Technology_Overview_202101.pdf}


\slide{WPA3-Personal}

\begin{quote}
WPA3-Personal brings better protections to individual users by providing more robust password-based authentication, even when users choose passwords that fall short of typical complexity recommendations. This capability is enabled through Simultaneous Authentication of Equals (SAE). The technology is {\bf resistant to offline dictionary attacks} where an adversary attempts to determine a network password by trying possible passwords without further network interaction.

\begin{list2}
\item {\bf Natural password selection}: Allows users to choose passwords that are easier to remember
\item {\bf Ease of use}: Delivers enhanced protections with no change to the way users connect to a network
\item {\bf Forward secrecy}: Protects data traffic even if a password is compromised after the data was transmitted
\end{list2}
\end{quote}

Source: \url{https://www.wi-fi.org/discover-wi-fi/security}

Note: Compare this with Diffie-Hellman \url{https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman_key_exchange} and Transport Layer Security (TLS) \url{https://en.wikipedia.org/wiki/Transport_Layer_Security}


\slide{WPA3-Enterprise}

%\hlkimage{}{}

\begin{quote}
WPA3-Enterprise builds upon the foundation of WPA2-Enterprise with the additional requirement of using Protected Management Frames on all WPA3 connections.

\begin{list2}
\item {\bf Authentication}: multiple Extensible Authentication Protocol (EAP) methods
\item {\bf Authenticated encryption}: minimum 128-bit Advanced Encryption Standard Counter Mode with Cipher Block Chaining Message Authentication (AES-CCMP 128)
\item {\bf Key derivation and confirmation}: minimum 256-bit Hashed Message Authentication Mode (HMAC) with Secure Hash Algorithm (HMAC-SHA256)
\item {\bf Robust management frame protection}: minimum 128-bit Broadcast/Multicast Integrity Protocol Cipher-based Message Authentication Code (BIP-CMAC-128)
\end{list2}
\end{quote}

Source: \url{https://www.wi-fi.org/discover-wi-fi/security}


\slide{WPA3-Enterprise with 192-bit mode}

\begin{quote}

WPA3-Enterprise also offers an optional mode using 192-bit minimum-strength security protocols and cryptographic tools to better protect sensitive data.

\begin{list2}
\item {\bf Authentication}: Extensible Authentication Protocol – Transport Layer Security (EAP-TLS) using Elliptic Curve Diffie-Hellman (ECDH) exchange and Elliptic Curve Digital Signature Algorithm (ECDSA) using a 384-bit elliptic curve
\item {\bf Authenticated encryption}: 256-bit Galois/Counter Mode Protocol (GCMP-256)
\item {\bf Key derivation and confirmation}: 384-bit Hashed Message Authentication Mode (HMAC) with Secure Hash Algorithm (HMAC-SHA384)
\item {\bf Robust management frame protection}: 256-bit Broadcast/Multicast Integrity Protocol Galois Message Authentication Code (BIP-GMAC-256)
\end{list2}
The 192-bit security mode offered by WPA3-Enterprise ensures the right combination of cryptographic tools are used and sets a consistent baseline of security within a WPA3 network.
\end{quote}

Source: \url{https://www.wi-fi.org/discover-wi-fi/security}

\slide{WPA3 MiTM and evil twin attacks}

\begin{quote}
WPA3™ includes features that provide Wi-Fi® devices with additional safeguards against a variety of attacks, including man in the middle (MITM) and evil twin attacks.

 In this post, we will explore the details of two additional new features: SAE Public Key (SAE-PK) and Transition Disable. SAE-PK provides protection against evil twin attacks on client devices in public networks that use WPA3-Personal, while Transition Disable provides protection against active downgrade attacks on client devices operating in a transition mode with WPA3-Personal, WPA3-Enterprise or Wi-Fi Enhanced Open™.
\end{quote}
Source: {\footnotesize
\url{https://www.wi-fi.org/beacon/thomas-derham-nehru-bhandaru/wi-fi-certified-wpa3-december-2020-update-brings-new-0}}



\slide{2020: Dragonblood}

%\hlkimage{}{}

\begin{quote}\small
April 2019 — Modern Wi-Fi networks use WPA2 to protect transmitted data. However, because {\bf WPA2 is more than 14 years old}, the Wi-Fi Alliance recently announced the new and more secure WPA3 protocol. One of the supposed advantages of WPA3 is that, thanks to its underlying {\bf Dragonfly handshake}, it's {\bf near impossible to crack the password} of a network. Unfortunately, we found that even with WPA3, an {\bf attacker within range of a victim can still recover the password}. If the victim uses no extra protection such as HTTPS, this allows an attacker to steal sensitive information such as passwords and emails. We hope our disclosure motivates vendors to mitigate our attacks before WPA3 becomes widespread.

...

Fortunately, as a result of our research, both the Wi-Fi standard and EAP-pwd are being updated with a more secure protocol. Although this update is not backwards-compatible with current deployments of WPA3, it does prevent most of our attacks.
\end{quote}
Source: \link{https://wpa3.mathyvanhoef.com/}


\begin{list2}
\item Side-channel leaks
\item Full paper Mathy Vanhoef and Eyal Ronen. 2020. \emph{Dragonblood: Analyzing the Dragonfly Handshake of WPA3 and EAP-pwd}. In IEEE Symposium on Security \& Privacy (SP). IEEE.
 \link{https://eprint.iacr.org/2019/383}

\end{list2}

\slide{2021: Fragment and Forge }

%\hlkimage{}{}

\begin{quote}\small
{\bf Fragment and Forge: Breaking Wi-Fi Through
Frame Aggregation and Fragmentation}

Abstract
In this paper, we present three design flaws in the {\bf 802.11
standard that underpins Wi-Fi}. One design flaw is in the frame
aggregation functionality, and another two are in the frame
fragmentation functionality. These design flaws enable an
adversary to {\bf forge encrypted frames} in various ways, which in
turn enables {\bf exfiltration of sensitive data}. We also discovered
common implementation flaws related to aggregation and
fragmentation, which further worsen the impact of our attacks.
Our results {\bf affect all protected Wi-Fi networks, ranging from
WEP all the way to WPA3}, meaning the discovered flaws
have been part of Wi-Fi {\bf since its release in 1997}. In our
experiments, all devices were vulnerable to one or more of our
attacks, confirming that {\bf all Wi-Fi devices are likely affected}.
Finally, we present a tool to test whether devices are affected
by any of the vulnerabilities, and we discuss countermeasures
to prevent our attacks.

\end{quote}
Source: Mathy Vanhoef \url{https://eprint.iacr.org/2021/763.pdf} (bold by me)

\slide{Normal WLAN brug}

\hlkimage{14cm}{images/wlan-airpwn-1.pdf}

\slide{Packet injection - airpwn 2004}

\hlkimage{14cm}{images/wlan-airpwn-2.pdf}

Classic Malicious actor in the middle -- intercept and change data


\slide{Airpwn teknikker}

\begin{list1}
\item Klienten sender forespørgsel
\item Hackerens program airpwn lytter og sender så falske pakker
\item Hvordan kan det lade sig gøre?
\begin{list2}
\item Normal forespørgsel og svar på Internet tager måske 20-50ms
\item Airpwn kan svare på omkring 1ms angives det
\item Airpwn har alle informationer til rådighed
\end{list2}
\item Airpwn source findes på Sourceforge\\
\link{http://airpwn.sourceforge.net/}
\item NB: Airpwn som demonstreret er begrænset til TCP og ukrypterede
  forbindelser
\item Mange Wireless netværk idag er ukrypterede og samme teknikker kan bruges idag
\end{list1}

\centerline{Ja, de {\bf samme metoder} oprindeligt fra {\bf 2004} kan bruges idag!}

\slide{Øvelse: airdecap}

\hlkimage{6cm}{exercise}

\begin{list1}
\item Vi afprøver nu airdecap på de opsamlede filer fra før
\item Brug dele af tutorials fra\\
\link{http://www.aircrack-ng.org/doku.php?id=airdecap-ng&s[]=airdecap}
\item "... decrypts a WPA/WPA2 encrypted capture using the passphrase"
\end{list1}



\slide{Når adgangen er skabt}

\begin{list1}
\item Så går man igang med de almindelige værktøjer
\item SecTools.Org: Top 125 Network Security Tools \link{http://www.sectools.org}
\end{list1}
\vskip 2 cm

\centerline{\hlkbig Forsvaret er som altid - flere lag af sikkerhed! }

\slide{Infrastrukturændringer}

\hlkimage{13cm}{images/wlan-accesspoint-2.pdf}

\centerline{\hlkbig Sådan bør et access point logisk forbindes til netværket}


\slide{VLAN Virtual LAN}

\hlkimage{6cm}{vlan-portbased.pdf}

\begin{list2}
\item Nogle switche tillader at man opdeler portene
\item Denne opdeling kaldes VLAN og portbaseret er det mest simple
\item Port 1-4 er et LAN
\item De resterende er et andet LAN
\item Data skal omkring en firewall eller en router for at krydse fra VLAN1 til VLAN2
\end{list2}

\slide{IEEE 802.1q}

\hlkimage{13cm}{vlan-8021q.pdf}

\begin{list2}
\item Nogle switche tillader at man opdeler portene, men tillige benytter 802.1q
\item Med 802.1q tillades VLAN tagging på Ethernet niveau
\item Data skal omkring en firewall eller en router for at krydse fra VLAN1 til VLAN2
\item VLAN trunking giver mulighed for at dele VLANs ud på flere switches
\item Der findes værktøjer der måske kan lette dette arbejde YMMV: OpenNAC FreeNAC, PacketFence
\end{list2}



\slide{IEEE 802.1x  Port Based Network Access Control}

\hlkimage{9cm}{osx-8021x.png}

\begin{list2}
\item Nogle switche tillader at man benytter 802.1x
\item Denne protokol sikrer at man valideres før der gives adgang til porten
\item Når systemet skal have adgang til porten afleveres brugernavn og kodeord/certifikat
\item Denne protokol indgår også i WPA Enterprise
\end{list2}


\slide{802.1x og andre teknologier}

\begin{list1}
\item 802.1x i forhold til MAC filtrering giver væsentlige fordele
\item MAC filtrering kan spoofes, hvor 802.1x kræver det rigtige kodeord
\item Typisk benyttes RADIUS og 802.1x integrerer således mod både LDAP og Active Directory
\end{list1}




\slide{Undgå standard indstillinger}

\begin{list1}
\item når vi scanner efter services går det nemt med at finde dem
\item Giv jer selv mere tid til at omkonfigurere og opdatere ved at undgå standardindstillinger
\item Tiden der går fra en sårbarhed annonceres til den
  bliver udnyttet er meget kort idag!
\item Ved at undgå standard indstillinger kan der
  måske opnås en lidt længere frist - inden ormene kommer
\item NB: ingen garanti - og det hjælper sjældent mod en dedikeret angriber
\end{list1}


\slide{Next step, software sikkerhed}

\hlkimage{13cm}{software.pdf}

\centerline{Wireless AP implementerer protokoller med hardware+software}

\slide{Sårbare AP'er - 1}
\begin{list1}
\item Hvordan bygger man et billigt Access Point?
\begin{list2}
\item En embedded kerne
\item En embedded TCP/IP stak
\item Noget 802.11 hardware
\item Et par Ethernet stik
\item eventuelt et modem
\item Tape ...
\end{list2}
\item Hvad med efterfølgende opdatering af software?
\end{list1}

\slide{Sårbare AP'er - 2}
\begin{list1}
\item Eksempler på access point sårbarheder:
\item Konfigurationsfilen kan hentes uden autentificering - inkl. WEP
  nøgler
\item Konfigurationen sker via SNMP - som sender community string i
  klar tekst
\item  Wi-Fi Protected Setup,(WPS) kan ikke slås helt fra
\item ...
\item Konklusionen er klar - hardwaren er i mange tilfælde ikke sikker
  nok til at anvende på forretningskritiske LAN segmenter!
\end{list1}


\slide{Hvordan finder man buffer overflow, og andre fejl}

\begin{list1}
\item Black box testing
\item Closed source reverse engineering
\item White box testing
\item Open source betyder man kan læse og analysere koden
\item Source code review - automatisk eller manuelt
\item Fejl kan findes ved at prøve sig frem - fuzzing
\item Exploits virker typisk mod specifikke versioner af software
\end{list1}
\slide{Forudsætninger}

\begin{list1}
\item Bemærk: alle angreb har forudsætninger for at virke
\item Et angreb mod Telnet virker kun hvis du bruger Telnet
\item Et angreb mod Apache HTTPD virker ikke mod Microsoft IIS
\item Kan du bryde kæden af forudsætninger har du vundet!
\end{list1}


\slide{buffer overflows et C problem}

\begin{list1}
\item {\bfseries Et buffer overflow}
er det der sker når man skriver flere data end der er afsat plads til
i en buffer, et dataområde. Typisk vil programmet gå ned, men i visse
tilfælde kan en angriber overskrive returadresser for funktionskald og
overtage kontrollen.
\item {\bfseries Stack protection}
er et udtryk for de systemer der ved hjælp af operativsystemer,
programbiblioteker og lign. beskytter stakken med returadresser og
andre variable mod overskrivning gennem buffer overflows. StackGuard
og Propolice er nogle af de mest kendte.
\end{list1}


\slide{Buffer og stacks}

\hlkimage{16cm}{buffer-overflow-1.pdf}

\begin{alltt}
main(int argc, char **argv)
\{      char buf[200];
        strcpy(buf, argv[1]);
        printf("%s\textbackslash{}n",buf);
\}
\end{alltt}


\slide{Overflow - segmentation fault }

\hlkimage{16cm}{buffer-overflow-2.pdf}


\begin{list1}
\item Bad function overwrites return value!
\item Control return address
\item Run shellcode from buffer, or from other place
\end{list1}


\slide{Wireless buffer overflows beware of the {\bf BLOB}}

\hlkimage{6cm}{Blob.jpg}

\centerline{AP and driver software has errors, some exploitable}


% too old
%\slide{Black Hat Briefings 2006}

%\begin{list1}
%\item Black Hat Briefings 2006.
%\item Der er kommet diverse rettelser til Apple Mac OS X
%\item Apple wireless vulnerable after all\\
%\link{http://www.securityfocus.com/brief/311}
%\end{list1}

%\slide{Flere links}

%\begin{list1}
%\item Vi har måske ikke tid til mere, men fri snak og diskussion nu
%\item \link{http://kernelfun.blogspot.com/}
%\item \link{http://www.802.11mercenary.net/}
%\item \link{http://toorcon.org/2006/conference.html}
%\item Der sker meget indenfor wireless!
%\end{list1}


\slide{24 Deadly Sins of Software Security}

\hlkrightimage{5cm}{24-deadly.jpg}
\emph{24 Deadly Sins of Software Security} af Michael Howard, David Leblanc, John Viega 2009

\begin{list1}
\item {\bf Obligatorisk læsning for alle udviklere}
\item Denne bog er præcis og giver overblik på kun 432 sider
\item Buffer Overruns, Format String Problems, Integer Overflows, SQL Injection, Command Injection,
Failing to Handle Errors, Cross-Site Scripting, Failing to Protect Network Traffic, Magic URLs Hidden Form Fields,
Improper Use of SSL and TLS, Weak Password-Based Systems, Failing to Store and Protect Data Securely, Information
Leakage, Improper File Access, Trusting Network Name Resolution, Race Conditions, Unauthenticated Key Exchange, Cryptographically Strong Random Numbers, Poor Usability
\end{list1}


\slide{Recommendations for wireless networks}

\begin{minipage}{10cm}
\includegraphics[width=10cm]{images/wlan-accesspoint-2.pdf}
\end{minipage}
\begin{minipage}{\linewidth-10cm}
\begin{list2}
\item Use a specific SSID - network name, influences the WPA PSK keying
\item Never use WEP
\item Use WPA PSK or Enterprise, or at least some VPN with individual user logins

\item When using WPA Personal/PSK passphrase must be long, like +40 chars!
\item Place network Access Points on the network where they can be monitored. Separate VLAN, isolated from the cabled LAN
\item Have rules for the use of wireless networks, also for persons travelling - "Always use VPN when using insecure wireless in hotels, airports etc."
\end{list2}
\end{minipage}


\myquestionspage

\end{document}
