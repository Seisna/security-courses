\documentclass[Screen16to9,17pt]{foils}
%\documentclass[16pt,landscape,a4paper,footrule]{foils}
\usepackage{zencurity-slides}

% Sårbarhedsmitigering, værktøjer og processer
% Fokus på begreberne indenfor sårbarheder og på den længerevarende beskyttelse af organisationen

% Der er store problemer med sårbarheder i de fleste organisationer. Vores software og infrastruktur er bygget på sand, både reelt i form af computere, men også i overført betydning at sikkerheden skrider væk under os.

% Hver måned kommer der hundredevis af nye sårbarheder, og selvom vi ikke har al den sårbare software installeret, er det en næsten uoverkommelig opgave at holde miljøerne sikre imod indbrud og skade.

% I dette foredrag vil vi tage udgangspunkt i begreberne indenfor sårbarheder, mitigering, beskyttelse med fokus på længerevarende beskyttelse af organisationen.

% Der vil være elementer fra:
% * Sårbarheder, hvad er de, og hvad er exploits, der udnytter dem
% * Patch management, herunder asset discovery and management
% * Software security
% * Long term mitigation and protection
% * Security Metrics - hvordan måler vi, om det går fremad
% * Hvordan står vi bedst klar til hændelseshåndtering / incident response
% * Security frameworks for the organisation
%
% * Forudsætninger
% * Interesse for sikring af netværk, infrastruktur og organisationer imod sikkerhedsbrud som følge af sårbarheder.


\begin{document}
%\rm
\selectlanguage{english}

\mytitlepage
{Vulnerability Management}{Tools and Processes}

\hlkprofiluk



\slide{Goals for today}

\begin{quote}
  “A goal without a plan is just a wish.”\\
  ― Antoine de Saint-Exupéry
\end{quote}


\hlkimage{5cm}{pawel-janiak-dxFi8Ea670E-unsplash.jpg}


\begin{list1}
\item What are vulnerabilities and exploits
\item Patch management -- asset discovery and management
\item Long term mitigation and protection -- how can we achieve that
\hskip 2cm {\footnotesize Photo by Pawel Janiak on Unsplash}
\end{list1}



\slide{Malware and Worms}

\begin{list1}
\item {\bf Definition 23-1} \emph{Malicious logic}, more commonly called \emph{malware}, is a set\\
 of instructions that cause a site's security policy to be violated
 \item {\bf Definition 23-4} A \emph{computer virus} is a program that inserts (a possibly transformed version of) itself into one or more files and then performs some (possibly null) action.
\item {\bf Definition 23-2} A \emph{Trojan horse} is a program with an overt (documented or\\
known) purpose and a covert (undocumented or unexpected) purpose
\item {\bf Definition 23-14} A \emph{computer worm} is a program that copies itself from one computer to another. Computer worms has existed since research began mid-1970s
\end{list1}
Source: \emph{Computer Security: Art and Science}, 2nd edition 2019! Matt Bishop ISBN: 9780321712332\\
Virus, trojan or worm? Unless you work specifically in the computer virus industry, call it all malware


\slide{Vulnerability Analysis -- Trinity breaking in}

\hlkimage{12cm}{trinity-nmapscreen-hd-cropscale-418x250.jpg}
Very realistic: \link{https://nmap.org/movies/} and \link{https://youtu.be/51lGCTgqE_w}

\begin{list2}
\item \emph{Vulnerability} or security \emph{flaw} -- exploiting the vulnerability happens by an attacker
\item A program or script used for this is called an \emph{exploit}
\end{list2}

\slide{The Wikipedia definition}

%\hlkimage{}{}

\begin{quote}
Vulnerabilities are {\bf flaws} in a computer system that weaken the overall security of the system.

{\bf Despite intentions to achieve complete correctness, virtually all hardware and software contains bugs where the system does not behave as expected.} If the bug could enable an attacker to compromise the confidentiality, integrity, or availability of system resources, it is called a vulnerability. Insecure software development practices as well as design factors such as complexity can increase the burden of vulnerabilities. There are different types most common in different components such as hardware, operating systems, and applications.

{\bf Vulnerability management} is a process that includes identifying systems and prioritizing which are most important, scanning for vulnerabilities, and taking action to secure the system. Vulnerability management typically is a combination of remediation (fixing the vulnerability), mitigation (increasing the difficulty or reducing the danger of exploits), and accepting risks that are not economical or practical to eliminate.
\end{quote}
Source: \url{https://en.wikipedia.org/wiki/Vulnerability_(computer_security)}

Included this specifically because I agree \emph{virtually all hardware and software contains bugs}

\slide{What is an exploit?}

\begin{minted}[fontsize=\footnotesize]{ruby}
    sploit = {
      nil                   => /220.*Sendmail/,
      'DEBUG'               => /200 Debug set/,
      "MAIL FROM:<#{from}>" => /250.*Sender ok/,
      "RCPT TO:<#{to}>"     => /250.*Recipient ok/,
      'DATA'                => /354 Enter mail.*itself/,
      # Indent PATH= so it's not interpreted as a mail header
      " PATH=#{path}"       => nil,
      'export PATH'         => nil,
      payload.encoded       => nil,
      '.'                   => /250 Ok/,
      'QUIT'                => /221.*closing connection/
    }
\end{minted}
Source: {\footnotesize\url{https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/smtp/morris_sendmail_debug.rb}}

\begin{list2}
    \item Command injection through debugging \emph{feature}
\end{list2}


\slide{The Internet Worm 2. nov 1988}

\begin{list1}
\item Exploited the following vulnerabilities
\begin{list2}
\item buffer overflow in fingerd - VAX code
\item Sendmail - DEBUG functionality
\item Trust between systems: rsh, rexec, ...
\item Bad passwords
\end{list2}
\item Contained camouflage!
\begin{list2}
\item Program name set to 'sh'
\item Used fork() to switch PID regularly
\item Password cracking using intern list of 432 words and /usr/dict/words
\item Found systems to infect in /etc/hosts.equiv, .rhosts, .forward, netstat ...
\end{list2}
\item Made byRobert T. Morris, Jr.
\end{list1}


\slide{Many Years ago around 1988 }

\begin{minted}[fontsize=\footnotesize]{c}
/usr/src/etc/fingerd.c from 4.3BSD:
main(argc, argv)
        char *argv[];
{
        register char *sp;
        char line[512];  // This is a fixed size buffer
        struct sockaddr_in sin;
...
        line[0] = '\0';
        gets(line);      // This line can overflow the buffer, buffer overflow vulnerability
\end{minted}

Source code link \url{https://www.tuhs.org/cgi-bin/utree.pl?file=4.3BSD/usr/src/etc/fingerd.c}

More description in the articles:\\
{\footnotesize\url{https://spaf.cerias.purdue.edu/tech-reps/823.pdf}} \emph{The Internet Worm Program: An Analysis}
Purdue Technical Report CSD-TR-823
Eugene H. Spafford\\ {\footnotesize\url{https://blog.rapid7.com/2019/01/02/the-ghost-of-exploits-past-a-deep-dive-into-the-morris-worm/}}\\ The Ghost of Exploits Past: A Deep Dive into the Morris Worm



\slide{Stuxnet}

\begin{list1}
\item Worm in 2010 intended to infect Iran nuclear program
\item Target was the uranium enrichment process
\item Infected other industrial sites
\item SCADA, and Industrial Control Systems (ICS) are becoming very important for whole countries
\item A small \emph{community} of consultants work in these \emph{isolated} networks, but can be used as infection vector - they visit multiple sites
\item More can be found in \url{https://en.wikipedia.org/wiki/Stuxnet}
\end{list1}

\centerline{Exploits are worth millions! Bug bounty is a concept, developing and selling exploits}


\slide{Reality Hits -- every month}

\hlkimage{12cm}{microsoft-patch-tuesday-oct-2024.png}

\begin{quote}
Microsoft addresses {\bf 117 CVEs} with three rated as critical and four zero-day vulnerabilities, two of which were {\bf exploited in the wild}.
\end{quote}
Source: \url{https://www.tenable.com/blog/microsoft-october-2024-patch-tuesday-addresses-117-cves-cve-2024-43572-cve-2024-43573}, originally from Microsoft October 2024 Security Updates \url{https://msrc.microsoft.com/update-guide/releaseNote/2024-Oct}

\slide{Vulnerabilities - CVE}

\begin{list1}
\item Common Vulnerabilities and Exposures (CVE):
  \begin{list2}
  \item classification
  \item identification
  \end{list2}
\item When discovered each vuln gets a CVE ID
\item CVE maintained by MITRE - not-for-profit
org for research and development in the USA.
\item National Vulnerability Database search for CVE.
\item Sources: \link{http://cve.mitre.org/} og \link{http://nvd.nist.gov}
\item also checkout OWASP Top-10 \link{http://www.owasp.org/}
\end{list1}

\slide{Vulnerabilities are everywhere!}

\hlkimage{18cm}{cve-details-new-updated.png}
Source: CVEdetails.com on 2024-09-02

\begin{list2}
\item This is crazy! \url{https://www.cvedetails.com/}
\end{list2}

\slide{Vulnerabilities by type \& year}

\hlkimage{17cm}{cve-details-year.png}
Source: CVEdetails.com on 2024-09-02 Graph on the web site is interactive \url{https://www.cvedetails.com/}

\slide{LG TVs 2024 -- CVE-2023-6317 up to CVE-2023-6320}

\hlkimage{10cm}{LG-shodan.png}

\begin{quote}{\large\bf
90,000+ LG TVs Vulnerable to Authorization Attacks\\
Due to WebOS Vulnerabilities}

Bitdefender Labs has revealed a critical security flaw in over 90,000 LG smart TVs running the company’s proprietary WebOS platform.

If exploited, the vulnerability could allow attackers to gain unauthorized access to the TV’s functions and potentially the user’s home network.

\end{quote}
Source: \url{https://cybersecuritynews.com/lg-tvs-vuauthorization-attacks/}



\slide{Sample vulnerabilities}

\begin{list1}
\item \small CVE-2000-0884\\
IIS 4.0 and 5.0 allows remote attackers to read documents outside of
the web root, and possibly execute arbitrary commands, via malformed
URLs that contain UNICODE encoded characters, aka the "Web Server
Folder Traversal" vulnerability.

\item \small CVE-2002-1182\\
IIS 5.0 and 5.1 allows remote attackers to cause a denial of service
(crash) via malformed WebDAV requests that cause a large amount of
memory to be assigned.

\item Source:\\
\link{http://cve.mitre.org/ - CVE}
\end{list1}

\centerline{And updates from vendors reference these too! A closed loop}

\slide{CWE Common Weakness Enumeration}

\hlkimage{18cm}{cwe-mitre-org.png}
\link{http://cwe.mitre.org/}

\slide{CWE/SANS Monster mitigations}

\hlkimage{13cm}{cwe-monster-mitigations.png}

Source:
\link{http://cwe.mitre.org/top25/index.html}



\slide{Reflecting on the Internet Worm at 35}

%\hlkimage{}{}

\begin{quote}
Thirty-five years ago today (November 2nd), the Internet Worm program was set loose to propagate on the Internet.
...
 All of that eventually led to a boom in add-on security measures, resulting in what is now a {\bf multi-billion dollar cybersecurity industry.}
...
The Worm provided us with an object lesson about many issues that, unfortunately, were not heeded in full to this day. {\bf That multi-billion dollar cybersecurity industry is still failing to protect far too many of our systems.}
\end{quote}
Source: \emph{Reflecting on the Internet Worm at 35}, November 02, 2023 by spaf, Eugene Spafford\\
\url{https://www.cerias.purdue.edu/site/blog/post/reflecting_on_the_internet_worm_at_35/}

\begin{list2}
\item Many of the same problems that plagued us earlier are still the same!
\item My thoughts are we should try something else than \emph{patch insanity}
\end{list2}


\slide{Case in point: SQL injection affecting airport security}

%\hlkimage{}{}

\begin{quote}
{\large Bypassing airport security via SQL injection}\\
08/29/2024\\
Like many, Sam Curry and I spend a lot of time waiting in airport security lines. If you do this enough, you might sometimes see a special lane at airport security called Known Crewmember (KCM). KCM is a TSA program that allows pilots and flight attendants to bypass security screening, even when flying on domestic personal trips.

The KCM process is fairly simple: the employee uses the dedicated lane and presents their KCM barcode or provides the TSA agent their employee number and airline. Various forms of ID need to be presented while the TSA agent’s laptop verifies the employment status with the airline. If successful, the employee can access the sterile area without any screening at all.
\end{quote}
Source: \url{https://ian.sh/tsa}

\begin{list2}
\item And SQL injection is one of the \emph{easiest} software security problems to guard against!
\end{list2}



\slide{Protection, building secure and robust networks}

\hlkimage{10cm}{sample-ip-network.pdf}


\begin{list2}
\item We should prefer security mechanisms that does NOT require us to keep patching every month
\item Can we change our infrastructure and networks to avoid this? {\bf Yes!}
\item Reduce complexity -- note adding VLANs may seem to increase, but also reduce number of systems that can interact, and each \emph{network} is afterwards easier to understand
\item Limit the attack surface -- fewer systems exposed \faArrowRight fewer vulns exposed, fewer services \faArrowRight  less code!
\end{list2}


\slide{Defense in depth}

%\hlkimage{10cm}{Bartizan.png}
\hlkimage{15cm}{medieval-clipart-5}
\centerline{Picture originally from: \url{http://karenswhimsy.com/public-domain-images}}




\slide{Goals of Security -- short version}

\hlkimage{12cm}{OODA.Boyd.png}
{\footnotesize Source: Patrick Edwin Moran - Wikipedia \link{https://en.wikipedia.org/wiki/OODA_loop}}

\begin{list2}
\item Prevention - means that an attack will fail
\item Detection - determine if attack is underway, or has occured - report it
\item Recovery - stop attack, assess damage, repair damage
\end{list2}

\slide{OSI Model and Internet Protocols}

\hlkimage{9cm,angle=90}{images/compare-osi-ip.pdf}

\centerline{I recommend securing things from the bottom and from the outside}

\slide{\faWrench\ Books and courses}

%\hlkimage{}{}

How:

I like to learn new concepts from books
\begin{list2}
\item Have a clear structure, less confusion
\item They go from a basic level towards a complete goal
\item Often have exercises available with nice progression
\item Lots of nice books available from \link{http://www.nostarch.com/} and others
\item Often you can get Humble bundles with many books for \$25
\item Some books are "free" if you give your email address, example
\item Can function as inspiration and a checklist
\end{list2}

Pro Tip: all my courses and exercise booklets are available on Github!

Humble Bundle! \url{https://www.humblebundle.com/}



\slide{Book: Defensive Security Handbook (DSH)}

\hlkimage{6cm}{defensive-security-handbook.jpg}

\emph{Defensive Security Handbook: Best Practices for Securing Infrastructure}, Lee Brotherston, Amanda Berlin, William F. Reyor ISBN: 9781098127237, 362 pages -- Note: 2nd edition updated 2024\\
{\footnotesize\link{https://learning.oreilly.com/library/view/defensive-security-handbook/9781098127237/}}

\slide{Network Security Through Data Analysis}

\hlkimage{6cm}{network-security-through-data-analysis.png}


\emph{Network Security through Data Analysis }, Michael S Collins, 2nd Edition, 2017\\
{\footnotesize\url{https://learning.oreilly.com/library/view/network-security-through/9781491962831/}}


\slide{\faWrench\ Recommended tools to learn -- DevSecOps}

\hlkimage{4cm}{005scawebiaidosezaicon.png}

\begin{list2}
\item Open Source I really love open source. There is just too much great open source software, to ignore
\item Linux/Unix knowledge is necessary
-- because a lot of the newest tools are written for Linux/Unix/BSD
\item Git and Github -- where you can find lots of tools, libraries, applications
\item Programming experience is an advantage for automating stuff\\
Python is a nice generic tool for this, PowerShell is another alternative
\item Ansible -- installing and configuring software for production, gathering information
\item Elasticsearch -- how to run a \emph{service}, full fledged applications exist for Elasticsearch
\item OpenSSH -- included in Linux and Windows, allows for Rsync, Git, port forward etc.
\end{list2}

\slide{\faWrench\ Learning DevSecOps: A Practical Guide to Processes and Tools}

\hlkrightpic{5cm}{-5cm}{learning-devsecops.jpg}
\hlkimage{18cm}{secdevops-iterations.png}

\emph{Learning DevSecOps}, Steve Suehring
Released May 2024, O'Reilly, ISBN: 9781098144869

\slide{Thursday What a concept}

\hlkimage{10cm}{thursday.jpg}

\begin{quote}
Alt text: Nadia from the Russian Doll fearing that she would never see a Thursday again says, "Thursday. What a concept" while smoking a cigarette
\end{quote}

\begin{list2}
\item Mastodon bot \url{https://botsin.space/@thursday} post the same picture each thursday
\item Github Actions Workflows, se \url{https://github.com/devashishp/thursday} and \url{https://docs.github.com/en/actions/writing-workflows}

\end{list2}

\slide{\faWrench\ Github Actions Workflows }

\begin{minted}[fontsize=\small]{yaml}
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.10
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install Mastodon.py
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
    - name: Run Script
      run:
        python bot.py
\end{minted}

\slide{\faWrench\ Open Source and Python}
\hlkimage{7cm}{maltrail.png}

\begin{list2}
\item Open Source is already written *doh*
\item Can provide solutions or parts of a solution
\item Often feature-rich, mature, tested, maintained, and even when \emph{not} can be brought back to life
\item Picture from Maltrail \link{https://github.com/stamparm/maltrail}\\
Maltrail is a malicious traffic detection system, utilizing publicly available (black)lists containing malicious and/or generally suspicious trails, along with static trails compiled from various AV reports and custom user defined lists,
\end{list2}




\slide{\faWrench\ Ansible Configuration management and more!}

%\hlkimage{}{}

Platform options Ansible:
\begin{alltt}
CloudEngine OS, CNOS, Dell OS6, Dell OS9 Dell OS10, ENOS, EOS, ERIC_ECCLI, EXOS,
FRR, ICX, IOS, IOS-XR, IronWare, Junos OS, Meraki, Pluribus NETVISOR, NOS, NXOS,
RouterOS, SLX-OS, VOSS, VyOS, WeOS 4

plus routers based on Linux, OpenBSD, FreeBSD etc.
\end{alltt}

One management system with many uses, free to download and use
\begin{list2}
\item Generic configuration management -- and you end up running support systems, network near systems
\item Ansible for Network Automation\\
\link{https://docs.ansible.com/ansible/latest/network/index.html}
\item Allows you to install, configure and run your infrastructure
\item Depends on Python and SSH, or module for the network devices
\end{list2}

\slide{Python and YAML}

\hlkimage{7cm}{git-logo.png}

\begin{list2}
\item We need to store configurations of devices and systems
\item Run Ansible playbooks
\item Problem: Remember what we did, when, how
\item Solution: use git for the playbooks
\item Not the only version control system, but my preferred one
\item Git can also be used by Oxidized which I also love \link{https://github.com/ytti/oxidized}
\end{list2}

\slide{Gathering information from Systems automatically}

\begin{minted}[fontsize=\footnotesize]{shell}
yamabushi$ ansible -m setup sunny | egrep "ansible_distribution|kernel"
        "ansible_distribution": "OpenBSD",
        "ansible_distribution_release": "release",
        "ansible_distribution_version": "7.5",
        "ansible_kernel": "7.5",
        "ansible_kernel_version": "GENERIC.MP#82",
\end{minted}

\begin{list2}
\item Quick and dirty, output it JSON -- so could use jq instead \url{https://jqlang.github.io/jq/}
\end{list2}

\slide{Creating automation playbooks with YAML }

\begin{minted}[fontsize=\footnotesize]{yaml}
yamabushi$ cat os-release.yaml
---
- hosts: all
  gather_facts: yes
  become: false
  tasks:
  - name: Distribution
    debug: msg="{{ ansible_distribution }}"
  - name: Distribution version
    debug: msg="{{ ansible_distribution_version}}"
\end{minted}

\begin{list2}
\item Creating playbooks is not dificult
\end{list2}

\slide{Output from Automation}

%\hlkimage{}{}

\begin{minted}[fontsize=\footnotesize]{json}
TASK [Distribution version] *******************
...
ok: [sunny] => {
    "msg": "7.5"
}
ok: [shito] => {
    "msg": "7.4"
}
ok: [conserver01] => {
    "msg": "7.5"
}
ok: [pumba] => {
    "msg": "7.6"
}
\end{minted}

\begin{list2}
\item So it seems I have upgraded some systems to OpenBSD 7.5, and 7.6
\item One is only OpenBSD 7.4 -- plan ugrade soon
\end{list2}


\slide{\faWrench\ Wazuh}

\hlkimage{8cm}{01-Wazuh-Security-Analytics-op.png}

\begin{quote}\small
Wazuh agents scan the monitored systems looking for malware, rootkits and suspicious anomalies. They can detect hidden files, cloaked processes or unregistered network listeners, as well as inco
nsistencies in system call responses.\\
Source: text and picture from \link{https://wazuh.com/}
\end{quote}

\begin{list2}
\item Wazuh initially a fork of the OSSEC project, and has integration with Elastic Stack
\end{list2}


\slide{Wazuh agent}

\begin{quote}\small
The Wazuh lightweight agent is designed to perform a number of tasks with the objective of detecting threats and, when necessary, trigger automatic responses. The agent core capabilities are:

The Wazuh agents run on many different platforms, including Windows, Linux, Mac OS X, AIX, Solaris and HP-UX. They can be configured and managed from the Wazuh server.\\
Source: \link{https://wazuh.com/}
\end{quote}

\begin{list2}
\item Log and events data collection
\item File and registry keys integrity monitoring
\item Inventory of running processes and installed applications
\item Monitoring of open ports and network configuration
\item Detection of rootkits or malware artifacts
\item Configuration assessment and policy monitoring
\item Execution of active responses
\end{list2}

\slide{Asset inventory}

\hlkimage{7cm}{overview-routing-customer-2015.png}

\begin{list2}
\item Routers on the way to critical systems and networks -- especially availability
\item Firewall -- is the environment protected sufficiently, discarding probes
\item Mail servers -- relay testing and also critical data
\item Web servers -- holds data, typically has a lot of functionality
\item Cloud systems, storage systems, anywhere data is saved
\item I recommend Nmap for both offensive and defensive purposes! \url{https://nmap.org}
\end{list2}


\slide{Reporting -- results}

\begin{list1}
\item What is in a pentest report:
\begin{list2}
\item Title, Table of contents, formal report thanks
\item Confidentiality agreement – Write ”Confidential” on each page
\item Executive summary – big companies always want this
\item Information about the scan done, what was it
\item Scope and targets
\item Review of all targets – detailed information and recommendations
\item Conclusion – may be more technical
\item Appendices – various information, Whois info about subnets and prefixes
\end{list2}
\item BTW When delivering a report, it is up to the organisation to decide which recommendations to implement
\end{list1}

Sample report available at: \link{https://github.com/kramse/pentest-report}


\slide{Basic Portscan}

\begin{list1}
\item What is port scanning
\item Testing all ports from 0/1 up to 65535
\item Goal is to identify open ports -- vulnerable services
\item Typically TCP and UDP scans
\item TCP scanning is more reliable than UDP scanning
\item TCP handshake is easy to see, due to session setup -- services must respond to SYN with SYN-ACK. Otherwise client programs like browsers will not work
\item UDP applications respond differently -- if at all\\
They might respond to queries and probes in the correct format, \\
If no firewall the operating systems will respond with ICMP on closed ports
\item Use Zenmap while learning Nmap
\end{list1}


\slide{Nmap port sweep for web services}

\begin{alltt}\small
root@cornerstone:~#{\bfseries  nmap -p80,443 172.29.0.0/24}

Starting Nmap 6.47 ( http://nmap.org ) at 2015-02-05 07:31 CET
Nmap scan report for 172.29.0.1
Host is up (0.00016s latency).
PORT    STATE    SERVICE
{\color{darkgreen}80/tcp  open     http}
443/tcp filtered https
MAC Address: 00:50:56:C0:00:08 (VMware)

Nmap scan report for 172.29.0.138
Host is up (0.00012s latency).
PORT    STATE  SERVICE
{\color{darkgreen}80/tcp  open   http}
443/tcp closed https
MAC Address: 00:0C:29:46:22:FB (VMware)

\end{alltt}


\slide{Nmap Advanced OS detection}

\begin{alltt}\footnotesize
root@cornerstone:~#{\bfseries nmap -A -p80,443 172.29.0.0/24}
Starting Nmap 6.47 ( http://nmap.org ) at 2015-02-05 07:37 CET
Nmap scan report for 172.29.0.1
Host is up (0.00027s latency).
PORT    STATE    SERVICE VERSION
80/tcp  open     http    Apache httpd 2.2.26 ((Unix) DAV/2 mod_ssl/2.2.26 OpenSSL/0.9.8zc)
|_http-title: Site doesn't have a title (text/html).
443/tcp filtered https
MAC Address: 00:50:56:C0:00:08 (VMware)
Device type: media device|general purpose|phone
Running: Apple iOS 6.X|4.X|5.X, Apple Mac OS X 10.7.X|10.9.X|10.8.X
OS details: Apple iOS 6.1.3, Apple Mac OS X 10.7.0 (Lion) - 10.9.2 (Mavericks)
or iOS 4.1 - 7.1 (Darwin 10.0.0 - 14.0.0), Apple Mac OS X 10.8 - 10.8.3 (Mountain Lion)
or iOS 5.1.1 - 6.1.5 (Darwin 12.0.0 - 13.0.0)
OS and Service detection performed.
Please report any incorrect results at http://nmap.org/submit/
\end{alltt}

\begin{list2}
\item Low level operating system identification, often I use \verb+nmap -A+
\item Send packets, observe responses, match with tables of known operating system fingerprints
\item An early reference for this was: \emph{ICMP Usage In Scanning} Version 3.0,
  Ofir Arkin, 2001 %\link{https://web.archive.org/web/20050210093427/http://www.sys-security.com/html/projects/icmp.html} % Original side er død
\end{list2}


\slide{Scan for Heartbleed and SSLv2/SSLv3}

Nmap includes Nmap scripting engine (NSE)

\hlkimage{5cm}{nmap-sslv2.png}

\begin{list1}
\item \verb+nmap -p 443 --script ssl-heartbleed <target>+\\
\link{https://nmap.org/nsedoc/scripts/ssl-heartbleed.html}
\item Almost every new popular vulnerability will have Nmap recipe
\end{list1}


\slide{\faWrench\ LibreNMS Automatic discovery -- inventory management}

\hlkimage{10cm}{librenms-switches.png}

Automatically discover your entire network using CDP, FDP, LLDP, OSPF, BGP, SNMP and ARP \\
See all the versions, what do you have, what needs to be secure \url{https://www.librenms.org/}


\slide{Analysis on Docker Hub malicious images: Attacks through public container images}

\hlkimage{10cm}{sysdig-malicious-images.png}
This article is relevant, talking about malicious docker images\\
\link{https://sysdig.com/blog/analysis-of-supply-chain-attacks-through-public-docker-images/}


\slide{Keeping Container Images secure}

\begin{list2}
\item \faWrench\ \verb+anchore+ open-source project that provides a centralized service for inspection, analysis, and certification of container images
\link{https://github.com/anchore/anchore-engine}\\
"As of 2023, Anchore Engine is no longer maintained. There will be no future versions released. Users are advised to use Syft and Grype."
\item \faWrench\ \verb+Syft+ \link{https://github.com/anchore/syft} and \faWrench\ \verb+Grype+ \link{https://github.com/anchore/grype}
\item Allow direct download from the internet into your cluster, may become a problem
\item Malicious people are typosquatting popular containers!
\item Suply chain attacks in general are a problem
\end{list2}

\slide{Harden Container Images and Update Your Procedures}

\begin{list2}
\item Change the goddamn passwords!\\
Container postgresql with user postgres and password *postgres*, REALLY!!!!!!1111
\item and NO MORE ROOT! Dont run as root, we realized this was bad in the 1990s!
\item CIS Docker Benchmarking also Learn Kubernetes Security \emph{Chapter 8: Securing Kubernetes Pods}
\item Hacking Kubernetes \emph{Chapter 8: Policy} - describe things like Resource Quotas, Runtime Policies
\end{list2}

\slide{Recommendations from CIS Docker Benchmark}

\hlkimage{14cm}{cis-docker-1.png}
Summary from: \link{https://www.aquasec.com/cloud-native-academy/docker-container/docker-cis-benchmark/}

\begin{list2}
\item Latest version: CIS Docker Benchmark v1.5.0 - 12-28-2022
\end{list2}


\slide{Benchmarking tools}

\begin{quote}
\faWrench\ \verb+Kube-bench+ is the industry-standard tool to automate checking Kubernetes compliance with the Center for Internet Security (CIS) Benchmark.

Kube-bench makes it easy for operators to check whether each node in their Kubernetes cluster is configured according to security best practices.
\end{quote}
Source: \link{https://info.aquasec.com/open-source}

\begin{list2}
\item CIS Kubernetes V1.24 Benchmark v1.0.0 - 09-21-2022 -- other versions exist
\item CIS Docker Benchmark v1.5.0 - 12-28-2022
\end{list2}

%\slide{Benchmarking and keeping up to date}

% Try it out \faWrench\ \verb+kube-bench+ - make some bad changes, like LKS p95 allow anonymous authentication, show why layered defense works, and how kube-bench marks it. Another example token based access, initially we have token while installing, remember to remove!
% \faWrench\ \verb+kube-hunter+ and kube-bench

\slide{Tool example kube-bench}

%\hlkimage{}{}

\begin{alltt}\scriptsize
hlk@timon:~/bin/kube-bench/kube-bench$ {\bf kubectl logs kube-bench-gdf62}
[PASS] 1.1.7 Ensure that the etcd pod specification file permissions are set to 600 or more restrictive (Automated)
[PASS] 1.1.8 Ensure that the etcd pod specification file ownership is set to root:root (Automated)
[WARN] 1.1.9 Ensure that the Container Network Interface file permissions are set to 600 or more restrictive (Manual)
[WARN] 1.1.10 Ensure that the Container Network Interface file ownership is set to root:root (Manual)
[PASS] 1.1.11 Ensure that the etcd data directory permissions are set to 700 or more restrictive (Automated)
[FAIL] 1.1.12 Ensure that the etcd data directory ownership is set to etcd:etcd (Automated)
...
== Summary policies ==
0 checks PASS
0 checks FAIL
35 checks WARN
0 checks INFO

== Summary total ==
63 checks PASS
10 checks FAIL
58 checks WARN
0 checks INFO

\end{alltt}

\begin{list2}
\item \url{https://github.com/aquasecurity/kube-bench} also check out Lynis \url{https://cisofy.com/lynis/}
\end{list2}




\slide{Introducing firewalls}


Some of these slides are part of the course:\\
\emph{Communication and Network Security} at KEA, next course April 2. 2024\\
\url{https://kompetence.kea.dk/kurser-fag/netv%C3%A6rk-og-kommunikationssikkerhed}

specifically the slideshow\\
\emph{3. Traffic Inspection and Firewalls}

I also have multiple presentations and materials about related subjects in my Github:

\begin{list2}
\item Attack and Defense
\item DDoS Testing
\item Security in a Mixed IPv4 and IPv6 World
\item SIEM and Log analysis
\item Kubernetes Security
\end{list2}

\slide{Networks are trouble}

\hlkimage{9cm}{dragon-drawing-6.jpg}
\centerline{\Large Internet here be dragons}

\begin{list2}
\item Networks are constantly evolving
\item Increased threat landscape, World wide networks, attacks from everywhere
\item Vulnerabilities are found daily, Software quality - even security and firewall software has flaws
\item Even more vulnerabilities are \emph{developed} and \emph{installed}\\
Sorry developers, but some of you don't care, and it shows!
\end{list2}


\slide{Back in the day: Firewalls and Internet Security, 1994}

\hlkimage{4cm}{images/cheswick-cover2e.jpg}
\begin{list2}
\item \emph{Firewalls and Internet Security: Repelling the Wily Hacker} , Second Edition 2003, William R. Cheswick, Steven M. Bellovin, and Aviel D. Rubin, {\bf 2003} \link{http://www.wilyhacker.com/}
\item The full PDF—and the full LaTeX source of the book.
Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License.
\item How to configure firewalls often boil down to, should we allow protocol X
\item If we allow certain protocols through a firewall, we are asking for trouble
\end{list2}


\slide{Network Segmentation -- Firewalls}

\begin{quote}\small
\$ firewall\\

1. (I) {\bf An internetwork gateway that restricts data communication traffic to and from one of the connected networks} (the one said to be "inside" the firewall) and thus protects that network's system resources against threats from the other network (the one that is said to be "outside" the firewall). (See: guard, security gateway.)

2. (O) {\bf A device or system that controls the flow of traffic between networks using differing security postures.} Wack, J. et al (NIST), "Guidelines on Firewalls and Firewall Policy", Special Publication 800-41, January 2002.

Tutorial: A firewall typically protects a smaller, secure network (such as a corporate LAN, or even just one host) from a larger network (such as the Internet). The firewall is installed at the point where the networks connect, and the firewall applies policy rules to control traffic that flows in and out of the protected network.
\end{quote}
Source: RFC4949 \emph{Internet Security Glossary, Version 2\\
\link{https://datatracker.ietf.org/doc/html/rfc4949} 2007}

\slide{Continued}
\begin{quote}\small
{\bf A firewall is not always a single computer.} For example, a firewall may consist of a pair of filtering routers and one or more proxy servers running on one or more bastion hosts, all connected to a small, dedicated LAN (see: buffer zone) between the two routers. The external router blocks attacks that use IP to break security (IP address spoofing, source routing, packet fragments), while proxy servers block attacks that would exploit a vulnerability in a higher-layer protocol or service. The internal router blocks traffic from leaving the protected network except through the proxy servers. The difficult part is defining criteria by which packets are denied passage through the firewall, because a firewall not only needs to keep unauthorized traffic (i.e., intruders) out, but usually also needs to let authorized traffic pass both in and out.
\end{quote}
{\footnotesize Source: RFC4949 \emph{Internet Security Glossary, Version 2}\\
\link{https://datatracker.ietf.org/doc/html/rfc4949} 2007}

\slide{What is a packet filter}

We may want to distinguis between different types of firewalls/devices:
\begin{list2}
\item Network layer, we often call them packet filters, stateless
\item Application level, we often call them, stateful filtering and gateways
\item Firewalls are by design a choke point, natural place \\
to do network security monitoring!
%\item Older but still interesting Cheswick chapter 2 PDF
%\emph{A Security Review of Protocols: Lower Layers}\\
%\link{http://www.wilyhacker.com/}
\end{list2}

They are all firewalls -- or firewall devices!
\slide{Best Current Practice }

%\hlkimage{}{}

\begin{quote}
Lets get this out of the way immediately, you should already be doing
\end{quote}

\begin{list2}
\item Network segmentation and filtering -- we could write a book about this! {\myalert}
\item Monitor your network -- both bandwidth, error, netflow etc. {\myalert}
\item Take control of your network, no more admin/admin logins on core devices {\myalert}
\item Turn on authentication for protocols -- routing protocols but also any http service within your org {\myalert}
\item Configure host-based firewalls {\myalert}
\item Control DNS -- internally and externally, recursive, authoritative etc. {\myalert}
\end{list2}

\centerline{This goes for IPv4-only, IPv6-only, and mixed networks!}

\slide{\faWrench\ Isolation and Network Segmentation -- Virtual LAN (VLAN)}

\hlkimage{8cm}{vlan-portbased.pdf}

\begin{list1}
\item Managed switches often allow splitting into zones called virtual LANs
\item Most simple version is port based
\item Like putting ports 1-4 into one LAN and remaining in another LAN
\item Packets must traverse a router or firewall to cross between VLANs
\end{list1}

\slide{Virtual LAN (VLAN) IEEE 802.1q}

\hlkimage{15cm}{vlan-8021q.pdf}

\begin{list1}
\item Using IEEE 802.1q  VLAN tagging on Ethernet frames
\item Virtual LAN, to pass from one to another, must use a router/firewall
\item Allows separation/segmentation and protects traffic from many security issues
\item Used in most, if not all, Wi-Fi networks -- each SSID has a VLAN behind it
\end{list1}


\slide{Network Access Control -- Connecting clients more securely}

Talking about standard, another useful one:\\
IEEE 802.1x -- Port Based Network Access Control

\hlkimage{7cm}{802.1X_wired_protocols.png}

\begin{list1}
\item Authentication protocol ensures user validation before port access
\item Can authenticate using username and then password or certificate
\item Typically RADIUS and 802.1x which can use LDAP or Active Directory
\item Already used in Wi-Fi networks, so can be turned on for wired Ethernet ports
\end{list1}


\slide{Network Protocol Knowledge Needed for Network Security}

To work with network security the following protocols are the bare minimum to know about.

\begin{list2}
\item ARP Address Resolution Protocol for IPv4
\item NDP Neighbor Discovery Protocol for IPv6
\item IPv4 \& IPv6 -- the basic packet fields source, destination,
\item ICMPv4 \& ICMPv6 Internet Control Message Protocol
\item UDP User Datagram Protocol
\item TCP Transmission Control Protocol
\item DHCP Dynamic Host Configuration Protocol
\item DNS Domain Name System
\end{list2}

These protocols are part of the Internet Protocol suite, or TCP/IP for short. The canonical document describing this is from 1981 RFC-0791 \citetitle{RFC0791}. The protocols were deployed on the internet around 1983.



\slide{Book: Practical Packet Analysis (PPA)}
\hlkimage{6cm}{PracticalPacketAnalysis3E_cover.png}

\emph{Practical Packet Analysis,
Using Wireshark to Solve Real-World Network Problems}
by Chris Sanders, 3rd Edition
April 2017, 368 pp.
ISBN-13:
978-1-59327-802-1

\link{https://nostarch.com/packetanalysis3}

\slide{Book: Applied Network Security Monitoring (ANSM)}

\hlkimage{5cm}{ansm-book.png}

\emph{Applied Network Security Monitoring: Collection, Detection, and Analysis}
1st Edition

Chris Sanders, Jason Smith
eBook ISBN: 9780124172166
Paperback ISBN: 9780124172081 496 pp.
Imprint: Syngress, December 2013



\slide{Firewall configuration}

Best firewall starts with the design
\begin{list2}
\item Drawings -- lots of drawings and topology
\item An addressing plan! This is very important
\item Then use a GUI for your first experience
\item Plan for long term care
\item Plan for updates
\item Systems and services behind the firewall must still be hardened and configured securely
\end{list2}

\slide{Block outgoing traffic too}

\begin{list1}
\item Some services should \emph{not} cross firewalls, at least not to the internet
\item Some services are too \emph{fragile}

\begin{list2}
\item Windows SMB file sharing is \emph{only} for small internal networks
\item Unix NFS is like-wise \emph{only} for internal use
\item Outgoing email should only go via dedicated relays
\item LDAP outgoing, why?! See the log4j CVE-2021-44228
\item Create a list, document them and consider them dead!
\end{list2}
\item Making a positive list of allowed protocols would be best, but may require too many resources to implement and update
\end{list1}


\slide{Proxy servers and Web Application Firewalls (WAF)}

\begin{list2}
\item Filtrering at higher layers is also possible
\item Web proxies for clients can help security a lot -- a centralized filter for everyone

\item Reverse proxies for web applications are called
Web Application Firewalls (WAF) -- and filter incoming web requests, and outgoing answers. Can help with attacks like SQL injection and exfiltration of data
\item Depending on your network it can replace or be combined with filtering on DNS servers, and I would prefer to filter domains with DNS
\item I would also prefer blocking large prefixes of IP destinations using routers/stateless packet filters -- maybe use BGP for distributing \emph{lists}
\end{list2}


\slide{Netflow and Session Logging}

\begin{list2}
\item Netflow is getting more important, more data share the same links
\item Accounting is important
\item Detecting DoS/DDoS and problems is essential
\item Netflow sampling is vital information - 123Mbit, but what kind of traffic
\item NFSen is an old but free application
\link{http://nfsen.sourceforge.net/}
\item Currently also investigating sFlow - hopefully more fine grained
\item sFlow, short for "sampled flow", is an industry standard for packet export at Layer 2 of the OSI model, \\
\link{https://en.wikipedia.org/wiki/SFlow}
\end{list2}

\centerline{Netflow is often from routers, we dont have any here}

\slide{Collect Network Evidence from the network}

\begin{list1}
\item Network Flows
\item Cisco standard NetFlow version 5 defines a flow as a unidirectional sequence of packets that all share the following 7 values:
\begin{list2}
\item Ingress interface (SNMP ifIndex)
\item IP protocol, Source IP address and Destination IP address
\item Source port for UDP or TCP, 0 for other protocols
\item Destination port for UDP or TCP, type and code for ICMP, or 0 for other protocols
\item IP Type of Service
\end{list2}
\item today Netflow version 9 or IPFIX
\end{list1}

Source: \\{\footnotesize
\link{https://en.wikipedia.org/wiki/NetFlow}\\
\link{https://en.wikipedia.org/wiki/IP_Flow_Information_Export}}



\slide{ElastiFlow -- Elasticsearch based}

\hlkimage{10cm}{elastiflow.png}

\begin{quote}
  ElastiFlow™ provides network flow data collection and visualization using the Elastic Stack (Elasticsearch, Logstash and Kibana). It supports Netflow v5/v9, sFlow and IPFIX flow types (1.x versions support only Netflow v5/v9).
\end{quote}
Source: Picture and text from \link{https://github.com/robcowart/elastiflow} \\

\slide{Akvorado: flow collector, enricher and visualizer}

\hlkimage{8cm}{akvorado-timeseries.png}

\begin{quote}
This program receives flows (currently Netflow/IPFIX and sFlow), enriches them with interface names (using SNMP), geo information (using IPinfo.io), and exports them to Kafka, then ClickHouse. It also exposes a web interface to browse the collected data.
\end{quote}
Source: Picture and text from \url{https://github.com/akvorado/akvorado}





\slide{Who are you gonna call?}

%\hlkimage{}{}

\begin{quote}
Cyberangreb kan blive en dyr omgang for SMV’erne
Et ransomware angreb koster 376.350 kr. alene i tabt omsætning fra e-handel for en virksomhed med 10-49 ansatte. I lyset af at truslen for cyberkriminalitet er på sit højeste, skal flere SMV’er have hjælp til at øge deres IT-sikkerhed. Særligt efter en hård tid under COVID-19, som har tvunget virksomhedernes fokus væk fra IT-sikkerhed.
\end{quote}
Source: SMVdanmark Marts 2022 \url{https://smvdanmark.dk/analyser/temaanalyser/cyberangreb-kan-blive-en-dyr-omgang-for-smverne}

\begin{list2}
\item You need friends!

\item Incident Response is a specialized area

\item They cost upwards of 1.500DKK / hour -- more if outside of business hours
\item Pre-arranged is recommended, agree on \emph{who can call them}, decide up front when to call them -- not for every little incident
\item Expect an incident to cost at least 100.000DKK plus time, lost hours, lost orders, etc.
\end{list2}



\slide{\faWrench\ Primary Incident Response Literature}

\hlkrightpic{5cm}{0cm}{old_book_lumen_design_st_01.png}
Primary literature:
\begin{list2}
\item \emph{Intelligence-Driven Incident Response} \\
 Scott Roberts. Rebekah Brown, ISBN: 9781098120689 {\bf 2nd edition}- short IDIR
\item \emph{Computer Security Incident Handling Guide}, NIST SP 800-61 Rev. 2, August 2012,\\
\link{https://doi.org/10.6028/NIST.SP.800-61r2} -- also uploaded to Fronter
\item \emph{Forensics Discovery} (FD), Dan Farmer, Wietse Venema 2004, Addison-Wesley 240 pages.\\
ISBN: 9780201634976\\
This book is currently available for "free":\\
\link{http://fish2.com/security/} -- also uploaded to Fronter
\end{list2}

These resources are used by me for the introduction to incident response courses, it all boils down to having data available to perform investigations!


\slide{Risk management defined}

\hlkimage{20cm}{shon-harris-risk-management.png}

Source: Shon Harris \emph{CISSP All-in-One Exam Guide}



\slide{Security Controls and Frameworks}

\begin{list1}
\item Multiple exist
\vskip 1cm
\begin{list2}
\item CIS controls Center for Internet Security (CIS) \link{https://www.cisecurity.org}
\item PCI Best Practices for Maintaining PCI DSS Compliance v2.0 Jan 2019
\item NIST Cybersecurity Framework (CSF)\\
Framework for Improving
Critical Infrastructure Cybersecurity\\ \link{https://www.nist.gov/cyberframework}\\
\link{https://csrc.nist.gov/publications/sp800} - SP800 series
\item National Security Agency (NSA)\\
\link{https://www.nsa.gov/Research/}
\item NSA security configuration guides\\
\link{https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/}
\item Information Systems Audit and Control Association (ISACA)\\
\link{http://www.isaca.org/Knowledge-Center/}
\end{list2}
\end{list1}

\slide{Center for Internet Security CIS Controls}

\begin{quote}
  “A goal without a plan is just a wish.”\\
  ― Antoine de Saint-Exupéry
\end{quote}

\begin{quote}
  The CIS ControlsTM are a prioritized set of actions that collectively form a defense-in-depth set
of best practices that mitigate the most common attacks against systems and networks. The
CIS Controls are developed by a community of IT experts who apply their first-hand experience
as cyber defenders to create these globally accepted security best practices. The experts who
develop the CIS Controls come from a wide range of sectors including retail, manufacturing,
healthcare, education, government, defense, and others.
\end{quote}

Source: \link{https://www.cisecurity.org/} CIS-Controls-Version-7-1.pdf


\slide{SIEM}

%\hlkimage{}{}

\begin{quote}
{\bf Security information and event management (SIEM)} is a subsection within the field of computer security, where software products and services combine security information management (SIM) and security event management (SEM). They provide real-time analysis of security alerts generated by applications and network hardware.

  Vendors sell SIEM as software, as appliances, or as managed services; these products are also used to log security data and generate reports for compliance purposes.[1]

  The term and the initialism SIEM was coined by Mark Nicolett and Amrit Williams of Gartner in 2005.[2]
\end{quote}
Source: \link{https://en.wikipedia.org/wiki/Security_information_and_event_management}

\begin{list2}
  \item Note: there are alerting examples towards the bottom of the page, with sources
  \item Closely related to log management, incident response
\end{list2}


\slide{SOC}

%\hlkimage{}{}

\begin{quote}
An information security operations center (ISOC or SOC) is a facility where enterprise information systems (web sites, applications, databases, data centers and servers, networks, desktops and other endpoints) are monitored, assessed, and defended.

...

A {\bf security operations center (SOC)} can also be called a security defense center (SDC), security analytics center (SAC), network security operations center (NSOC),[3] security intelligence center, cyber security center, threat defense center, security intelligence and operations center (SIOC). In the Canadian Federal Government the term, infrastructure protection center (IPC), is used to describe a SOC.
\end{quote}
Source: \link{https://en.wikipedia.org/wiki/Information_security_operations_center}

%\begin{list2}
%\item We have a whole book about SOCs, but I skipped the introductory chapters!
%\item If you need to build a SOC, that is great source of information
%\end{list2}


\slide{Incident Handling, phases}

The procedures developed for incident response must cover the complete life-cycle

\begin{list2}
\item  Preparation for an attack, establish procedures and mechanisms for detecting and responding to attacks
\item  Identification of an attack, notice the attack is ongoing
\item  Containment (confinement) of the attack, limit effects of the attack as much as possible
\item  Eradication of the attack, stop attacker, block further similar attacks
\item  Recovery from the attack, restore system to a secure state
\item  Follow-up to the attack, include lessons learned  improve environment
\end{list2}


\slide{MITRE ATT\&CK framework}

\hlkimage{14cm}{mitre-attack.png}

Source: \link{https://attack.mitre.org/} Great resource for attack categorization

\slide{Incident Response Checklists}
\hlkimage{9cm}{incident-handling-checklist.png}

This checklist is from the NIST document
\emph{Computer Security Incident Handling Guide: Recommendations of the National Institute
of Standards and Technology}, NIST Special Publication 800-61
Revision 2, August 2012.

\slide{CIS Controls also recommend Incident Response}

\begin{quote}{\bf
CIS Control 19:}\\
Incident Response and Management Protect the organization’s information, as well as its reputation, by developing and implementing an incident response infrastructure (e.g., plans, defined roles, training, communications, management oversight) for quickly discovering an attack and then effectively containing the damage, eradicating the attacker’s presence, and restoring the integrity of the network and systems.
\end{quote}

Source:
Center for Internet Security CIS Controls 7.1 CIS-Controls-Version-7-1.pdf
from \link{https://www.cisecurity.org/controls/}



\slide{Anatomy of an Auditing System}


Sample logs from login with Secure Shell (SSH) and performing the command \verb+sudo su -+
\begin{alltt}
Jun  5 11:53:15 pumba sshd[64505]: Accepted publickey for hlk from 79.142.233.18 port 43902
 ssh2: ED25519 SHA256:l8OJMcywyBcraJiCWJ06uZ2yzHfu0VuiArqVvlVyfEI

Jun  5 11:53:19 pumba sudo:      hlk : TTY=ttyp2 ; PWD=/home/hlk ; USER=root ; COMMAND=/usr/bin/su -
\end{alltt}

\begin{list1}
\item Example systems: Unix syslog, IBM main frame RACF and Windows Event Logs service
\item Logs should be protected and considered confidential information
\end{list1}



\slide{Anatomy of an Auditing System}

When data has been gathered it should be analyzed.

\begin{itemize}
\item {\bf Logger functions} - collect
\item {\bf Analyzer} - analyze it, creating dashboard can provide some insights
\item {\bf Notifier} - report results by email or other means
\item Example systems Windows Event Logs service can inform of successful and failed logins, both should be collected
\item Logs should be protected and considered confidential information, by sending it to a centralized system with a high security level protects it
\end{itemize}

Modern systems exist to take all data from logging and provide high capacity storage, searching and sorting.

\slide{Why Elasticsearch}

\hlkimage{8cm}{illustrated-screenshot-hero-siem-500x730.png}
Screenshot from \url{https://www.elastic.co/siem}

Recommend building a proof-of-concept infrastructure using the Elastic stack and gather experience with logging. This can be done without a license fee and the organization can then see what works and doesn't. Then using the experiences as input an informed decision can be made, to continue with this as a home grown logging and auditing solution, or buy a premade one.




\slide{Sources: Strategy for implementing identification and detection}

We recommend that the following strategy is used for implementing identification and detection -- logging:
\begin{enumerate}
\item[\faSquareO] Enable system logging from servers
\item[\faSquareO] Enable system logging from network devices
\item[\faSquareO] Enable logging from client devices
\item[\faSquareO] Centralize logging
\item[\faSquareO] Add search facilities and dashboards
\item[\faSquareO] Perform system audits manually or automatically
\item[\faSquareO] Setup alerting and notification with procedures
\end{enumerate}



\slide{Intrusion Kill Chains}

\hlkimage{13cm}{crafting-cip-kill-chain.png}

\begin{list2}
\item See also \emph{Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains}, Eric M. Hutchins , Michael J. Cloppert, Rohan M. Amin, Ph.D. Lockheed Martin Corporation\\{\footnotesize
 \link{https://www.lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf}}
\end{list2}



\slide{Detection Capabilities}


Security incidents happen, but what happens. One of the actions to reduce impact of incidents are done in preparing for incidents.

\begin{itemize}
\item \emph{Preparation} for an attack, establish procedures and mechanisms for detecting and responding to attacks
\end{itemize}

Preparation will enable easy {\bf identification} of affected systems, better {\bf containment} which systems are likely to be infected, {\bf eradication} what happened -- how to do the {\bf eradication} and {\bf recovery}.


\slide{Data Analysis Skills}

\begin{quote}
Although we could spend an entire book creating an exhaustive list of skills needed to be a good security data scientist, this chapter covers the following skills/domains that a data scientist will benefit from
knowing within information security:
\begin{list2}
\item Domain expertise—Setting and maintaining a purpose to the analysis
\item Data management—Being able to prepare, store, and maintain data
\item Programming—The glue that connects data to analysis
\item Statistics—To learn from the data
\item Visualization—Communicating the results effectively
\end{list2}
It might be easy to label any one of these skills as the most important, but in reality, the whole is greater than the sum of its parts. Each of these contributes a significant and important piece to the workings of
security data science.
\end{quote}

Source: \emph{Data-Driven Security: Analysis, Visualization and Dashboards} Jay Jacobs, Bob Rudis\\
ISBN: 978-1-118-79372-5 February 2014 \url{https://datadrivensecurity.info/} - short DDS



\myquestionspage



\slide{The Zeek Network Security Monitor}

Together with firewalls -- The Zeek Network Security Monitor is not a single tool, more of a powerful network analysis framework

\hlkimage{8cm}{zeek-ids.png}

\begin{quote}
While focusing on network security monitoring, Zeek provides a comprehensive platform for more general network traffic analysis as well. Well grounded in more than 15 years of research, Zeek has successfully bridged the traditional gap between academia and operations since its inception.
\end{quote}

Zeek is the tool formerly known as Bro, changed name in 2018. \link{https://www.zeek.org/}



\slide{Suricata IDS/IPS/NSM}
\hlkimage{6cm}{suricata.png}

\begin{quote}
Together with firewalls -- Suricata is a high performance Network IDS, IPS and Network Security Monitoring engine.
\end{quote}

 \link{http://suricata-ids.org/}
 \link{http://openinfosecfoundation.org}

Workshop materials available:\\
{\small\link{https://github.com/kramse/security-courses/tree/master/courses/networking/suricatazeek-workshop}}


\slide{Mutually Agreed Norms for Routing Security (MANRS)}

%\hlkimage{2cm}{MANRS_square.png}

\begin{quote}
  Mutually Agreed Norms for Routing Security (MANRS) is a global initiative, supported by the Internet Society, that provides crucial fixes to reduce the most common routing threats. ﻿
\end{quote}
Source: {\small\link{https://www.manrs.org/wp-content/uploads/2018/09/MANRS_PDF_Sep2016.pdf}}

\begin{list2}
\item Problems related to incorrect routing information
\item Problems related to traffic with spoofed source IP addresses
\item Problems related to coordination and collaboration between network operators
\item Also BCP38 RFC2827 \emph{Network Ingress Filtering: Defeating Denial of Service Attacks
which employ IP Source Address Spoofing}
\end{list2}

You should all ask your internet providers if they know about MANRS, and follow it. We should ask our government and institutions to support and follow MANRS and good practices for network on the Internet


\slide{Routing Security}


\begin{list2}
\item Use MD5 passwords or better authentication for routing protocols {\myalert}
\item TTL Security -- avoid routed packets
\item Max prefix -- of course, only allow expected networks
\item Prefix filtering -- only parts of IPv6 space is used
\item TCP Authentication Option [RFC 5925] replaces TCP MD5 [RFC 2385]
\item Turn ON RPKI for both IPv4 and IPv6 prefixes, {\myalert} \\
\link{https://nlnetlabs.nl/projects/rpki/about/}
\item Drop bogons on IPv4 and IPv6, article with multiple references YMMV\\
\link{https://theinternetprotocolblog.wordpress.com/2020/01/15/some-notes-on-ipv6-bogon-filtering/}
\end{list2}



\end{document}
